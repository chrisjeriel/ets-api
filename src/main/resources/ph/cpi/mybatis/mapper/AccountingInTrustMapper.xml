<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
        
<mapper namespace="ph.cpi.mybatis.mapper.AccountingInTrustMapper">
	<resultMap type="ph.cpi.rest.api.model.accountingintrust.AcitCvPaytReq" id="acitCvPaytReqListMap">
		<result property="paytReqNo" 	column="PAYT_REQ_NO"/>
		<result property="tranId" 		column="TRAN_ID"/>
		<result property="itemNo" 		column="ITEM_NO"/>
		<result property="reqId" 		column="REQ_ID"/>
		<result property="reqPrefix" 	column="REQ_PREFIX"/>
		<result property="reqYear" 		column="REQ_YEAR"/>
		<result property="reqMm" 		column="REQ_MM"/>
		<result property="reqSeqNo" 	column="REQ_SEQ_NO"/>
		<result property="tranTypeCd" 	column="TRAN_TYPE_CD"/>
		<result property="tranTypeDesc" column="TRAN_TYPE_DESC"/>
		<result property="reqDate" 		column="REQ_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" />
		<result property="requestedBy" 	column="REQUESTED_BY"/>
		<result property="particulars" 	column="PARTICULARS"/>
		<result property="currCd" 		column="CURR_CD"/>
		<result property="currRate" 	column="CURR_RATE"/>
		<result property="reqAmt" 		column="REQ_AMT"/>
		<result property="localAmt" 	column="LOCAL_AMT"/>
		<result property="createUser" 	column="CREATE_USER"/>
		<result property="createDate" 	column="CREATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" />
		<result property="updateUser" 	column="UPDATE_USER"/>
		<result property="updateDate" 	column="UPDATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" />
	</resultMap>
	
	<resultMap type="ph.cpi.rest.api.model.accountingintrust.AcitPaytReq" id="acitPaytReqMap">
		<result property="paytReqNo"		column="PAYT_REQ_NO"/>
		<result property="reqId"			column="REQ_ID"/>
		<result property="reqPrefix"		column="REQ_PREFIX"/>
		<result property="reqYear"			column="REQ_YEAR"/>
		<result property="reqMm"			column="REQ_MM"/>
		<result property="reqSeqNo"			column="REQ_SEQ_NO"/>
		<result property="tranTypeCd"		column="TRAN_TYPE_CD"/>
		<result property="tranTypeDesc"		column="TRAN_TYPE_DESC"/>
		<result property="reqDate"			column="REQ_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" />
		<result property="reqStatus"		column="REQ_STATUS"/>
		<result property="reqStatusDesc"	column="REQ_STATUS_DESC"/>
		<result property="payeeNo"			column="PAYEE_NO"/>
		<result property="payee"			column="PAYEE"/>
		<result property="currCd"			column="CURR_CD"/>
		<result property="currRate"			column="CURR_RATE"/>
		<result property="reqAmt"			column="REQ_AMT"/>
		<result property="localAmt"			column="LOCAL_AMT"/>
		<result property="particulars"		column="PARTICULARS"/>
		<result property="preparedBy"		column="PREPARED_BY"/>
		<result property="preparedDate"		column="PREPARED_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" />
		<result property="requestedBy"		column="REQUESTED_BY"/>
		<result property="approvedBy"		column="APPROVED_BY"/>
		<result property="approvedDate"		column="APPROVED_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" />
		<result property="createUser" 		column="CREATE_USER"/>
		<result property="createDate" 		column="CREATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" />
		<result property="updateUser" 		column="UPDATE_USER"/>
		<result property="updateDate" 		column="UPDATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" />
	</resultMap>
	
	<resultMap type="ph.cpi.rest.api.model.accountingintrust.AcitPrqTrans" id="acitPrqTransMap">
		<result property="reqId"				column="REQ_ID"/>
		<result property="itemNo"				column="ITEM_NO"/>
		<result property="claimId"				column="CLAIM_ID"/>
		<result property="projId"				column="PROJ_ID"/>
		<result property="histNo"				column="HIST_NO"/>
		<result property="policyId"				column="POLICY_ID"/>
		<result property="instNo"				column="INST_NO"/>
		<result property="quarterEnding"		column="QUARTER_ENDING" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" />
		<result property="invtId"				column="INVT_ID"/>
		<result property="refNo"				column="REF_NO"/>
		<result property="itemName"				column="ITEM_NAME"/>
		<result property="paymentFor"			column="PAYMENT_FOR"/>
		<result property="currCd"				column="CURR_CD"/>
		<result property="currRate"				column="CURR_RATE"/>
		<result property="currAmt"				column="CURR_AMT"/>
		<result property="localAmt"				column="LOCAL_AMT"/>
		<result property="remarks"				column="REMARKS"/>
		<result property="createUser" 			column="CREATE_USER"/>
		<result property="createDate" 			column="CREATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" />
		<result property="updateUser" 			column="UPDATE_USER"/>
		<result property="updateDate" 			column="UPDATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" />
	</resultMap>
	
	<select id="retrieveAcitCvPaytReqList" resultMap="acitCvPaytReqListMap" parameterType="java.util.Map">
		SELECT * FROM TABLE(ACIT_CV_PAYTREQLIST_PKG.ret_payt_req_list(
					#{tranId,jdbcType=INTEGER},
					#{itemNo,jdbcType=INTEGER},
					'', '', '',''))
	</select>
	<select id="retrieveAcitPaytReq" resultMap="acitPaytReqMap" parameterType="java.util.Map">
		SELECT * FROM TABLE(ACIT_PAYMENT_REQUEST_PKG.ret_payt_req(
					#{reqId,jdbcType=INTEGER},
					#{paytReqNo, jdbcType=VARCHAR},
					#{tranTypeDesc, jdbcType=VARCHAR},
					CAST(to_timestamp(#{reqDateFrom,jdbcType=DATE}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
					CAST(to_timestamp(#{reqDateTo,jdbcType=DATE}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
					#{reqStatusDesc, jdbcType=VARCHAR},
					#{payee, jdbcType=VARCHAR},
					#{currCd, jdbcType=VARCHAR},
					#{reqAmt, jdbcType=INTEGER},
					#{particulars, jdbcType=VARCHAR},
					#{requestedBy, jdbcType=VARCHAR},
					'', '', '',''))
	</select>
	
	<select id="retrieveAcitPrqTrans" resultMap="acitPrqTransMap" parameterType="java.util.Map">
		SELECT * FROM TABLE(ACIT_PRQ_TRANS_PKG.ret_acit_prq_trans(
					#{reqId,jdbcType=INTEGER},
					#{itemNo, jdbcType=INTEGER},
					'', '', '',''))
	</select>
	
	<update id="saveAcitPaytReq" parameterType="java.util.Map" statementType="CALLABLE">
		BEGIN
			ACIT_PAYMENT_REQUEST_PKG.save_payt_req(
				#{paytReqNo,mode=OUT,jdbcType=VARCHAR},
				#{reqId,mode=INOUT, jdbcType=INTEGER},
				#{reqPrefix, jdbcType=VARCHAR},
				#{reqYear, jdbcType=VARCHAR},
				#{reqMm, jdbcType=INTEGER},
				#{reqSeqNo, jdbcType=VARCHAR},
				#{tranTypeCd, jdbcType=VARCHAR},
				CAST(to_timestamp(#{reqDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
				#{reqStatus, jdbcType=VARCHAR},
				#{payeeNo, jdbcType=VARCHAR},
				#{payee, jdbcType=VARCHAR},
				#{currCd, jdbcType=VARCHAR},
				#{currRate, jdbcType=VARCHAR},
				#{reqAmt, jdbcType=INTEGER},
				#{localAmt, jdbcType=INTEGER},
				#{particulars, jdbcType=VARCHAR},
				#{preparedBy, jdbcType=VARCHAR},
				CAST(to_timestamp(#{preparedDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
				#{requestedBy, jdbcType=VARCHAR},
				#{approvedBy, jdbcType=VARCHAR},
				CAST(to_timestamp(#{approvedDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
				#{createUser, jdbcType=VARCHAR},
				CAST(to_timestamp(#{createDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
				#{updateUser, jdbcType=VARCHAR},
				CAST(to_timestamp(#{updateDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE)
			);
		END;
	</update>
	
	<resultMap type="ph.cpi.rest.api.model.accountingintrust.AcitProfCommSumm" id="acitProfCommSumm">
		<result property="profCommId" 					column="PROFCOMM_ID"/>
		<result property="cedingId" 					column="CEDING_ID"/>
		<result property="cedingName" 					column="CEDING_NAME"/>
		<result property="cedingAbbr" 					column="CEDING_ABBR"/>
		<result property="month" 						column="PROFCOMM_MM"/>
		<result property="year" 						column="PROFCOMM_YEAR"/>
		<result property="profitLossAmt" 				column="PROFIT_LOSS_AMT"/>
		<result property="totIncome" 					column="TOTAL_INCOME"/>
		<result property="totOutgo" 					column="TOTAL_OUTGO"/>
		<result property="lossCarry" 					column="LOSS_CARRY"/>
		<result property="createUser" 					column="CREATE_USER"/>
		<result property="createDate" 					column="CREATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" />
		<result property="updateUser" 					column="UPDATE_USER"/>
		<result property="updateDate" 					column="UPDATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" />
	</resultMap>
	
	<resultMap type="ph.cpi.rest.api.model.accountingintrust.AcitInvestments" id="acitInvestmentsList">
		<result property="invtId" 						column="INVT_ID"/>
		<result property="invtCd" 						column="INVT_CODE"/>
		<result property="bank" 						column="BANK"/>
		<result property="certNo" 						column="CERT_NO"/>
		<result property="invtType" 					column="INVT_TYPE"/>
		<result property="invtTypeDesc" 				column="INVT_TYPE_DESC"/>
		<result property="invtSecCd" 					column="INVT_SEC_CD"/>
		<result property="securityDesc" 				column="SECURITY_DESC"/>
		<result property="invtSecDesc" 					column="SECURITY_DESC"/>
		<result property="invtStatus" 					column="INVT_STATUS"/>
		<result property="matPeriod" 					column="MATURITY_PERIOD"/>
		<result property="durUnit" 						column="DURATION_UNIT"/>
		<result property="intRt" 						column="INTEREST_RATE"/>
		<result property="purDate" 						column="PURCHASED_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" />
		<result property="matDate" 						column="MATURITY_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" />
		<result property="currCd" 						column="CURR_CD"/>
		<result property="currRate" 					column="CURR_RATE"/>
		<result property="invtAmt" 						column="INVT_AMT"/>
		<result property="incomeAmt" 					column="INCOME_AMT"/>
		<result property="incomeAmt" 					column="INCOME_AMT"/>
		<result property="bankCharge" 					column="BANK_CHARGE"/>
		<result property="whtaxAmt" 					column="WHTAX_AMT"/>
		<result property="matVal" 						column="MATURITY_VALUE"/>
		<result property="createUser" 					column="CREATE_USER"/>
		<result property="createDate" 					column="CREATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" />
		<result property="updateUser" 					column="UPDATE_USER"/>
		<result property="updateDate" 					column="UPDATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" />
		<result property="okDelete"						column="OK_DELETE" />
		<result property="slCd"							column="SL_CD" />
	</resultMap>
	
	<select id="retrieveInvestmentList" resultMap="acitInvestmentsList" parameterType="java.util.Map">
		SELECT * FROM TABLE(ACIT_INVESTMENTS_PKG.ret_invt_list(
					#{invtId,jdbcType=INTEGER},
					#{invtCd,jdbcType=VARCHAR},
					#{bankCd,jdbcType=VARCHAR},
					#{bank,jdbcType=VARCHAR},
					#{invtType,jdbcType=VARCHAR},
					#{invtSecCd,jdbcType=VARCHAR},
					#{invtStatus,jdbcType=VARCHAR},
					#{matPeriod,jdbcType=VARCHAR},
					#{durUnit,jdbcType=VARCHAR},
					CAST(to_timestamp(#{purDate, jdbcType=VARCHAR}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
					CAST(to_timestamp(#{matDateFrom, jdbcType=VARCHAR}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
					CAST(to_timestamp(#{matDateTo, jdbcType=VARCHAR}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
					#{currCd,jdbcType=VARCHAR},
					'', '', '',''))
	</select> 
	
	<update id="saveAcitInvestments" parameterType="java.util.Map" statementType="CALLABLE">
		BEGIN
		   <foreach collection="saveAcitInvestments" item="investments">
		   	   ACIT_INVESTMENTS_PKG.save_invt(	#{investments.invtId, jdbcType=VARCHAR},
		   	   									#{investments.invtCd, jdbcType=VARCHAR},
		   	   									#{investments.bank	, jdbcType=VARCHAR},
		   	   									#{investments.certNo, jdbcType=VARCHAR},
		   	   									#{investments.invtType, jdbcType=VARCHAR},
		   	   									#{investments.invtSecCd, jdbcType=VARCHAR},
		   	   									#{investments.invtStatus, jdbcType=VARCHAR},
		   	   									#{investments.matPeriod, jdbcType=VARCHAR},
		   	   									#{investments.durUnit, jdbcType=VARCHAR},
		   	   									#{investments.intRt, jdbcType=VARCHAR},
		   	   									CAST(to_timestamp(#{investments.purDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
		   	   									CAST(to_timestamp(#{investments.matDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
		   	   									#{investments.currCd, jdbcType=VARCHAR},
		   	   									#{investments.currRate, jdbcType=VARCHAR},
		   	   									#{investments.invtAmt, jdbcType=VARCHAR},
		   	   									#{investments.incomeAmt, jdbcType=VARCHAR},
		   	   									#{investments.bankCharge, jdbcType=VARCHAR},
		   	   									#{investments.whtaxAmt, jdbcType=VARCHAR},
		   	   									#{investments.matVal, jdbcType=VARCHAR},
		   	   									#{investments.createUser},
			   									CAST(to_timestamp(#{investments.createDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
			   									#{investments.updateUser},
			   									CAST(to_timestamp(#{investments.updateDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
			   									#{investments.slCd,  jdbcType=VARCHAR});
		   </foreach>
		   <foreach collection="delAcitInvestments" item="investments">
		   		ACIT_INVESTMENTS_PKG.del_invt(#{investments.invtId, jdbcType=VARCHAR});
		   </foreach>
		END;
	</update>
	
	<select id="retrieveAcitCMDMList" resultMap="CMDMMapper">
		SELECT * FROM TABLE(ACIT_CRDR_MEMO_PKG.ret_acit_crdr_memo_list(#{tranId, jdbcType=VARCHAR},NULL,NULL,NULL,NULL))
	</select>
	
	<resultMap type="ph.cpi.rest.api.model.accountingintrust.AcitCMDM" id="CMDMMapper">
		<result property="tranId" column="CMDM_TRAN_ID"/>
		<result property="memoType" column="MEMO_TYPE"/>
		<result property="memoTranType" column="MEMO_TRAN_TYPE"/>
		<result property="tranTypeName" column="TRAN_TYPE_NAME"/>
		<result property="memoYear" column="MEMO_YEAR"/>
		<result property="memoMm" column="MEMO_MM"/>
		<result property="memoSeqNo" column="MEMO_SEQ_NO"/>
		<result property="tranTypeCd" column="CMDM_TRAN_TYPE_CD"/>
		<result property="groupTag" column="GROUP_TAG"/>
		<result property="autoTag" column="AUTO_TAG"/>
		<result property="memoDate" column="MEMO_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" />
		<result property="memoStatus" column="MEMO_STATUS"/>
		<result property="status" column="STATUS"/>
		<result property="refNo" column="REF_NO"/>
		<result property="refNoTranId" column="REF_NO_TRAN_ID"/>
		<result property="refNoDate" column="REF_NO_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" />
		<result property="payeeNo" column="PAYEE_NO"/>
		<result property="payee" column="PAYEE"/>
		<result property="particulars" column="PARTICULARS"/>
		<result property="currCd" column="CURR_CD"/>
		<result property="currRate" column="CURR_RATE"/>
		<result property="cmdmAmt" column="CMDM_AMT"/>
		<result property="localAmt" column="LOCAL_AMT"/>
		<result property="createUser" column="CMDM_CREATE_USER"/>
		<result property="createDate" column="CMDM_CREATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" />
		<result property="updateUser" column="CMDM_UPDATE_USER"/>
		<result property="updateDate" column="CMDM_UPDATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" />
		<result property="unbalAcctEntryTag" column="UNBAL_ACCT_ENTRY_TAG" />
	</resultMap>
	
	<update id="saveAcitCMDM" parameterType="java.util.Map"  statementType="CALLABLE">
		BEGIN
			ACIT_CRDR_MEMO_PKG.save_acit_crdr_memo(#{tranId,  mode=INOUT, jdbcType=VARCHAR},#{memoType},#{memoTranType, jdbcType=VARCHAR},#{memoYear, jdbcType=VARCHAR},#{memoMm, jdbcType=VARCHAR},#{memoSeqNo, jdbcType=VARCHAR},#{tranTypeCd},#{autoTag},
				CAST(to_timestamp(#{memoDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE)
				,#{memoStatus},#{refNoTranId},
				CAST(to_timestamp(#{refNoDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE)
				,#{payeeNo, jdbcType=VARCHAR},#{payee},#{particulars},#{currCd},#{currRate},#{cmdmAmt},#{localAmt},#{createUser},
				CAST(to_timestamp(#{createDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE)
				,
				#{updateUser},
				CAST(to_timestamp(#{updateDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE)
				);
		END;
	</update>
	
	<select id="retrieveAcitRefNoLOV" resultMap="refNoLovMap">
		SELECT * FROM TABLE(ACIT_CRDR_MEMO_PKG.get_ref_nos(#{arTag, jdbcType=VARCHAR},
			#{cvTag, jdbcType=VARCHAR},
			#{jvTag, jdbcType=VARCHAR},
			#{cmTag, jdbcType=VARCHAR},
			#{dmTag, jdbcType=VARCHAR},
			#{groupTag, jdbcType=VARCHAR},
			#{tranStat, jdbcType=VARCHAR},
			#{arStatus, jdbcType=VARCHAR},
			#{cvStatus, jdbcType=VARCHAR},
			#{jvStatus, jdbcType=VARCHAR},
			#{memoStatus, jdbcType=VARCHAR}))
	</select>
	
	<resultMap type="ph.cpi.rest.api.model.accountingintrust.RefNoLov" id="refNoLovMap">
		<result property="tranId" column="TRAN_ID"/>
		<result property="tranClass" column="TRAN_CLASS"/>
		<result property="tranNo" column="TRAN_NO"/>
		<result property="tranTypeName" column="TRAN_TYPE_NAME"/>
		<result property="tranDate" column="TRAN_DATE"  typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" />
		<result property="tranStat" column="TRAN_STAT"/>
		<result property="particulars" column="PARTICULARS"/>
		<result property="status" column="STATUS"/>
		<result property="amount" column="AMOUNT"/>
	</resultMap>

	<resultMap type="ph.cpi.rest.api.model.accountingintrust.AcknowledgementReceipt" id="arListMap">
		<result property="tranId"			column="TRAN_ID" />
		<result property="arNo"				column="AR_NO" />
		<result property="arDate"			column="AR_DATE"	typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" />
		<result property="arStatDesc"		column="AR_STATUS" />
		<result property="tranTypeName"		column="TRAN_TYPE_NAME" />
		<result property="payor"			column="PAYOR" />
		<result property="arAmt"			column="AR_AMT" />
		<result property="particulars"		column="PARTICULARS" />
		<result property="createUser"		column="CREATE_USER" />
		<result property="createDate"		column="CREATE_DATE"	typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" />
		<result property="updateUser"		column="UPDATE_USER" />
		<result property="updateDate"		column="UPDATE_DATE"	typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" />
	</resultMap>
	
	<select id="retArList" resultMap="arListMap" parameterType="java.util.Map">
		SELECT * FROM TABLE(ACIT_ACKGT_RECEIPT_PKG.ret_ar_list(
																#{arNo, jdbcType=VARCHAR},
																#{payor, jdbcType=VARCHAR},
																CAST(to_timestamp(#{arDateFrom,jdbcType=DATE}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
																CAST(to_timestamp(#{arDateTo,jdbcType=DATE}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
																#{tranTypeName, jdbcType=VARCHAR},
																#{arStatus, jdbcType=VARCHAR},
																#{particulars, jdbcType=VARCHAR},
																#{arAmtFrom, jdbcType=VARCHAR},
																#{arAmtTo, jdbcType=VARCHAR},
																NULL,
																NULL,
																NULL,
																NULL
															   )
						   )
	</select>
	
	<resultMap type="ph.cpi.rest.api.model.accountingintrust.AcknowledgementReceipt" id="arEntryMap">
		<result property="tranId"        column="TRAN_ID"           />
		<result property="arNo"          column="AR_NO"             />
		<result property="arDate"        column="AR_DATE"          typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" />
		<result property="arStatus"      column="AR_STATUS"         />
		<result property="tranStat"      column="TRAN_STAT"         />
		<result property="arStatDesc"    column="AR_STAT_DESC"      />
		<result property="dcbYear"       column="DCB_YEAR"          />
		<result property="dcbUserCd"     column="DCB_USER_CD"       />
		<result property="dcbNo"         column="DCB_NO"            />
		<result property="dcbBank"       column="DCB_BANK"          />
		<result property="dcbBankName"   column="DCB_BANK_NAME"     />
		<result property="dcbBankAcct"   column="DCB_BANK_ACCT"     />
		<result property="dcbBankAcctNo" column="DCB_BANK_ACCT_NO"  />
		<result property="refNo"         column="REF_NO"            />
		<result property="tranTypeCd"    column="TRAN_TYPE_CD"      />
		<result property="tranTypeName"  column="TRAN_TYPE_NAME"    />
		<result property="prNo"          column="PR_NO"             />
		<result property="prDate"        column="PR_DATE"          typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" />
		<result property="prPreparedBy"  column="PR_PREPARED_BY"    />
		<result property="payeeNo"       column="PAYEE_NO"          />
		<result property="payor"         column="PAYOR"             />
		<result property="mailAddress"   column="MAIL_ADDRESS"      />
		<result property="bussTypeCd"    column="BUSS_TYPE_CD"      />
		<result property="tin"           column="TIN"               />
		<result property="refCd"         column="REF_CD"               />
		<result property="currCd"        column="AAR_CURR_CD"       />
		<result property="arAmt"         column="AR_AMT"            />
		<result property="currRate"      column="AAR_CURR_RATE"     />
		<result property="particulars"   column="PARTICULARS"       />
		<result property="createUser"    column="CREATE_USER"       />
		<result property="createDate"    column="CREATE_DATE"      typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" />
		<result property="updateUser"    column="UPDATE_USER"       />
		<result property="updateDate"    column="UPDATE_DATE"      typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" />
		<result property="cedingId"      column="CEDING_ID"       />
		<result property="bussTypeName"  column="BUSS_TYPE_NAME"       />
		<result property="rstrctTranUp"  column="RSTRCT_TRAN_UP"       />
		<association property="paytDtl"  resultMap="paytDtlAssoc"   />
	</resultMap>
	
	<resultMap type="ph.cpi.rest.api.model.accountingintrust.ARPaymentDetails" id="paytDtlAssoc">
		<result property="paytId"          column="PAYT_ID" />
		<result property="paytMode"        column="PAYT_MODE" />
		<result property="currCd"          column="AAP_CURR_CD" />
		<result property="currRate"        column="AAP_CURR_RATE" />
		<result property="paytAmt"         column="PAYT_AMT" />
		<result property="bank"            column="BANK" />
		<result property="bankAcct"        column="BANK_ACCT" />
		<result property="checkNo"         column="CHECK_CARD_NO" />
		<result property="checkDate"       column="CHECK_DATE"          typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" />
		<result property="checkClass"      column="CHECK_CLASS" />
		<result property="remarks"         column="REMARKS" />
	</resultMap>
	
	<select id="retArEntry" resultMap="arEntryMap" parameterType="java.util.Map">
		SELECT * FROM TABLE(ACIT_ACKGT_RECEIPT_PKG.ret_ar_entry(
																	#{tranId},
																	#{arNo}
															   )
						   )
	</select>
	
	<resultMap type="ph.cpi.rest.api.model.accountingintrust.AcitTransactions" id="transactionMap">
		<result property="tranId" column="TRAN_ID"/>
		<result property="tranDate" column="TRAN_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<result property="tranClass" column="TRAN_CLASS"/>
		<result property="tranTypeCd" column="TRAN_TYPE_CD"/>
		<result property="tranYear" column="TRAN_YEAR"/>
		<result property="tranClassNo" column="TRAN_CLASS_NO"/>
		<result property="tranStat" column="TRAN_STAT"/>
		<result property="closeDate" column="CLOSE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<result property="deleteDate" column="DELETE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<result property="postDate" column="POST_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<result property="createUser" column="CREATE_USER"/>
		<result property="createDate" column="CREATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<result property="updateUser" column="UPDATE_USER"/>
		<result property="updateDate" column="UPDATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<association property="jvListings" resultMap="jvMap"></association>
	</resultMap>
	
	<resultMap type="ph.cpi.rest.api.model.accountingintrust.AcitJVListing" id="jvMap">
		<result property="tranId" 			column="JV_TRAN_ID"/>
		<result property="jvYear" 			column="JV_YEAR"/>
		<result property="jvNo" 			column="JV_NO"/>
		<result property="jvDate" 			column="JV_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<result property="jvStatus" 		column="JV_STATUS"/>
		<result property="jvStatusName" 	column="JV_STATUS_NAME"/>
		<result property="tranTypeCd" 		column="JV_TRAN_TYPE_CD"/>
		<result property="tranTypeName" 	column="TRAN_TYPE"/>
		<result property="autoTag" 			column="AUTO_TAG"/>
		<result property="refnoTranId" 		column="REFNO_TRAN_ID"/>
		<result property="refNo" 			column="REFNO"/>
		<result property="refnoDate" 		column="REFNO_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<result property="particulars" 		column="PARTICULARS"/>
		<result property="currCd" 			column="CURR_CD"/>
		<result property="currRate" 		column="CURR_RATE"/>
		<result property="jvAmt" 			column="JV_AMT"/>
		<result property="localAmt" 		column="LOCAL_AMT"/>
		<result property="allocTag" 		column="ALLOC_TAG"/>
		<result property="allocTranId" 		column="ALLOC_TRAN_ID"/>
		<result property="preparedBy" 		column="PREPARED_BY"/>
		<result property="preparedName" 	column="PREPARED_NAME"/>
		<result property="preparedPosition" column="PREPARED_POS"/>
		<result property="preparedDate" 	column="PREPARED_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<result property="approvedBy" 		column="APPROVED_BY"/>
		<result property="approvedName" 	column="APPROVED_NAME"/>
		<result property="approvedPosition" column="APPROVED_POS"/>
		<result property="approvedDate" 	column="APPROVED_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<result property="createUser" 		column="JV_CREATE_USER"/>
		<result property="createDate" 		column="JV_CREATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<result property="updateUser" 		column="JV_UPDATE_USER"/>
		<result property="updateDate" 		column="JV_UPDATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<association property="inwPolBal" resultMap="inwPolBalMap"></association>
	</resultMap>
	
	<resultMap type="ph.cpi.rest.api.model.accountingintrust.AcitJVAdjstInwPolBal" id="inwPolBalMap">
		<result property="tranId" column="TRAN_ID"/>
		<result property="itemNo" column="ITEM_NO"/>
		<result property="policyId" column="PREV_POLICY_ID"/>
		<result property="policyNo" column="PREV_POLICY_NO"/>
		<result property="cedingId" column="CEDING_ID"/>
		<result property="cedingName" column="CEDING_NAME"/>
		<result property="instNo" column="PREV_INST_NO"/>
		<result property="coRefNo" column="PREV_CO_REF_NO"/>
		<result property="effDate" column="PREV_EFF_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<result property="dueDate" column="PREV_DUE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<result property="currCd" column="PREV_CURR"/>
		<result property="currRate" column="PREV_CURR_RATE"/>
		<result property="prevPremAmt" column="PREV_PREMIUM"/>
		<result property="prevRiComm" column="PREV_RI_COMM"/>
		<result property="prevRiCommVat" column="PREV_RI_COMM_VAT"/>
		<result property="prevCharges" column="PREV_CHARGES"/>
		<result property="prevNetDue" column="PREV_NET_DUE"/>
		<result property="cumPayment" column="PREV_CUMMULATIVE_PAYMENT"/>
		<result property="balance" column="PREV_BALANCE"/>
		<result property="localAmt" column="LOCAL_AMOUNT"/>
		<result property="paytAmt" column="PAYMENT_AMOUNT"/>
		<result property="premAmt" column="PREM_AMT"/>
		<result property="riComm" column="RI_COMM"/>
		<result property="riCommVat" column="RI_COMM_VAT"/>
		<result property="charges" column="CHARGES"/>
		<result property="totalPayt" column="TOTAL_PAYMENTS"/>
		<result property="remainingBal" column="REMAINING_BALANCE"/>
		<result property="createUser" column="CREATE_USER"/>
		<result property="createDate" column="CREATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<result property="updateUser" column="UPDATE_USER"/>
		<result property="updateDate" column="UPDATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<result property="okDelete" column="OKDELETE"/>
	</resultMap>
	
	<resultMap type="ph.cpi.rest.api.model.accountingintrust.AcitSOAAgingDetails" id="soaAgingMap">
		<result property="policyId" column="POLICY_ID"/>
		<result property="cedingId" column="CEDING_ID"/>
		<result property="refCd" column="REF_CD"/>
		<result property="payeeNo" column="PAYEE_NO"/>
		<result property="payeeName" column="PAYEE_NAME"/>
		<result property="policyNo" column="POLICY_NO"/>
		<result property="soaNo" column="SOA_NO"/>
		<result property="coRefNo" column="CO_REF_NO"/>
		<result property="instNo" column="INST_NO"/>
		<result property="currCd" column="CURR_CD"/>
		<result property="currRate" column="CURR_RATE"/>
		<result property="totalAmtDue" column="TOTAL_AMT_DUE"/>
		<result property="totalPayments" column="TOTAL_PAYMENTS"/>
		<result property="tempPayments" column="TEMP_PAYMENTS"/>
		<result property="netDuePayments" column="NET_DUE_PAYMENTS"/>
		<result property="balAmtDue" column="BAL_AMT_DUE"/>
		<result property="balPremDue" column="BAL_PREM_DUE"/>
		<result property="balChargesDue" column="BAL_CHARGES_DUE"/>
		<result property="balRiComm" column="BAL_RI_COMM"/>
		<result property="balRiCommVat" column="BAL_RI_COMM_VAT"/>
		<result property="balOverdueInt" column="BAL_OVERDUE_INT"/>
		<result property="effDate" column="EFF_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<result property="dueDate" column="DUE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<result property="bookingDate" column="BOOKING_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<result property="agingId" column="AGING_ID"/>
		<result property="netDue" column="NET_DUE"/>
		<result property="balance" column="BALANCE"/>
		<result property="createUser" column="CREATE_USER"/>
		<result property="createDate" column="CREATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<result property="updateUser" column="UPDATE_USER"/>
		<result property="updateDate" column="UPDATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
	</resultMap>
	
	<resultMap type="ph.cpi.rest.api.model.accountingintrust.AcitJVIntOverdueAcctsMS" id="overDueMap">
		<result property="tranId" column="TRAN_ID"/>
		<result property="itemNo" column="ITEM_NO"/>
		<result property="cedingId" column="CEDING_ID"/>
		<result property="cedingName" column="CEDING_NAME"/>
		<result property="policyId" column="POLICY_ID"/>
		<result property="policyNo" column="POLICY_NO"/>
		<result property="soaNo" column="SOA_NO"/>
		<result property="coRefNo" column="CO_REF_NO"/>
		<result property="effDate" column="EFF_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<result property="instNo" column="INST_NO"/>
		<result property="dueDate" column="DUE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<result property="daysOverdue" column="DAYS_OVERDUE"/>
		<result property="autoTag" column="AUTO_TAG"/>
		<result property="currCd" column="CURR_CD"/>
		<result property="currRate" column="CURR_RATE"/>
		<result property="premAmt" column="PREM_AMT"/>
		<result property="overdueInt" column="OVERDUE_INT"/>
		<result property="createUser" column="CREATE_USER"/>
		<result property="createDate" column="CREATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<result property="updateUser" column="UPDATE_USER"/>
		<result property="updateDate" column="UPDATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
	</resultMap>
	
	<select id="retrieveAcitJvList" resultMap="transactionMap" parameterType="java.util.Map">
		SELECT * FROM TABLE(ACIT_JOURNAL_VOUCHER_PKG.ret_acit_jv(
					#{tranId,jdbcType=INTEGER},
					'', '', '',''))
	</select>
	
	<select id="retrieveAcitJvEntry" resultMap="transactionMap" parameterType="java.util.Map">
		SELECT * FROM TABLE(ACIT_JOURNAL_VOUCHER_PKG.ret_acit_jv_ent(
					#{tranId,jdbcType=INTEGER},
					'', '', '',''))
	</select>
	
	<update id="saveAcitJVEntry" parameterType="java.util.Map" statementType="CALLABLE">
		DECLARE
			v_tran_id	ACIT_TRANSACTIONS.TRAN_ID%TYPE;
		BEGIN
			ACIT_JOURNAL_VOUCHER_PKG.save_acit_jv(v_tran_id,#{tranId, jdbcType=VARCHAR}, 
												  CAST(to_timestamp(#{tranDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),#{tranType,jdbcType=INTEGER},
												  #{tranYear,jdbcType=VARCHAR}, #{tranClassNo,jdbcType=VARCHAR}, 
												  #{tranStat}, CAST(to_timestamp(#{closeDate,jdbcType=VARCHAR}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
												  CAST(to_timestamp(#{deleteDate,jdbcType=VARCHAR}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
												  CAST(to_timestamp(#{postDate,jdbcType=VARCHAR}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
												  #{createUser}, CAST(to_timestamp(#{createDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE), #{updateUser},   
												  CAST(to_timestamp(#{updateDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
												  #{tranIdJv,jdbcType=VARCHAR}, #{jvYear,jdbcType=VARCHAR},
												  #{jvNo,jdbcType=VARCHAR}, CAST(to_timestamp(#{jvDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE), #{jvStatus}, #{jvTranTypeCd}, 
												  #{autoTag}, #{refnoTranId,jdbcType=INTEGER}, CAST(to_timestamp(#{refnoDate,jdbcType=VARCHAR}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE), 
												  #{particulars}, #{currCd}, #{currRate}, #{jvAmt}, #{localAmt}, #{allocTag,jdbcType=VARCHAR}, #{allocTranId,jdbcType=VARCHAR}, 
												  #{preparedBy,jdbcType=VARCHAR}, 
												  CAST(to_timestamp(#{preparedDate,jdbcType=VARCHAR}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE), #{approvedBy,jdbcType=VARCHAR}, 
												  CAST(to_timestamp(#{approvedDate,jdbcType=VARCHAR}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE), 
												  #{createUserJv}, CAST(to_timestamp(#{createDateJv}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE), #{updateUserJv}, 
												  CAST(to_timestamp(#{updateDateJv}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE));
			#{tranIdOut, mode=OUT, jdbcType=INTEGER} := v_tran_id;
		END;
		
	</update>
	
	<select id="retrieveAcitSOAAging" resultMap="soaAgingMap" parameterType="java.util.Map">
		SELECT * FROM TABLE(ACIT_JOURNAL_VOUCHER_PKG.ret_acit_jv_soa(
					#{tranId},
					#{policyId,jdbcType=INTEGER},
					#{instNo,jdbcType=INTEGER},
					#{cedingId},
					'', '', '',''))
	</select>
	
	<select id="retrieveAcitJvInwPolBal" resultMap="inwPolBalMap" parameterType="java.util.Map">
		SELECT * FROM TABLE(ACIT_JOURNAL_VOUCHER_PKG.ret_acit_jv_aipb(
					#{tranId},
					#{instNo,jdbcType=INTEGER},
					#{cedingCo,jdbcType=INTEGER},
					'', '', '',''))
	</select>

	<update id="saveAcitArTrans" parameterType="java.util.Map" statementType="CALLABLE">
		DECLARE
			v_tran_id        ACIT_TRANSACTIONS.TRAN_ID%TYPE;
			v_message		 VARCHAR2(500);
		BEGIN
			ACIT_ACKGT_RECEIPT_PKG.save_acit_trans(
													v_tran_id,
													#{tranId},
													CAST(to_timestamp(#{tranDate,jdbcType=DATE}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
													#{tranClass},
													#{tranTypeCd},
													#{tranYear},
													#{tranClassNo,jdbcType=VARCHAR},
													#{tranStat},
													CAST(to_timestamp(#{closeDate,jdbcType=DATE}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
													CAST(to_timestamp(#{deleteDate,jdbcType=DATE}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
													CAST(to_timestamp(#{postDate,jdbcType=DATE}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
													#{createUser},
													CAST(to_timestamp(#{createDate,jdbcType=DATE}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
													#{updateUser},
													CAST(to_timestamp(#{updateDate,jdbcType=DATE}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE)
												  );
												  
			#{outTranId, mode=OUT, jdbcType=VARCHAR} := v_tran_id;
			
			IF v_tran_id <![CDATA[ <> ]]> 0 THEN
				ACIT_ACKGT_RECEIPT_PKG.save_ar_info(
														v_tran_id,
														#{tranClassNo, jdbcType=VARCHAR},
														CAST(to_timestamp(#{tranDate,jdbcType=DATE}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
														#{arStatus},
														#{tranTypeCd},
														#{dcbYear},
														#{dcbNo},
														#{dcbUserCd},
														#{dcbBank, jdbcType=VARCHAR},
														#{dcbBankAcct, jdbcType=VARCHAR},
														#{refNo, jdbcType=VARCHAR},
														#{prNo, jdbcType=VARCHAR},
														CAST(to_timestamp(#{prDate,jdbcType=DATE}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
														#{prPreparedBy, jdbcType=VARCHAR},
														#{payeeNo, jdbcType=VARCHAR},
														#{payor},
														#{mailAddress},
														#{bussTypeName},
														#{tin},
														#{particulars},
														#{currCd},
														#{currRate},
														#{arAmt},
														#{allocTag, jdbcType=VARCHAR},
														#{allocTranId, jdbcType=VARCHAR},
														#{createUser},
														CAST(to_timestamp(#{createDate,jdbcType=DATE}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
														#{updateUser},
														CAST(to_timestamp(#{updateDate,jdbcType=DATE}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE)
													);
				<foreach collection="delPaytDtl" item="del">
					ACIT_AR_PAYTDTL_PKG.del_ar_paytdtl(
														v_tran_id,
														#{del.paytId}
													  );
				</foreach>
				<foreach collection="savePaytDtl" item="save">
					ACIT_AR_PAYTDTL_PKG.save_ar_paytdtl(
														v_tran_id,
														#{save.paytId, jdbcType=VARCHAR},
														#{save.paytMode},
														#{save.currCd},
														#{save.currRate},
														#{save.paytAmt},
														#{save.bank, jdbcType=VARCHAR},
														#{save.bankAcct, jdbcType=VARCHAR},
														#{save.checkNo, jdbcType=VARCHAR},
														CAST(to_timestamp(#{save.checkDate,jdbcType=DATE}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
														#{save.checkClass, jdbcType=VARCHAR},
														#{save.remarks, jdbcType=VARCHAR}
													  );
				</foreach>
				
				<!-- IF TRAN TYPE IS LOSS RESERVE DEPOSIT -->
				IF #{tranTypeCd} <![CDATA[ = ]]> 6 OR #{tranTypeCd} <![CDATA[ = ]]> 7 THEN
					
					<!-- Save to ACIT_AR_TRANSUMM -->
					ACIT_AR_TRANSUMM_PKG.save_acit_transumm(v_tran_id,
															1,
															#{tranTypeCd},
															#{arAmt} * #{currRate},
															null,
															#{createUser},
															CAST(to_timestamp(#{createDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
															#{updateUser},
															CAST(to_timestamp(#{updateDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE)
															);
					<!-- Save to ACIT_AR_TRANSDTL -->
					IF #{tranTypeCd} <![CDATA[ = ]]> 6 THEN
						ACIT_AR_TRANSDTL_PKG.save_ar_transdtl(
															v_tran_id,
															1,
															1,
															'Loss Reserve Deposit',
															#{currCd},
															#{currRate},
															#{arAmt},
															#{arAmt} * #{currRate},
															#{refNo, jdbcType=VARCHAR},
															'Loss Reserved Deposit by: '|| #{payor},
															#{createUser},
															CAST(to_timestamp(#{createDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
															#{updateUser},
															CAST(to_timestamp(#{updateDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE)				
						);
					ELSIF #{tranTypeCd} <![CDATA[ = ]]> 7 THEN
						ACIT_AR_TRANSDTL_PKG.save_ar_transdtl(
															v_tran_id,
															1,
															1,
															'Payment for Advances by Service',
															#{currCd},
															#{currRate},
															#{arAmt},
															#{arAmt} * #{currRate},
															#{refNo, jdbcType=VARCHAR},
															'Payment for Advances by Service',
															#{createUser},
															CAST(to_timestamp(#{createDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
															#{updateUser},
															CAST(to_timestamp(#{updateDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE)				
						);
					END IF;
					<!-- Generate to Amount Details -->
					<!-- GENERATE_DEFAULT_AMT('AR', #{tranTypeCd}, #{tranId}, #{updateUser}); -->
					<!-- Generate to Accounting Entries -->
					GENERATE_ACCIT_ENTRIES.SAVE_FINAL_ACCT_ENTRIES('AR', #{tranTypeCd}, v_tran_id, v_message);
				END IF;
			END IF;
		END;
	</update>
	
	<update id="saveAcitJVEntryList" parameterType="java.util.Map" statementType="CALLABLE">
		DECLARE
			v_tran_id	ACIT_TRANSACTIONS.TRAN_ID%TYPE;
			v_message   VARCHAR2(500);
		BEGIN
		  <foreach collection="saveAcitJVEntryList" item="save">
			ACIT_JOURNAL_VOUCHER_PKG.save_acit_jv(v_tran_id,#{save.tranId, jdbcType=VARCHAR}, 
												  CAST(to_timestamp(#{save.tranDate,jdbcType=VARCHAR}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),#{save.tranType,jdbcType=INTEGER},
												  #{save.tranYear,jdbcType=VARCHAR}, #{save.tranClassNo,jdbcType=VARCHAR}, 
												  #{save.tranStat}, CAST(to_timestamp(#{save.closeDate,jdbcType=VARCHAR}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
												  CAST(to_timestamp(#{save.deleteDate,jdbcType=VARCHAR}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
												  CAST(to_timestamp(#{save.postDate,jdbcType=VARCHAR}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
												  #{save.createUser}, CAST(to_timestamp(#{save.createDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE), #{save.updateUser},   
												  CAST(to_timestamp(#{save.updateDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
												  #{save.tranIdJv,jdbcType=VARCHAR}, #{save.jvYear,jdbcType=VARCHAR},
												  #{save.jvNo,jdbcType=VARCHAR}, CAST(to_timestamp(#{save.jvDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE), #{save.jvStatus}, #{save.jvTranTypeCd}, 
												  #{save.autoTag}, #{save.refnoTranId,jdbcType=VARCHAR}, CAST(to_timestamp(#{save.refnoDate,jdbcType=VARCHAR}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE), 
												  #{save.particulars}, #{save.currCd}, #{save.currRate}, #{save.jvAmt}, #{save.localAmt}, #{save.allocTag,jdbcType=VARCHAR}, #{save.allocTranId,jdbcType=VARCHAR}, 
												  #{save.preparedBy,jdbcType=VARCHAR}, 
												  CAST(to_timestamp(#{save.preparedDate,jdbcType=VARCHAR}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE), #{save.approvedBy,jdbcType=VARCHAR}, 
												  CAST(to_timestamp(#{save.approvedDate,jdbcType=VARCHAR}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE), 
												  #{save.createUserJv}, CAST(to_timestamp(#{save.createDateJv}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE), #{save.updateUserJv}, 
												  CAST(to_timestamp(#{save.updateDateJv}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE));
			#{tranIdOut, mode=OUT, jdbcType=INTEGER} := v_tran_id;
			GENERATE_ACCIT_ENTRIES.SAVE_FINAL_ACCT_ENTRIES('JV', #{save.jvTranTypeCd}, v_tran_id, v_message);
			IF v_tran_id <![CDATA[ <> ]]> 0 THEN
				<foreach collection="saveAcitAllocInvtIncome" item="save">
					ACIT_ALL_INVT_INC_PKG.save_alloc_ref_dtl(
														v_tran_id,
														#{save.refTranId, jdbcType=VARCHAR},
														#{save.createUser, jdbcType=VARCHAR},
														CAST(to_timestamp(#{save.createDate,jdbcType=DATE}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
														#{save.updateUser, jdbcType=VARCHAR},
														CAST(to_timestamp(#{save.updateDate,jdbcType=DATE}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE)
														
													  );
				</foreach>
			END IF; 
			
		</foreach>
		
		
	END;
		
	</update> 

	<update id="updateAcitPaytReqStat" parameterType="java.util.Map">
		BEGIN
			ACIT_PAYMENT_REQUEST_PKG.up_acit_paytreqstat(
				#{reqId, jdbcType=INTEGER},
				#{reqStatus, jdbcType=VARCHAR},
				#{updateUser, jdbcType=VARCHAR}
			);
		END;
	</update>
	
	<select id="retrieveAcitJVIntOverdue" resultMap="overDueMap" parameterType="java.util.Map">
		SELECT * FROM TABLE(ACIT_JOURNAL_VOUCHER_PKG.ret_acit_jv_ioams(
					#{tranId},
					#{instNo,jdbcType=INTEGER},
					#{cedingId},
					'', '', '',''))
	</select>
	
	<update id="saveAcitJVInwPolBal" parameterType="java.util.Map" statementType="CALLABLE">
		DECLARE
			v_message VARCHAR2(500);
		BEGIN
			<foreach collection="deleteInwPol" item="delete">
				ACIT_JOURNAL_VOUCHER_PKG.del_acit_aipb(#{delete.tranId}, #{delete.itemNo}, #{delete.policyId}, #{delete.instNo}, #{delete.premAmt}, #{delete.riComm}, 
													   #{delete.riCommVat}, #{delete.charges}, 
													   #{delete.paytAmt},#{delete.updateUser}, 
													  	CAST(to_timestamp(#{delete.updateDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE));
				
				ACIT_INWPOL_PAYTS_PKG.del_inwpol_payts(
														#{delete.tranId},
														#{delete.policyId},
														#{delete.instNo}
				);
			</foreach>
			
			<foreach collection="saveInwPol" item="save">
				ACIT_JOURNAL_VOUCHER_PKG.save_acit_aipb(#{save.tranId}, #{save.itemNo,jdbcType=INTEGER}, #{save.policyId}, #{save.instNo}, #{save.currCd}, 
													#{save.currRate}, #{save.premAmt}, #{save.riComm}, #{save.riCommVat}, #{save.charges}, 
													#{save.netDue}, #{save.paytAmt}, #{save.localAmt},#{save.remainingBal}, #{save.overdueInt,jdbcType=INTEGER}, #{save.createUser}, 
													CAST(to_timestamp(#{save.createDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
													#{save.updateUser}, 
													CAST(to_timestamp(#{save.updateDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE));
			
				ACIT_AGING_SOA_DETAILS_PKG.save_aging_soa_dtl_test(#{save.policyId}, #{save.instNo}, #{save.premAmt}, #{save.riComm}, #{save.riCommVat}, #{save.charges}, 
																   #{save.paytAmt},#{save.updateUser}, 
																  CAST(to_timestamp(#{save.updateDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE));
																  
			<!-- 	ACIT_AGING_SOA_DETAILS_PKG.save_aging_soa_dtl(#{save.policyId},#{save.instNo}, #{save.premAmt}, #{save.riComm}, #{save.riCommVat}, 
															  #{save.charges}, #{save.netDue}, #{save.adjBalAmt}, 
															  #{save.updateUser}, 
															  CAST(to_timestamp(#{save.updateDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE)); -->
			
				ACIT_INWPOL_PAYTS_PKG.save_inwpol_payts(
														#{save.tranId},
														#{save.policyId},
														#{save.instNo},
														1, <!-- PAYT TYPE 1 FOR JV. CHANGE AS NECESSARY -->
														3 
				);
			</foreach>
			
			GENERATE_ACCIT_ENTRIES.SAVE_FINAL_ACCT_ENTRIES('JV', #{tranType}, #{tranId}, v_message);
		END;
	</update>
	
	<update id="saveAcitJVOverdueAccts" parameterType="java.util.Map">
		DECLARE
			v_message VARCHAR2(500);
		BEGIN
			<foreach collection="deleteOverdueAccts" item="delete">
				ACIT_JOURNAL_VOUCHER_PKG.del_acit_ioams(#{delete.tranId}, #{delete.itemNo});
			</foreach>
			
			<foreach collection="saveOverdueAccts" item="save">
				ACIT_JOURNAL_VOUCHER_PKG.save_acit_ioams(#{save.tranId}, #{save.itemNo,jdbcType=INTEGER}, #{save.policyId},
														 #{save.instNo}, CAST(to_timestamp(#{save.dueDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
														 #{save.daysOverdue}, #{save.interestRate}, #{save.autoTag}, #{save.currCd}, #{save.currRate}, 
														 #{save.premAmt}, #{save.overdueInt}, #{save.createUser},
													     CAST(to_timestamp(#{save.createDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
														 #{save.updateUser},
														 CAST(to_timestamp(#{save.updateDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE));
			</foreach>
			
			GENERATE_ACCIT_ENTRIES.SAVE_FINAL_ACCT_ENTRIES('JV', #{tranType}, #{tranId}, v_message);
		END;
	</update>
	
	<resultMap type="ph.cpi.rest.api.model.accountingintrust.AcitJVPremResReleased" id="premResMap">
		<result property="tranId" column="TRAN_ID"/>
		<result property="itemNo" column="ITEM_NO"/>
		<result property="cedingId" column="CEDING_ID"/>
		<result property="cedingName" column="CEDING_NAME"/>
		<result property="quarterEnding" column="QUARTER_ENDING" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<result property="currCd" column="CURR_CD"/>
		<result property="currRate" column="CURR_RATE"/>
		<result property="interestAmt" column="INTEREST_AMT"/>
		<result property="whtaxAmt" column="WHTAX_AMT"/>
		<result property="releaseAmt" column="RELEASE_AMT"/>
		<result property="createUser" column="CREATE_USER"/>
		<result property="createDate" column="CREATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<result property="updateUser" column="UPDATE_USER"/>
		<result property="updateDate" column="UPDATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
	</resultMap>
	
	<select id="retrieveAcitJVPremResRel" resultMap="premResMap" parameterType="java.util.Map">
		SELECT * FROM TABLE(ACIT_JOURNAL_VOUCHER_PKG.ret_acit_jv_premrr(
					#{tranId},
					#{cedingId, jdbcType=VARCHAR},
					'', '', '',''))
	</select>

	 <update id="saveAcitPrqTrans" parameterType="java.util.Map">
    	BEGIN
    		<foreach collection="savePrqTrans" item="save">
	    		ACIT_PRQ_TRANS_PKG.save_acit_prq_trans(
	    			#{save.reqId, jdbcType=INTEGER},
					#{save.itemNo, jdbcType=INTEGER},
					#{save.claimId, jdbcType=INTEGER},
					#{save.projId, jdbcType=INTEGER},
					#{save.histNo, jdbcType=INTEGER},
					#{save.policyId, jdbcType=INTEGER},
					#{save.instNo, jdbcType=INTEGER},
					CAST(to_timestamp(#{save.quarterEnding}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
					#{save.invtId, jdbcType=INTEGER},
					#{save.refNo, jdbcType=VARCHAR},
					#{save.itemName, jdbcType=VARCHAR},
					#{save.paymentFor, jdbcType=VARCHAR},
					#{save.currCd, jdbcType=VARCHAR},
					#{save.currRate, jdbcType=INTEGER},
					#{save.currAmt, jdbcType=INTEGER},
					#{save.localAmt, jdbcType=INTEGER},
					#{save.remarks, jdbcType=VARCHAR},
			        #{save.createUser,jdbcType=VARCHAR},
			        CAST(to_timestamp(#{save.createDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
			        #{save.updateUser,jdbcType=VARCHAR},
			        CAST(to_timestamp(#{save.updateDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE)
	    		);
    		</foreach>
    		<foreach collection="deletePrqTrans" item="del">
    			ACIT_PRQ_TRANS_PKG.del_acit_prq_trans(
    				#{del.reqId, jdbcType=INTEGER},
					#{del.itemNo, jdbcType=INTEGER});
    		</foreach>
    	END;
    </update>

	<update id="cancelCMDM" parameterType="java.util.Map">
		BEGIN
			ACIT_CRDR_MEMO_PKG.cancel_memo(#{tranId},#{updateUser},CAST(to_timestamp(#{updateDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE));
		END;
	</update>
	
	<update id="printCMDM" parameterType="java.util.Map">
		BEGIN
			ACIT_CRDR_MEMO_PKG.print_memo(#{tranId},#{updateUser},CAST(to_timestamp(#{updateDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE));
		END;
	</update>
	
	<update id="cancelAr" parameterType="java.util.Map">
		BEGIN
			ACIT_ACKGT_RECEIPT_PKG.cancel_ar(#{tranId},#{updateUser},CAST(to_timestamp(#{updateDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE));
		END;
	</update>
	
	<resultMap type="ph.cpi.rest.api.model.accountingintrust.AcitSOAAgingDetails" id="agingSoaDtlMap">
		<result property="policyId" 			column="POLICY_ID"/>
		<result property="cedingId" 			column="CEDING_ID"/>
		<result property="refCd" 				column="REF_CD"/>
		<result property="payeeNo" 				column="PAYEE_NO"/>
		<result property="payeeName" 			column="PAYEE_NAME"/>
		<result property="policyNo" 			column="POLICY_NO"/>
		<result property="soaNo" 				column="SOA_NO"/>
		<result property="coRefNo" 				column="CO_REF_NO"/>
		<result property="instNo" 				column="INST_NO"/>
		<result property="currCd" 				column="CURR_CD"/>
		<result property="currRate" 			column="CURR_RATE"/>
		<result property="prevPremAmt" 			column="PREV_PREMIUM"/>
		<result property="prevRiComm" 			column="PREV_RI_COMM"/>
		<result property="prevRiCommVat" 		column="PREV_RI_COMM_VAT"/>
		<result property="prevCharges" 			column="PREV_CHARGES"/>
		<result property="prevNetDue" 			column="PREV_NET_DUE"/>
		<result property="cumPayment" 			column="PREV_CUM_PAYMENT"/>
		<result property="prevBalance"				column="PREV_BALANCE"/>
		<result property="totalAmtDue" 			column="TOTAL_AMT_DUE"/>
		<result property="totalPayments" 		column="TOTAL_PAYMENTS"/>
		<result property="tempPayments" 		column="TEMP_PAYMENTS"/>
		<result property="netDuePayments" 		column="NET_DUE_PAYMENTS"/>
		<result property="balAmtDue" 			column="BAL_AMT_DUE"/>
		<result property="balPremDue" 			column="BAL_PREM_DUE"/>
		<result property="balChargesDue" 		column="BAL_CHARGES_DUE"/>
		<result property="balRiComm" 			column="BAL_RI_COMM"/>
		<result property="balRiCommVat" 		column="BAL_RI_COMM_VAT"/>
		<result property="balOverdueInt" 		column="BAL_OVERDUE_INT"/>
		<result property="effDate" 				column="EFF_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<result property="dueDate" 				column="DUE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<result property="bookingDate" 			column="BOOKING_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<result property="agingId" 				column="AGING_ID"/>
		<result property="netDue" 				column="NET_DUE"/>
		<result property="balance" 				column="BALANCE"/>
		<result property="createUser" 			column="CREATE_USER"/>
		<result property="createDate" 			column="CREATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<result property="updateUser" 			column="UPDATE_USER"/>
		<result property="updateDate" 			column="UPDATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
	</resultMap>
	
	<select id="retrieveAcitAgingSoaDtl" resultMap="agingSoaDtlMap" parameterType="java.util.Map">
		SELECT * FROM TABLE(ACIT_AGING_SOA_DETAILS_PKG.ret_soa_dtl(
																	#{policyId, jdbcType=VARCHAR},
																	#{instNo,jdbcType=VARCHAR},
																	#{cedingId,jdbcType=VARCHAR},
																	#{payeeNo, jdbcType=VARCHAR},
																	#{zeroBal, jdbcType=INTEGER},
																	#{currCd}))
	</select>
	
	<update id="saveArInwPolBal" parameterType="java.util.Map" statementType="CALLABLE">
		DECLARE
			v_message		    VARCHAR2(500);
			v_new_prem_amt      ACIT_AGING_SOA_DETAILS.BAL_PREM_DUE%TYPE;
	        v_new_ri_comm       ACIT_AGING_SOA_DETAILS.BAL_RI_COMM%TYPE;
	        v_new_ri_comm_vat   ACIT_AGING_SOA_DETAILS.BAL_RI_COMM_VAT%TYPE;
	        v_new_charges       ACIT_AGING_SOA_DETAILS.BAL_CHARGES_DUE%TYPE;
	        v_total_payts	NUMBER(16,2);
			v_ar_amt		NUMBER(16,2);
			v_new_netdue	ACIT_AGING_SOA_DETAILS.BAL_AMT_DUE%TYPE;
		BEGIN
			SELECT NVL(SUM(TOTAL_LOCAL_AMT), 0)
			  INTO v_total_payts
			  FROM ACIT_AR_TRANSUMM
			 WHERE TRAN_ID = #{tranId};
			
			SELECT AR_AMT * CURR_RATE
			  INTO v_ar_amt
			  FROM ACIT_ACKGT_RECEIPT
			 WHERE TRAN_ID = #{tranId};
			 
			 IF (#{totalLocalAmt} - v_total_payts) + v_total_payts <![CDATA[ <= ]]> v_ar_amt THEN
				<!-- Save to ACIT_AR_TRANSUMM -->
				ACIT_AR_TRANSUMM_PKG.save_acit_transumm(#{tranId},
														#{billId},
														#{billType},
														#{totalLocalAmt},
														#{allotedAmt},
														#{createUser},
														CAST(to_timestamp(#{createDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
														#{updateUser},
														CAST(to_timestamp(#{updateDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE)
														);
			    
				<!-- Delete from ACIT_AR_INWPOLBAL -->
				<foreach collection="delInwPolBal" item="del">
				<!-- Insert something about resetting the SOA Details here -->
					ACIT_AGING_SOA_DETAILS_PKG.reset_soa(
														  #{del.tranId},
														  #{del.policyId},
														  #{del.instNo},
														  #{del.premAmt},
														  #{del.riComm},
														  #{del.riCommVat},
														  #{del.charges},
														  #{del.netDue});
					ACIT_AR_INWPOLBAL_PKG.del_ar_inwpolbal(
														#{del.tranId},
														#{del.billId},
														#{del.itemNo}				
					);
					<!-- DELETE FROM ACIT_INWPOL_PAYTS -->
					ACIT_INWPOL_PAYTS_PKG.del_inwpol_payts(
															#{del.tranId},
															#{del.policyId},
															#{del.instNo}
					);
					
				</foreach>
				
				<foreach collection="saveInwPolBal" item="save">
				<!-- UPDATE AGING SOA DETAILS -->
					ACIT_AGING_SOA_DETAILS_PKG.save_aging_soa_dtl_test(
																  #{save.policyId},
																  #{save.instNo},
																  #{save.premAmt},
																  #{save.riComm},
																  #{save.riCommVat},
																  #{save.charges},
																  #{save.balPaytAmt},
																  #{save.updateUser},
																  CAST(to_timestamp(#{save.updateDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE)
															      );
					<!-- Save from ACIT_AR_INWPOLBAL -->										      
					ACIT_AR_INWPOLBAL_PKG.save_ar_inwpolbal(
														#{save.tranId},
														#{save.billId},
														#{save.itemNo},
														#{save.policyId},
														#{save.instNo},
														#{save.currCd},
														#{save.currRate},
														#{save.premAmt},
														#{save.riComm},
													    #{save.riCommVat},
														#{save.charges},
														#{save.netDue},
														#{save.balPaytAmt},
														#{save.createUser},
														CAST(to_timestamp(#{save.createDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
														#{save.updateUser},
														CAST(to_timestamp(#{save.updateDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE)				
					);
					
					<!-- INSERT OR UPDATE TO ACIT_INWPOL_PAYTS -->
					ACIT_INWPOL_PAYTS_PKG.save_inwpol_payts(
															#{save.tranId},
															#{save.policyId},
															#{save.instNo},
															1, <!-- PAYT TYPE 1 FOR AR. CHANGE AS NECESSARY -->
															1 <!-- AR -->
					);
				</foreach>
				
				<!-- Generate to Amount Details -->
					<!-- GENERATE_DEFAULT_AMT('AR', #{billType}, #{tranId}, #{updateUser}); -->
				<!-- Generate to Accounting Entries -->
				GENERATE_ACCIT_ENTRIES.SAVE_FINAL_ACCT_ENTRIES('AR', #{billType}, #{tranId}, v_message);
			ELSE
				#{custReturnCode, mode=OUT, jdbcType=VARCHAR} := 2; <!-- if return code is 2, cannot save -->
			END IF;
		END;
	</update>
	
	<resultMap type="ph.cpi.rest.api.model.accountingintrust.AcitArInwPolBal" id="arInwPolBalMap">
		<result property="tranId"           column="TRAN_ID" />
		<result property="billId"           column="BILL_ID" />
		<result property="itemNo"           column="ITEM_NO" />
		<result property="policyId"         column="POLICY_ID" />
		<result property="policyNo"         column="POLICY_NO" />
		<result property="soaNo"            column="SOA_NO" />
		<result property="coRefNo"          column="CO_REF_NO" />
		<result property="instNo"           column="INST_NO" />
		<result property="currCd"           column="CURR_CD" />
		<result property="currRate"         column="CURR_RATE" />
		<result property="totalPayments"    column="TOTAL_PAYMENTS" />
		<result property="tempPayments"     column="TEMP_PAYMENTS" />
		
		<result property="prevPremAmt"      column="PREV_PREMIUM" />
		<result property="prevCharges"      column="PREV_CHARGES" />
		<result property="prevRiComm"       column="PREV_RI_COMM" />
		<result property="prevRiCommVat"    column="PREV_RI_COMM_VAT" />
		<result property="prevNetDue"       column="PREV_NET_DUE" />
		<result property="prevCumPayment"   column="PREV_CUM_PAYMENT" />
		<result property="prevBalance"      column="PREV_BALANCE" />
		
		<result property="premAmt"          column="PREM_AMT" />
		<result property="charges"          column="CHARGES" />
		<result property="riComm"           column="RI_COMM" />
		<result property="riCommVat"        column="RI_COMM_VAT" />
		<result property="overdueInt"       column="OVERDUE_INT" />
		<result property="effDate"          column="EFF_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" />
		<result property="dueDate"          column="DUE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" />
		<result property="bookingDate"      column="BOOKING_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" />
		<result property="netDue"           column="NET_DUE" />
		<result property="balPaytAmt"       column="BAL_PAYT_AMT" />
		<result property="createUser"       column="CREATE_USER" />
		<result property="createDate"       column="CREATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" />
		<result property="updateUser"       column="UPDATE_USER" />
		<result property="updateDate"       column="UPDATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" />
		<result property="allotedAmt"       column="ALLOTED_AMT"  />
	</resultMap>
	
	<select id="retrieveArInwPolBal" resultMap="arInwPolBalMap" parameterType="java.util.Map">
		SELECT * FROM TABLE(ACIT_AR_INWPOLBAL_PKG.ret_ar_inwpolbal(
																	#{tranId},
																	#{billId}
																   ))
	</select>
	
	<resultMap type="ph.cpi.rest.api.model.accountingintrust.AcitArTransDtl" id="arTransDtlMap">
		<result property="tranId"			column="TRAN_ID" />
		<result property="billId"			column="BILL_ID" />
		<result property="itemNo"			column="ITEM_NO" />
		<result property="itemName"			column="ITEM_NAME" />
		<result property="currCd"			column="CURR_CD" />
		<result property="currRate"			column="CURR_RATE" />
		<result property="currAmt"			column="CURR_AMT" />
		<result property="localAmt"			column="LOCAL_AMT" />
		<result property="refNo"			column="REF_NO" />
		<result property="remarks"			column="REMARKS" />
		<result property="createUser"		column="CREATE_USER" />
		<result property="createDate"		column="CREATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" />
		<result property="updateUser"		column="UPDATE_USER" />
		<result property="updateDate"		column="UPDATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" />
	</resultMap>
	
	<select id="retrieveArTransDtl" resultMap="arTransDtlMap" parameterType="java.util.Map">
		SELECT * FROM TABLE(ACIT_AR_TRANSDTL_PKG.ret_ar_transdtl(
																	#{tranId},
																	#{billId}
																 ))
	</select>
	
	<update id="saveArTransDtl" parameterType="java.util.Map" statementType="CALLABLE">
		DECLARE
			v_total_payts	NUMBER(16,2);
			v_ar_amt		NUMBER(16,2);
			v_message		VARCHAR2(500);
		BEGIN
			SELECT NVL(SUM(TOTAL_LOCAL_AMT), 0)
			  INTO v_total_payts
			  FROM ACIT_AR_TRANSUMM
			 WHERE TRAN_ID = #{tranId};
			
			SELECT AR_AMT
			  INTO v_ar_amt
			  FROM ACIT_ACKGT_RECEIPT
			 WHERE TRAN_ID = #{tranId};
			 
			 IF (#{totalLocalAmt} - v_total_payts) + v_total_payts <![CDATA[ <= ]]> v_ar_amt THEN
				<!-- Save to ACIT_AR_TRANSUMM -->
				ACIT_AR_TRANSUMM_PKG.save_acit_transumm(#{tranId},
														#{billId},
														#{billType},
														#{totalLocalAmt},
														null,
														#{createUser},
														CAST(to_timestamp(#{createDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
														#{updateUser},
														CAST(to_timestamp(#{updateDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE)
														);
				<!-- Delete from ACIT_AR_TRANSDTL -->
				<foreach collection="delTransDtl" item="del">
					ACIT_AR_TRANSDTL_PKG.del_ar_transdtl(
														#{del.tranId},
														#{del.billId},
														#{del.itemNo}				
					);
					
				</foreach>
				<!-- Save from ACIT_AR_TRANSDTL -->
				<foreach collection="saveTransDtl" item="save">
					ACIT_AR_TRANSDTL_PKG.save_ar_transdtl(
														#{save.tranId},
														#{save.billId},
														#{save.itemNo},
														#{save.itemName},
														#{save.currCd},
														#{save.currRate},
														#{save.currAmt},
														#{save.localAmt},
														#{save.refNo, jdbcType=VARCHAR},
														#{save.remarks, jdbcType=VARCHAR},
														#{save.createUser},
														CAST(to_timestamp(#{save.createDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
														#{save.updateUser},
														CAST(to_timestamp(#{save.updateDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE)				
					);
				</foreach>
				<!-- Generate to Amount Details -->
				<!-- GENERATE_DEFAULT_AMT('AR', #{billType}, #{tranId}, #{updateUser}); -->
				<!-- Generate to Accounting Entries -->
				GENERATE_ACCIT_ENTRIES.SAVE_FINAL_ACCT_ENTRIES('AR', #{billType}, #{tranId}, v_message);
			ELSE
				#{custReturnCode, mode=OUT, jdbcType=VARCHAR} := 2; <!-- if return code is 2, cannot save -->
			END IF;
		END;
	</update>
	
	<resultMap type="ph.cpi.rest.api.model.accountingintrust.AcitAllInvtIncome" id="acitAllInvtIncomeList">
		<result property="tranId" 						column="TRAN_ID"/>
		<result property="tranClass" 					column="TRAN_CLASS"/>
		<result property="tranNo" 						column="TRAN_NO"/>
		<result property="tranDate" 					column="TRAN_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" />
		<result property="payor" 						column="PAYOR"/>
		<result property="arStatus" 					column="AR_STATUS"/>
		<result property="statusDesc" 					column="STATUS_DESC"/>
		<result property="particulars" 					column="PARTICULARS"/>
		<result property="bankCharge" 					column="BANK_CHARGE"/>
		<result property="whtaxAmt" 					column="WHTAX_AMT"/>
		<result property="incomeAmt" 					column="INCOME_AMT"/>
		<result property="invtId" 						column="INVT_ID"/>
		<result property="currCd" 						column="CURR_CD"/>
		<result property="currRate" 					column="CURR_RATE"/>
	</resultMap>
	
	<select id="retrieveAcitAllInvestmentIncome" resultMap="acitAllInvtIncomeList" parameterType="java.util.Map">
		SELECT * FROM TABLE(ACIT_ALL_INVT_INC_PKG.ret_all_invt_inc_list(
					CAST(to_timestamp(#{tranDateFrom,jdbcType=DATE}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
					CAST(to_timestamp(#{tranDateTo,jdbcType=DATE}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
					#{tranMonth, jdbcType=VARCHAR},
					#{tranYear, jdbcType=VARCHAR},
					CAST(to_timestamp(#{tranDate,jdbcType=DATE}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
					'', '', '',''))
	</select>
	
		<select id="retrieveAcitAllInvestmentIncomeInvtId" resultMap="acitAllInvtIncomeList" parameterType="java.util.Map">
		SELECT * FROM TABLE(ACIT_ALL_INVT_INC_PKG.ret_all_invt_inc_invtid(
					#{tranId, jdbcType=VARCHAR},
					'', '', '',''))
	</select>

	<resultMap type="ph.cpi.rest.api.model.accountingintrust.AcitAcctEntries" id="AcctEntriesMap">
		<result property="tranId"  column="TRAN_ID"/>
		<result property="entryId"  column="ENTRY_ID"/>
		<result property="glAcctId"  column="GL_ACCT_ID"/>
		<result property="glShortCd"  column="GL_SHORT_CD"/>
		<result property="glShortDesc"  column="GL_SHORT_DESC"/>
		<result property="slTypeCd"  column="SL_TYPE_CD"/>
		<result property="slTypeName"  column="SL_TYPE_NAME"/>
		<result property="slCd"  column="SL_CD"/>
		<result property="slName"  column="SL_NAME"/>
		<result property="creditAmt"  column="CREDIT_AMT"/>
		<result property="debitAmt"  column="DEBIT_AMT"/>
		<result property="autoTag"  column="AUTO_TAG"/>
		<result property="createUser"  column="CREATE_USER"/>
		<result property="createDate"  column="CREATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<result property="updateUser"  column="UPDATE_USER"/>
		<result property="updateDate"  column="UPDATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<result property="updateLevel"  column="UPDATE_LEVEL"/>
	</resultMap>
	
	<select id="retrieveAcitAcctEntries" resultMap="AcctEntriesMap">
		SELECT * FROM TABLE(ACIT_ACCT_ENTRIES_PKG.ret_acit_acc_entries(#{tranId, jdbcType=VARCHAR},#{entryId, jdbcType=VARCHAR},#{glAcctId, jdbcType=VARCHAR},#{slTypeCd, jdbcType=VARCHAR},#{slCd, jdbcType=VARCHAR}))
	</select>
	
	<resultMap type="ph.cpi.rest.api.model.accountingintrust.QSOA" id="qsoaMap">
		<result property="qsoaId" 			column="QSOA_ID"/>
		<result property="cedingId" 		column="CEDING_ID"/>
		<result property="cedingName" 		column="CEDING_NAME"/>
		<result property="quarterEnding" 	column="QUARTER_ENDING" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<result property="qsoaStatus" 		column="QSOA_STATUS"/>
		<result property="qsoaStatusDesc" 	column="QSOA_STATUS_DESC"/>
		<result property="refNoTranId" 		column="REF_NO_TRAN_ID"/>
		<result property="refNoDate" 		column="REF_NO_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<result property="totalDebitAmt" 	column="TOTAL_DEBIT_AMT"/>
		<result property="totalCreditAmt" 	column="TOTAL_CREDIT_AMT"/>
		<result property="createUser" 		column="CREATE_USER"/>
		<result property="createDate" 		column="CREATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<result property="updateUser" 		column="UPDATE_USER"/>
		<result property="updateDate" 		column="UPDATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
	</resultMap>
	
	<select id="retrieveQSOAList" resultMap="qsoaMap">
		SELECT * FROM TABLE(ACIT_QSOA_PKG.ret_comp_qsoa_list(#{qsoaId, jdbcType=INTEGER},
															 #{cedingId, jdbcType=VARCHAR},
															 #{fromQtr, jdbcType=INTEGER},
															 #{fromYear, jdbcType=INTEGER},
															 #{toQtr, jdbcType=INTEGER},
															 #{toYear, jdbcType=INTEGER},
															 null,null,null,null))
	</select>
	
	<update id="saveAcitAcctEntries" parameterType="java.util.Map">
		BEGIN
			NULL;
			<foreach collection="delList" item="item">
				ACIT_ACCT_ENTRIES_PKG.del_acct_acc_entries(#{item.tranId, jdbcType=VARCHAR},
					#{item.entryId, jdbcType=VARCHAR});
			</foreach>
			<foreach collection="saveList" item="item">
				ACIT_ACCT_ENTRIES_PKG.save_acit_acc_entries(
					#{item.tranId, jdbcType=VARCHAR},
					#{item.entryId, jdbcType=VARCHAR},
					#{item.glAcctId, jdbcType=VARCHAR},
					#{item.slTypeCd, jdbcType=VARCHAR},
					#{item.slCd, jdbcType=VARCHAR},
					#{item.creditAmt, jdbcType=VARCHAR},
					#{item.debitAmt, jdbcType=VARCHAR},
					#{item.autoTag, jdbcType=VARCHAR},
					#{item.createUser, jdbcType=VARCHAR},
					CAST(to_timestamp(#{item.createDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
					#{item.updateUser, jdbcType=VARCHAR},
					CAST(to_timestamp(#{item.updateDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE)
				);
			</foreach>
		END;
	</update>
	
	<update id="saveAcitJVPremResRel" parameterType="java.util.Map">
		DECLARE
			v_message		VARCHAR2(500);
		BEGIN
			<foreach collection="deletePremResRel" item="del">
				ACIT_JOURNAL_VOUCHER_PKG.del_acit_prr(#{del.tranId},
					#{del.itemNo});
			</foreach>
			
			<foreach collection="savePremResRel" item="save">
				ACIT_JOURNAL_VOUCHER_PKG.save_acit_prr(
					#{save.tranId},
					#{save.cedingId},
					#{save.itemNo,jdbcType=INTEGER},
					CAST(to_timestamp(#{save.quarterEnding}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
					#{save.currCd},
					#{save.currRate},
					#{save.interestAmt},
					#{save.whtaxAmt},
					#{save.releaseAmt},
					#{save.createUser},
					CAST(to_timestamp(#{save.createDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
					#{save.updateUser},
					CAST(to_timestamp(#{save.updateDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
					#{save.totalInterestAmt},
					#{save.totalWhtaxAmt}
				);
			</foreach>
			GENERATE_ACCIT_ENTRIES.SAVE_FINAL_ACCT_ENTRIES('JV', #{tranType}, #{tranId}, v_message);
		END;
	</update>
	
	<update id="cancelJV" parameterType="java.util.Map">
		BEGIN
			ACIT_JOURNAL_VOUCHER_PKG.cancel_jv(#{tranId},#{jvYear},#{jvNo},#{updateUser},
											   CAST(to_timestamp(#{updateDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE) );
					
		END;
	</update>
	
	<update id="printJV" parameterType="java.util.Map">
		BEGIN
			ACIT_JOURNAL_VOUCHER_PKG.print_jv(#{tranId},#{jvYear},#{jvNo},#{updateUser},
											   CAST(to_timestamp(#{updateDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE) );
					
		END;
	</update>

	<resultMap type="ph.cpi.rest.api.model.accountingintrust.AcitProfCommDtl" id="acitProfCommDtl">
		<result property="profCommId" 					column="PROFCOMM_ID"/>
		<result property="itemNo" 						column="ITEM_NO"/>
		<result property="particulars" 					column="PARTICULARS"/>
		<result property="actualAmt" 					column="ACTUAL_AMT"/>
		<result property="natcatAmt" 					column="NATCAT_AMT"/>
		<result property="income" 						column="INCOME"/>
		<result property="outgo" 						column="OUTGO"/>
		<result property="createUser" 					column="CREATE_USER"/>
		<result property="createDate" 					column="CREATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" />
		<result property="updateUser" 					column="UPDATE_USER"/>
		<result property="updateDate" 					column="UPDATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" />
	</resultMap>
	
	<select id="retrieveProfCommSumm" resultMap="acitProfCommSumm" parameterType="java.util.Map">
		SELECT * FROM TABLE(ACIT_PROFCOMM_PKG.ret_profcomm_summ(
					#{profcommId,jdbcType=INTEGER},
					#{cedingId, jdbcType=VARCHAR},
					#{month, jdbcType=VARCHAR},
					#{year, jdbcType=VARCHAR},
					'', '', '',''))
	</select>
	
	<select id="retrieveProfCommDtl" resultMap="acitProfCommDtl" parameterType="java.util.Map">
		SELECT * FROM TABLE(ACIT_PROFCOMM_PKG.ret_profcomm_dtl(
					#{profcommId,jdbcType=INTEGER},
					'', '', '',''))
	</select>
	
	<resultMap type="ph.cpi.rest.api.model.accountingintrust.AcitPrqInwPol" id="acitPrqInwPolMap">
		<result property="reqId"		column="REQ_ID"/>			
		<result property="itemNo"		column="ITEM_NO"/>			
		<result property="premAmt"		column="PREM_AMT"/>		
		<result property="riComm"		column="RI_COMM"/>			
		<result property="riCommVat"	column="RI_COMM_VAT"/>		
		<result property="prevPaytAmt"	column="PREV_PAYT_AMT"/>	
		<result property="netDue"		column="NET_DUE"/>			
		<result property="charges"		column="CHARGES"/>			
		<result property="returnAmt"	column="RETURN_AMT"/>		
		<result property="createUser" 	column="CREATE_USER"/>
		<result property="createDate" 	column="CREATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" />
		<result property="updateUser" 	column="UPDATE_USER"/>
		<result property="updateDate" 	column="UPDATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" />	
	</resultMap>
	
	<select id="retrieveAcitPrqInwPol" resultMap="acitPrqInwPolMap" parameterType="java.util.Map">
		SELECT * FROM TABLE(ACIT_PRQ_INWPOL_PKG.ret_prq_inwpol(
					#{reqId,jdbcType=INTEGER},
					#{itemNo,jdbcType=INTEGER},
					'', '', '',''))
	</select>
	
	<update id="saveAcitPrqInwPol" parameterType="java.util.Map">
    	BEGIN
    		<foreach collection="saveAcitPrqInwPol" item="save">
	    		ACIT_PRQ_INWPOL_PKG.save_prq_inwpol(
	    			#{save.reqId, jdbcType=INTEGER},
					#{save.itemNo, jdbcType=INTEGER},
					#{save.premAmt, jdbcType=INTEGER},
					#{save.riComm, jdbcType=INTEGER},
					#{save.riCommVat, jdbcType=INTEGER},
					#{save.prevPaytAmt, jdbcType=INTEGER},
					#{save.netDue, jdbcType=INTEGER},
					#{save.charges, jdbcType=INTEGER},
					#{save.returnAmt, jdbcType=INTEGER},
					#{save.createUser, jdbcType=INTEGER},
					CAST(to_timestamp(#{save.createDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
					#{save.updateUser,jdbcType=VARCHAR},
					CAST(to_timestamp(#{save.updateDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE)
	    		);
    		</foreach>
    		<foreach collection="deleteAcitPrqInwPol" item="del">
    			ACIT_PRQ_INWPOL_PKG.del_prq_inwpol(
    				#{del.reqId, jdbcType=INTEGER},
					#{del.itemNo, jdbcType=INTEGER});
    		</foreach>
    	END;
    </update>
    
    <resultMap type="ph.cpi.rest.api.model.accountingintrust.AcctServFeeDist" id="servFeeDistMap">
		<result property="reqId" 		column="REQ_ID"/>
		<result property="sfeeMm" 		column="SFEE_MM"/>
		<result property="sfeeYear" 	column="SFEE_YEAR"/>
		<result property="groupId" 		column="GROUP_ID"/>
		<result property="groupName" 	column="GROUP_NAME"/>
		<result property="groupShrPct" 	column="GROUP_SHR_PCT"/>
		<result property="currCd" 		column="CURR_CD"/>
		<result property="currRt" 		column="CURR_RT"/>
		<result property="groupShrAmt" 	column="GROUP_SHR_AMT"/>
		<result property="localAmt" 	column="LOCAL_AMT"/>
		<result property="totalSfee" 	column="TOTAL_SFEE"/>
		<result property="createUser" 	column="CREATE_USER"/>
		<result property="createDate" 	column="CREATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<result property="updateUser" 	column="UPDATE_USER"/>
		<result property="updateDate" 	column="UPDATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		
		<result property="cedingId" 	column="CEDING_ID"/>
		<result property="cedingName" 	column="CEDING_NAME"/>
		<result property="actualShrPct" column="ACTUAL_SHR_PCT"/>
		<result property="actualShrAmt" column="ACTUAL_SHR_AMT"/>
		<result property="baseShrPct" 	column="BASE_SHR_PCT"/>
		<result property="baseShrAmt" 	column="BASE_SHR_AMT"/>
	</resultMap>
	
	<select id="retrieveAcitServFeeMainGnrt" resultMap="servFeeDistMap" parameterType="java.util.Map">
		SELECT * FROM TABLE(ACCT_SERVFEE_MAIN_DIST_PKG.ret_servfee_main_gnrt(#{servFeeAmt, jdbcType=INTEGER},
																			 #{currCd, jdbcType=VARCHAR},
																			 #{currRt, jdbcType=INTEGER},
																			 null,null,null,null))
	</select>
	
	<resultMap type="ph.cpi.rest.api.model.accountingintrust.AcitArClmRecover" id="arClmRecMap">
		<result property="tranId"			column="TRAN_ID" />
		<result property="billId"			column="BILL_ID" />
		<result property="itemNo"			column="ITEM_NO" />
		<result property="claimId"			column="CLAIM_ID" />
		<result property="claimNo"			column="CLAIM_NO" />
		<result property="paytType"			column="PAYT_TYPE" />
		<result property="paytTypeName"		column="PAYT_TYPE_NAME" />
		<result property="coClmNo"			column="CO_CLM_NO" />
		<result property="policyId"			column="POLICY_ID" />
		<result property="policyNo"			column="POLICY_NO" />
		<result property="lossDate"			column="LOSS_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" />
		<result property="currCd"			column="CURR_CD" />
		<result property="currRate"			column="CURR_RATE" />
		<result property="recOverAmt"		column="REC_OVER_AMT" />
		<result property="localAmt"			column="LOCAL_AMT" />
		<result property="remarks"			column="REMARKS" />
		<result property="createUser"		column="CREATE_USER" />
		<result property="createDate"		column="CREATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" />
		<result property="updateUser"		column="UPDATE_USER" />
		<result property="updateDate"		column="UPDATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
	</resultMap>
	
	<select id="retrieveAcitArClmRecover" resultMap="arClmRecMap" parameterType="java.util.Map">
		SELECT * FROM TABLE(ACIT_AR_CLMRECOVER_PKG.ret_ar_clmrecover(
																		#{tranId},
																		#{billId}
																	)
							)
	</select>
	
	<resultMap type="ph.cpi.rest.api.model.accountingintrust.AcitArClmRecoverLov" id="arClmRecLovMap">
		<result property="claimId"	column="CLAIM_ID" />
		<result property="claimNo"	column="CLAIM_NO" />
		<result property="coClmNo"	column="CO_CLM_NO" />
		<result property="policyId"	column="POLICY_ID" />
		<result property="policyNo"	column="POLICY_NO" />
		<result property="lossDate"	column="LOSS_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" />
		<result property="currCd"	column="CURR_CD" />
		<result property="currRate"	column="CURR_RATE" />
	</resultMap>
	
	<select id="retrieveAcitArClmRecoverLov" resultMap="arClmRecLovMap" parameterType="java.util.Map">
		SELECT * FROM TABLE(ACIT_AR_CLMRECOVER_PKG.ret_clm_lov(
																#{payeeNo}
															  )
							)
	</select>
	
	<update id="saveArClmRecover" parameterType="java.util.Map" statementType="CALLABLE">
		DECLARE
			v_total_payts	NUMBER(16,2);
			v_ar_amt		NUMBER(16,2);
			v_message		VARCHAR2(500);
		BEGIN
			SELECT NVL(SUM(TOTAL_LOCAL_AMT), 0)
			  INTO v_total_payts
			  FROM ACIT_AR_TRANSUMM
			 WHERE TRAN_ID = #{tranId};
			
			SELECT AR_AMT * CURR_RATE
			  INTO v_ar_amt
			  FROM ACIT_ACKGT_RECEIPT
			 WHERE TRAN_ID = #{tranId};
			 
			 IF (#{totalLocalAmt} - v_total_payts) + v_total_payts <![CDATA[ <= ]]> v_ar_amt THEN
				<!-- Save to ACIT_AR_TRANSUMM -->
				ACIT_AR_TRANSUMM_PKG.save_acit_transumm(#{tranId},
														#{billId},
														#{billType},
														#{totalLocalAmt},
														null,
														#{createUser},
														CAST(to_timestamp(#{createDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
														#{updateUser},
														CAST(to_timestamp(#{updateDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE)
														);
				<!-- Delete from ACIT_AR_CLMRECOVER -->
				<foreach collection="delClmRecover" item="del">
					ACIT_AR_CLMRECOVER_PKG.del_ar_clmrecover(
														#{del.tranId},
														#{del.billId},
														#{del.itemNo}				
					);
					
				</foreach>
				<!-- Save from ACIT_AR_CLM_RECOVER -->
				<foreach collection="saveClmRecover" item="save">
					ACIT_AR_CLMRECOVER_PKG.save_ar_clm_recover(
														#{save.tranId},
														#{save.billId},
														#{save.itemNo},
														#{save.claimId},
														#{save.paytType},
														#{save.currCd},
														#{save.currRate},
														#{save.recOverAmt},
														#{save.localAmt},
														#{save.remarks, jdbcType=VARCHAR},
														#{save.createUser},
														CAST(to_timestamp(#{save.createDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
														#{save.updateUser},
														CAST(to_timestamp(#{save.updateDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE)				
					);
				</foreach>
				<!-- Generate to Amount Details -->
				<!-- GENERATE_DEFAULT_AMT('AR', #{billType}, #{tranId}, #{updateUser}); -->
				<!-- Generate to Accounting Entries -->
				GENERATE_ACCIT_ENTRIES.SAVE_FINAL_ACCT_ENTRIES('AR', #{billType}, #{tranId}, v_message);
			ELSE
				#{custReturnCode, mode=OUT, jdbcType=VARCHAR} := 2; <!-- if return code is 2, cannot save -->
			END IF;
		END;
	</update>
	
	<resultMap type="ph.cpi.rest.api.model.accountingintrust.AcitArInvPullout" id="arInvPulloutMap">
		<result property="tranId"               column="TRAN_ID" />
		<result property="billId"               column="BILL_ID" />
		<result property="itemNo"               column="ITEM_NO" />
		<result property="invtId"               column="INVT_ID" />
		<result property="invtCode"             column="INVT_CODE" />
		<result property="certNo"               column="CERT_NO" />
		<result property="invtType"             column="INVT_TYPE" />
		<result property="invtTypeDesc"         column="INVT_TYPE_DESC" />
		<result property="invtSecCd"            column="INVT_SEC_CD" />
		<result property="securityDesc"         column="SECURITY_DESC" />
		<result property="maturityPeriod"       column="MATURITY_PERIOD" />
		<result property="durationUnit"         column="DURATION_UNIT" />
		<result property="interestRate"         column="INTEREST_RATE" />
		<result property="purchasedDate"        column="PURCHASED_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" />
		<result property="maturityDate"         column="MATURITY_DATE"  typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" />
		<result property="pulloutType"          column="PULLOUT_TYPE" />
		<result property="currCd"               column="CURR_CD" />
		<result property="currRate"             column="CURR_RATE" />
		<result property="invtAmt"              column="INVT_AMT" />
		<result property="incomeAmt"            column="INCOME_AMT" />
		<result property="bankCharge"           column="BANK_CHARGE" />
		<result property="whtaxAmt"             column="WHTAX_AMT" />
		<result property="maturityValue"        column="MATURITY_VALUE" />
		<result property="createUser"           column="CREATE_USER" />
		<result property="createDate"           column="CREATE_DATE"    typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" />
		<result property="updateUser"           column="UPDATE_USER" />
		<result property="updateDate"           column="UPDATE_DATE"    typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" />
	</resultMap>
	
	<select id="retrieveArInvpullout" resultMap="arInvPulloutMap">
		SELECT * FROM TABLE(ACIT_AR_INVPULLOUT_PKG.ret_ar_invpullout(#{tranId},#{billId},#{pulloutType, jdbcType=VARCHAR}))
	</select>

	<resultMap type="ph.cpi.rest.api.model.accountingintrust.AcitJVAppPaymentZeroBal" id="zeroBalMap">
		<result property="tranId" column="PWZB_TRAN_ID"/>
		<result property="itemNo" column="PWZB_ITEM_NO"/>
		<result property="cedingId" 		column="CEDING_ID"/>
		<result property="cedingName" 		column="CEDING_NAME"/>
		<result property="policyId" column="PWZB_POLICY_ID"/>
		<result property="policyNo" column="PWZB_POLICY_NO"/>
		<result property="soaNo" column="PWZB_SOA_NO"/>
		<result property="coRefNo" column="PWZB_CO_REF_NO"/>
		<result property="effDate" column="PWZB_EFF_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<result property="dueDate" column="PWZB_DUE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<result property="instNo" column="PWZB_INST_NO"/>
		<result property="currCd" column="PWZB_CURR_CD"/>
		<result property="currRate" column="PWZB_CURR_RATE"/>
		
		<result property="totalPayt" column="PREV_PREMIUM"/>
		<result property="remainingBal" column="PREV_RI_COMM"/>
		<result property="prevPremAmt" column="PREV_RI_COMM_VAT"/>
		<result property="prevRiComm" column="PREV_CHARGES"/>
		<result property="prevRiCommVat" column="PREV_NET_DUE"/>
		<result property="prevCharges" column="PREV_CUM_PAYMENT"/>
		<result property="prevNetDue" column="PREV_BALANCE"/>
		<result property="cumPayment" column="TOTAL_PAYMENTS"/>
		<result property="balance" column="REMAINING_BALANCE"/>
		
		<result property="premAmt" column="PWZB_PREM_AMT"/>
		<result property="riComm" column="PWZB_RI_COMM"/>
		<result property="riCommVat" column="PWZB_RI_COMM_VAT"/>
		<result property="charges" column="PWZB_CHARGES"/>
		<result property="netDue" column="PWZB_NET_DUE"/>
		<result property="prevPaytAmt" column="PWZB_PREV_PAYT_AMT"/>
		<result property="adjBalAmt" column="PWZB_ADJ_BAL_AMT"/>
		<result property="localAmt" column="PWZB_LOCAL_AMT"/>
		<result property="overdueInt" column="PWZB_OVERDUE_INT"/>
		<result property="createUser" column="PWZB_CREATE_USER"/>
		<result property="createDate" column="PWZB_CREATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<result property="updateUser" column="PWZB_UPDATE_USER"/>
		<result property="updateDate" column="PWZB_UPDATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
	</resultMap>
	
	<select id="retrieveAcitJVAppPaytZeroBal" resultMap="zeroBalMap" parameterType="java.util.Map">
		SELECT * FROM TABLE(ACIT_JOURNAL_VOUCHER_PKG.ret_acit_jv_pwzb(#{tranId},#{instNo,jdbcType=INTEGER},#{cedingId},null,null,null,null))
	</select>
	
	<update id="saveAcitJVAppPaytZeroBal" parameterType="java.util.Map">
		DECLARE
			v_message VARCHAR2(500);
		BEGIN
			<foreach collection="deleteZeroBal" item="delete">
				ACIT_JOURNAL_VOUCHER_PKG.del_acit_pwzb(#{delete.tranId}, #{delete.itemNo}
				);
			</foreach>
			
			<foreach collection="saveZeroBal" item="save">
				ACIT_JOURNAL_VOUCHER_PKG.save_acit_pwzb(#{save.tranId}, #{save.itemNo,jdbcType=INTEGER}, #{save.policyId}, #{save.instNo}, #{save.currCd}, 
													#{save.currRate}, #{save.premAmt}, #{save.riComm}, #{save.riCommVat}, #{save.charges}, 
													#{save.netDue}, #{save.prevPaytAmt}, #{save.localAmt}, #{save.adjBalAmt}, #{save.overdueInt,jdbcType=INTEGER}, #{save.createUser}, 
													CAST(to_timestamp(#{save.createDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
													#{save.updateUser}, 
													CAST(to_timestamp(#{save.updateDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE)
				);
				
				ACIT_INWPOL_PAYTS_PKG.save_inwpol_payts(
														#{save.tranId},
														#{save.policyId},
														#{save.instNo},
														2, <!-- PAYT TYPE 3 FOR JV. CHANGE AS NECESSARY -->
														3 
				);
			</foreach>
			GENERATE_ACCIT_ENTRIES.SAVE_FINAL_ACCT_ENTRIES('JV', #{tranType}, #{tranId}, v_message);
		END;
	</update>
	
	<resultMap type="ph.cpi.rest.api.model.accountingintrust.ACITSOATreatyDetails" id="soaTrtyMap">
		<result property="policyId" column="POLICY_ID"/>
		<result property="cedingId" column="CEDING_ID"/>
		<result property="refCd" column="REF_CD"/>
		<result property="payeeNo" column="PAYEE_NO"/>
		<result property="payeeName" column="PAYEE_NAME"/>
		<result property="policyNo" column="POLICY_NO"/>
		<result property="soaNo" column="SOA_NO"/>
		<result property="coRefNo" column="CO_REF_NO"/>
		<result property="instNo" column="INST_NO"/>
		<result property="currCd" column="CURR_CD"/>
		<result property="currRate" column="CURR_RATE"/>
		<result property="totalAmtDue" column="TOTAL_AMT_DUE"/>
		<result property="totalPayments" column="TOTAL_PAYMENTS"/>
		<result property="tempPayments" column="TEMP_PAYMENTS"/>
		<result property="netDuePayments" column="NET_DUE_PAYMENTS"/>
		<result property="trtyPrem" column="TRTY_PREM"/>
		<result property="trtyCharges" column="TRTY_CHARGES"/>
		<result property="trtyRiComm" column="TRTY_RI_COMM"/>
		<result property="trtyRiCommVat" column="TRTY_RI_COMM_VAT"/>
		<result property="balOverdueInt" column="BAL_OVERDUE_INT"/>
		<result property="effDate" column="EFF_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<result property="dueDate" column="DUE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<result property="bookingDate" column="BOOKING_DATE"/>
		<result property="agingId" column="AGING_ID"/>
		<result property="createUser" column="CREATE_USER"/>
		<result property="createDate" column="CREATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<result property="updateUser" column="UPDATE_USER"/>
		<result property="updateDate" column="UPDATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
	</resultMap>
	
	<select id="retrieveAcitSoaTrtyList" resultMap="soaTrtyMap" parameterType="java.util.Map">
		SELECT * FROM TABLE(ACIT_AGING_SOA_DETAILS_PKG.ret_soa_trty_dtl(#{policyId,jdbcType=INTEGER},#{instNo,jdbcType=INTEGER},#{cedingId,jdbcType=INTEGER},#{payeeNo,jdbcType=VARCHAR},#{zeroBal,jdbcType=INTEGER}))
	</select>

	<update id="saveArInvPullout" parameterType="java.util.Map" statementType="CALLABLE">
		DECLARE
			v_total_payts	NUMBER(16,2);
			v_ar_amt		NUMBER(16,2);
			v_message		VARCHAR2(500);
		BEGIN
			SELECT NVL(SUM(TOTAL_LOCAL_AMT), 0)
			  INTO v_total_payts
			  FROM ACIT_AR_TRANSUMM
			 WHERE TRAN_ID = #{tranId};
			
			SELECT AR_AMT * CURR_RATE
			  INTO v_ar_amt
			  FROM ACIT_ACKGT_RECEIPT
			 WHERE TRAN_ID = #{tranId};
			 
			 IF (#{totalLocalAmt} - v_total_payts) + v_total_payts <![CDATA[ <= ]]> v_ar_amt THEN
				<!-- Save to ACIT_AR_TRANSUMM -->
				ACIT_AR_TRANSUMM_PKG.save_acit_transumm(#{tranId},
														#{billId},
														#{billType},
														#{totalLocalAmt},
														null,
														#{createUser},
														CAST(to_timestamp(#{createDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
														#{updateUser},
														CAST(to_timestamp(#{updateDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE)
														);
				<!-- Delete from ACIT_AR_INVPULLOUT_PKG -->
				<foreach collection="delInvPullout" item="del">
					ACIT_AR_INVPULLOUT_PKG.del_ar_invpullout(
														#{del.tranId},
														#{del.billId},
														#{del.itemNo}				
					);
					
				</foreach>
				<!-- Save from ACIT_AR_INVPULLOUT_PKG -->
				<foreach collection="saveInvPullout" item="save">
					ACIT_AR_INVPULLOUT_PKG.save_ar_invpullout(
														#{save.tranId},
														#{save.billId},
														#{save.itemNo},
														#{save.invtId},
														#{save.pulloutType},
														#{save.currCd},
														#{save.currRate},
														#{save.invtAmt},
														#{save.incomeAmt},
														#{save.bankCharge},
														#{save.whtaxAmt},
														#{save.maturityValue},
														#{save.createUser},
														CAST(to_timestamp(#{save.createDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
														#{save.updateUser},
														CAST(to_timestamp(#{save.updateDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE)				
					);
				</foreach>
				<!-- Generate to Amount Details -->
				<!-- GENERATE_DEFAULT_AMT('AR', #{billType}, #{tranId}, #{updateUser}); -->
				<!-- Generate to Accounting Entries -->
				GENERATE_ACCIT_ENTRIES.SAVE_FINAL_ACCT_ENTRIES('AR', #{billType}, #{tranId}, v_message);
			ELSE
				#{custReturnCode, mode=OUT, jdbcType=VARCHAR} := 2; <!-- if return code is 2, cannot save -->
			END IF;
		END;
	</update>
	
	<resultMap type="ph.cpi.rest.api.model.accountingintrust.AcitArNegTrtyBal" id="arNegTrtyBalMap">
		<result property="tranId"			column="TRAN_ID"		/>
		<result property="billId"			column="BILL_ID"		/>
		<result property="itemNo"			column="ITEM_NO"		/>
		<result property="quarterEnding"	column="QUARTER_ENDING"	typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<result property="currCd"			column="CURR_CD"		/>
		<result property="currRate"			column="CURR_RATE"		/>
		<result property="balPaytAmt"		column="BAL_PAYT_AMT"	/>
		<result property="localAmt"			column="LOCAL_AMT"		/>
		<result property="createUser"		column="CREATE_USER"	/>
		<result property="createDate"		column="CREATE_DATE"	typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<result property="updateUser"		column="UPDATE_USER"	/>
		<result property="updateDate"		column="UPDATE_DATE"	typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
	</resultMap>
	
	<select id="retArNegTrtyBal" resultMap="arNegTrtyBalMap">
		SELECT * FROM TABLE (ACIT_AR_NEGTRTYBAL_PKG.ret_ar_negtrtybal(#{tranId}, #{billId}))
	</select>
	
	<update id="saveArNegTrtyBal" parameterType="java.util.Map" statementType="CALLABLE">
		DECLARE
			v_total_payts	NUMBER(16,2);
			v_ar_amt		NUMBER(16,2);
			v_message		VARCHAR2(500);
		BEGIN
			SELECT ABS(NVL(SUM(TOTAL_LOCAL_AMT), 0))
			  INTO v_total_payts
			  FROM ACIT_AR_TRANSUMM
			 WHERE TRAN_ID = #{tranId};
			
			SELECT AR_AMT * CURR_RATE
			  INTO v_ar_amt
			  FROM ACIT_ACKGT_RECEIPT
			 WHERE TRAN_ID = #{tranId};
			 
			 IF (ABS(#{totalLocalAmt}) - v_total_payts) + v_total_payts <![CDATA[ <= ]]> v_ar_amt THEN
				<!-- Save to ACIT_AR_TRANSUMM -->
				ACIT_AR_TRANSUMM_PKG.save_acit_transumm(#{tranId},
														#{billId},
														#{billType},
														ABS(#{totalLocalAmt}),
														null,
														#{createUser},
														CAST(to_timestamp(#{createDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
														#{updateUser},
														CAST(to_timestamp(#{updateDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE)
														);
				<!-- Delete from ACIT_AR_INVPULLOUT_PKG -->
				<foreach collection="delNegTrtyBal" item="del">
					ACIT_AR_NEGTRTYBAL_PKG.del_ar_negtrtybal(
														#{del.tranId},
														#{del.billId},
														#{del.itemNo}				
					);
				</foreach>
				<!-- Save from ACIT_AR_INVPULLOUT_PKG -->
				<foreach collection="saveNegTrtyBal" item="save">
					ACIT_AR_NEGTRTYBAL_PKG.save_ar_negtrtybal(
														#{save.tranId},
														#{save.billId},
														#{save.itemNo},
														CAST(to_timestamp(#{save.quarterEnding}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
														#{save.currCd},
														#{save.currRate},
														#{save.balPaytAmt},
														#{save.localAmt},
														#{save.createUser},
														CAST(to_timestamp(#{save.createDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
														#{save.updateUser},
														CAST(to_timestamp(#{save.updateDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE)				
					);
				</foreach>
				<!-- Generate Amount Details -->
				<!-- GENERATE_DEFAULT_AMT('AR', #{billType}, #{tranId}, #{updateUser}); -->
				<!-- Generate to Accounting Entries -->
				GENERATE_ACCIT_ENTRIES.SAVE_FINAL_ACCT_ENTRIES('AR', #{billType}, #{tranId}, v_message);
			ELSE
				#{custReturnCode, mode=OUT, jdbcType=VARCHAR} := 2; <!-- if return code is 2, cannot save -->
			END IF;
		END;
	</update>
	
	<resultMap type="ph.cpi.rest.api.model.accountingintrust.AcitArClmCashCallLov" id="arClmCashCallLovMap">
		<result property="claimId"          column="CLAIM_ID"        />
		<result property="insuredDesc"      column="INSURED_DESC"           />
		<result property="claimNo"          column="CLAIM_NO"        />
		<result property="policyNo"         column="POLICY_NO"              />
		<result property="lossDate"         column="LOSS_DATE"     typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"         />
		<result property="lossCd"           column="LOSS_CD"         />
		<result property="lossAbbr"         column="LOSS_ABBR"              />
		<result property="projId"           column="PROJ_ID"         />
		<result property="histNo"           column="HIST_NO"         />
		<result property="histCategory"     column="HIST_CATEGORY"          />
		<result property="histCatDesc"      column="HIST_CAT_DESC"          />
		<result property="histType"         column="HIST_TYPE"              />
		<result property="histTypeDesc"     column="HIST_TYPE_DESC"         />
		<result property="currencyCd"       column="CURRENCY_CD"            />
		<result property="currencyRt"       column="CURRENCY_RT"            />
		<result property="reserveAmt"       column="RESERVE_AMT"            />
		<result property="paytAmt"          column="PAYT_AMT"        />
		<result property="createUser"       column="CREATE_USER"            />
		<result property="createDate"       column="CREATE_DATE"   typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"         />
		<result property="updateUser"       column="UPDATE_USER"            />
		<result property="updateDate"       column="UPDATE_DATE"   typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"     />   
	</resultMap>
	
	<select id="retAcitARClmCashCallLov" resultMap="arClmCashCallLovMap">
		SELECT * FROM TABLE(ACIT_AR_CLMCASHCALL_PKG.ret_ar_clmcshcll_lov(#{payeeNo}))
	</select>
	
	<resultMap type="ph.cpi.rest.api.model.accountingintrust.AcitArClmCashCall" id="arClmCashCallMap">
		<result property="tranId"        column="TRAN_ID" />
		<result property="billId"        column="BILL_ID" />
		<result property="itemNo"        column="ITEM_NO" />
		<result property="claimId"       column="CLAIM_ID" />
		<result property="insuredDesc"   column="INSURED_DESC" />
		<result property="claimNo"       column="CLAIM_NO" />
		<result property="policyNo"      column="POLICY_NO" />
		<result property="lossDate"      column="LOSS_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" />
		<result property="lossCd"        column="LOSS_CD" />
		<result property="lossAbbr"      column="LOSS_ABBR" />
		<result property="projId"        column="PROJ_ID" />
		<result property="histNo"        column="HIST_NO" />
		<result property="histCategory"  column="HIST_CATEGORY" />
		<result property="histCatDesc"   column="HIST_CAT_DESC" />
		<result property="currCd"        column="CURR_CD" />
		<result property="currRate"      column="CURR_RATE" />
		<result property="reserveAmt"    column="RESERVE_AMT" />
		<result property="paytAmt"       column="PAYT_AMT" />
		<result property="cashcallAmt"   column="CASHCALL_AMT" />
		<result property="localAmt"      column="LOCAL_AMT" />
		<result property="createUser"    column="CREATE_USER" />
		<result property="createDate"    column="CREATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" />
		<result property="updateUser"    column="UPDATE_USER" />
		<result property="updateDate"    column="UPDATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" />  
	</resultMap>
	
	<select id="retAcitARClmCashCall" resultMap="arClmCashCallMap">
		SELECT * FROM TABLE(ACIT_AR_CLMCASHCALL_PKG.ret_ar_clmcshcll(#{tranId}, #{billId}))
	</select>
	
	<update id="saveArClmCashCall" parameterType="java.util.Map" statementType="CALLABLE">
		DECLARE
			v_total_payts	NUMBER(16,2);
			v_ar_amt		NUMBER(16,2);
			v_message		VARCHAR2(500);
		BEGIN
			SELECT NVL(SUM(TOTAL_LOCAL_AMT), 0)
			  INTO v_total_payts
			  FROM ACIT_AR_TRANSUMM
			 WHERE TRAN_ID = #{tranId};
			
			SELECT AR_AMT * CURR_RATE
			  INTO v_ar_amt
			  FROM ACIT_ACKGT_RECEIPT
			 WHERE TRAN_ID = #{tranId};
			 
			 IF (#{totalLocalAmt} - v_total_payts) + v_total_payts <![CDATA[ <= ]]> v_ar_amt THEN
				<!-- Save to ACIT_AR_TRANSUMM -->
				ACIT_AR_TRANSUMM_PKG.save_acit_transumm(#{tranId},
														#{billId},
														#{billType},
														ABS(#{totalLocalAmt}),
														null,
														#{createUser},
														CAST(to_timestamp(#{createDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
														#{updateUser},
														CAST(to_timestamp(#{updateDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE)
														);
				<!-- Delete from ACIT_AR_CLMCASHCALL_PKG -->
				<foreach collection="delClmCashCall" item="del">
					ACIT_AR_CLMCASHCALL_PKG.del_ar_clmcashcall(
														#{del.tranId},
														#{del.billId},
														#{del.itemNo}				
					);
				</foreach>
				<!-- Save from ACIT_AR_CLMCASHCALL_PKG -->
				<foreach collection="saveClmCashCall" item="save">
					ACIT_AR_CLMCASHCALL_PKG.save_ar_clmcashcall(
														#{save.tranId},
														#{save.billId},
														#{save.itemNo},
														#{save.claimId},
														#{save.projId},
														#{save.histNo},
														#{save.currCd},
														#{save.currRate},
														#{save.cashcallAmt},
														#{save.localAmt},
														#{save.createUser},
														CAST(to_timestamp(#{save.createDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
														#{save.updateUser},
														CAST(to_timestamp(#{save.updateDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE)				
					);
				</foreach>
				<!-- Generate Amount Details -->
				<!-- GENERATE_DEFAULT_AMT('AR', #{billType}, #{tranId}, #{updateUser}); -->
				<!-- Generate to Accounting Entries -->
				GENERATE_ACCIT_ENTRIES.SAVE_FINAL_ACCT_ENTRIES('AR', #{billType}, #{tranId}, v_message);
			ELSE
				#{custReturnCode, mode=OUT, jdbcType=VARCHAR} := 2; <!-- if return code is 2, cannot save -->
			END IF;
		END;
	</update>
	
	<resultMap type="ph.cpi.rest.api.model.accountingintrust.AcitJVClaimOffSetLOV" id="jvClmOffMap">
		<result property="claimId" column="CLAIM_ID"/>
		<result property="claimNo" column="CLAIM_NO"/>
		<result property="projId" column="PROJ_ID"/>
		<result property="policyId" column="POLICY_ID"/>
		<result property="policyNo" column="POLICY_NO"/>
		<result property="histNo" column="HIST_NO"/>
		<result property="histCategory" column="HIST_CATEGORY"/>
		<result property="histCategoryDesc" column="HIST_CATEGORY_DESC"/>
		<result property="histType" column="HIST_TYPE"/>
		<result property="histTypeDesc" column="HIST_TYPE_DESC"/>
		<result property="insuredDesc" column="INSURED_DESC"/>
		<result property="currencyCd" column="CURRENCY_CD"/>
		<result property="currencyRt" column="CURRENCY_RT"/>
		<result property="reserveAmt" column="RESERVE_AMT"/>
		<result property="paytAmt" column="PAYT_AMT"/>
		<result property="createUser" column="CREATE_USER"/>
		<result property="createDate" column="CREATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<result property="updateUser" column="UPDATE_USER"/>
		<result property="updateDate" column="UPDATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
	</resultMap>
	
	<select id="retrieveAcitJvClmOff" resultMap="jvClmOffMap" parameterType="java.util.Map">
		SELECT * FROM TABLE(ACIT_JOURNAL_VOUCHER_PKG.ret_acit_clmoff_lov(#{cedingId,jdbcType=INTEGER},null,null,null,null))
	</select>
	
	<resultMap type="ph.cpi.rest.api.model.accountingintrust.AcitJVClaimOffset" id="jvClmOffsetMap">
		<result property="tranId" column="TRAN_ID"/>
		<result property="quarterNo" column="QUARTER_NO"/>
		<result property="itemNo" column="ITEM_NO"/>
		<result property="claimId" column="CLAIM_ID"/>
		<result property="claimNo" column="CLAIM_NO"/>
		<result property="histCategory" column="HIST_CATEGORY"/>
		<result property="histCategoryDesc" column="HIST_CATEGORY_DESC"/>
		<result property="histType" column="HIST_TYPE"/>
		<result property="histTypeDesc" column="HIST_TYPE_DESC"/>
		<result property="exGratia" column="EX_GRATIA"/>
		<result property="reserveAmt" column="RESERVE_AMT"/>
		<result property="insuredDesc" column="INSURED_DESC"/>
		<result property="projId" column="PROJ_ID"/>
		<result property="histNo" column="HIST_NO"/>
		<result property="paymentFor" column="PAYMENT_FOR"/>
		<result property="currCd" column="CURR_CD"/>
		<result property="currRate" column="CURR_RATE"/>
		<result property="clmPaytAmt" column="CLM_PAYT_AMT"/>
		<result property="localAmt" column="LOCAL_AMT"/>
		<result property="remarks" column="REMARKS"/>
		<result property="createUser" column="CREATE_USER"/>
		<result property="createDate" column="CREATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<result property="updateUser" column="UPDATE_USER"/>
		<result property="updateDate" column="UPDATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
	</resultMap>
	
	<resultMap type="ph.cpi.rest.api.model.accountingintrust.AcitJVClmNegativeTreaty" id="jvNegTrtyMap">
		<result property="tranId" column="TRYTY_TRAN_ID"/>
		<result property="quarterNo" column="TRYTY_QUARTER_NO"/>
		<result property="cedingId" column="TRYTY_CEDING_ID"/>
		<result property="cedingName" column="CEDING_NAME"/>
		<result property="quarterEnding" column="TRYTY_QUARTER_ENDING" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<result property="currCd" column="TRYTY_CURR_CD"/>
		<result property="currRate" column="TRYTY_CURR_RATE"/>
		<result property="balanceAmt" column="TRYTY_BALANCE_AMT"/>
		<result property="localAmt" column="TRYTY_LOCAL_AMT"/>
		<result property="createUser" column="TRYTY_CREATE_USER"/>
		<result property="createDate" column="TRYTY_CREATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<result property="updateUser" column="TRYTY_UPDATE_USER"/>
		<result property="updateDate" column="TRYTY_UPDATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<association property="clmOffset" resultMap="jvClmOffsetMap"></association>
	</resultMap>
	
	<select id="retrieveAcitJvNegTrty" resultMap="jvNegTrtyMap" parameterType="java.util.Map">
		SELECT * FROM TABLE(ACIT_JOURNAL_VOUCHER_PKG.ret_off_clm_neg_trty(#{tranId},#{cedingId},null,null,null,null))
	</select>
	
	<update id="saveAcitJvNegTrty" parameterType="java.util.Map">
		DECLARE
			v_message VARCHAR2(500);
		BEGIN
			<foreach collection="deleteNegTrty" item="delete">
				ACIT_JOURNAL_VOUCHER_PKG.del_acit_trty_bal(#{delete.tranId},#{delete.cedingId},#{delete.quarterNo});
			</foreach>
			
			<foreach collection="saveNegTrty" item="save">
				ACIT_JOURNAL_VOUCHER_PKG.save_acit_trty(#{save.tranId},
														#{save.quarterNo},
														CAST(to_timestamp(#{save.quarterEnding}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
														#{save.cedingId},
														#{save.currCd},
														#{save.currRate},
														#{save.balanceAmt},
														#{save.localAmt},
														#{save.actualBalPaid,jdbcType=INTEGER},
														#{save.createUser},
														CAST(to_timestamp(#{save.createDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
														#{save.updateUser},
														CAST(to_timestamp(#{save.updateDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE)
				);
			</foreach>
			
			<foreach collection="deleteClmOffset" item="deleted">
				ACIT_JOURNAL_VOUCHER_PKG.del_acit_clm_off(
					#{deleted.tranId},
					#{deleted.quarterNo},
					#{deleted.itemNo}
				);
			</foreach>
			
			<foreach collection="saveClmOffset" item="saved">
				ACIT_JOURNAL_VOUCHER_PKG.save_acit_clm_off(#{saved.tranId},
															#{saved.quarterNo},
															#{saved.itemNo,jdbcType=INTEGER},
															#{saved.claimId},
															#{saved.projId},
															#{saved.histNo},
															#{saved.paymentFor,jdbcType=VARCHAR},
															#{saved.currCd},
															#{saved.currRate},
															#{saved.histCategory},
															#{saved.histType},
															#{saved.exGratia,jdbcType=VARCHAR},
															#{saved.reserveAmt},
															#{saved.clmPaytAmt},
															#{saved.localAmt},
															#{saved.remarks,jdbcType=VARCHAR},
															#{saved.createUser},
															CAST(to_timestamp(#{saved.createDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
															#{saved.updateUser},
															CAST(to_timestamp(#{saved.updateDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE)
				);
			</foreach>
			GENERATE_ACCIT_ENTRIES.SAVE_FINAL_ACCT_ENTRIES('JV', #{tranType}, #{tranId}, v_message);
		END;
	</update>
	
	<resultMap type="ph.cpi.rest.api.model.accountingintrust.AcitArAmtDtl" id="arAmtDtlMap">
		<result property="tranId"		column="TRAN_ID" />
		<result property="itemSeqno"	column="ITEM_SEQNO" />
		<result property="genType"		column="GEN_TYPE" />
		<result property="itemText"		column="ITEM_TEXT" />
		<result property="currCd"		column="CURR_CD" />
		<result property="currRate"		column="CURR_RATE" />
		<result property="currAmt"		column="CURR_AMT" />
		<result property="localAmt"		column="LOCAL_AMT" />
		<result property="createUser"	column="CREATE_USER" />
		<result property="createDate"	column="CREATE_DATE"  typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" />
		<result property="updateUser"	column="UPDATE_USER" />
		<result property="updateDate"	column="UPDATE_DATE"  typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" /> 
		<result property="updateLevel"	column="UPDATE_LEVEL" /> 
	</resultMap>
	
	<select id="retAcitArAmtDtl" resultMap="arAmtDtlMap">
		SELECT * FROM TABLE (ACIT_AR_AMTDTL_PKG.ret_ar_amtdtl(#{tranId}))
	</select>
	
	<update id="saveAcitArAmtDtl" parameterType="java.util.Map" statementType="CALLABLE">
		DECLARE
			v_total_payts	NUMBER(16,2);
			v_ar_amt		NUMBER(16,2);
		BEGIN
			SELECT NVL(SUM(LOCAL_AMT), 0)
			  INTO v_total_payts
			  FROM ACIT_AR_AMTDTL
			 WHERE TRAN_ID = #{tranId};
			
			SELECT AR_AMT * CURR_RATE
			  INTO v_ar_amt
			  FROM ACIT_ACKGT_RECEIPT
			 WHERE TRAN_ID = #{tranId};
			 
			 IF (#{totalLocalAmt} - v_total_payts) + v_total_payts <![CDATA[ <= ]]> v_ar_amt THEN
				
				<!-- Delete from ACIT_AR_AMTDTL_PKG -->
				<foreach collection="delAmtDtl" item="del">
					ACIT_AR_AMTDTL_PKG.del_ar_amtdtl(
														#{del.tranId},
														#{del.itemSeqno}				
					);
				</foreach>
				<!-- Save from ACIT_AR_AMTDTL_PKG -->
				<foreach collection="saveAmtDtl" item="save">
					ACIT_AR_AMTDTL_PKG.save_ar_amtdtl(
														#{save.tranId},
														#{save.itemSeqno},
														#{save.genType},
														#{save.itemText},
														#{save.currCd},
														#{save.currRate},
														#{save.currAmt},
														#{save.localAmt},
														#{save.createUser},
														CAST(to_timestamp(#{save.createDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
														#{save.updateUser},
														CAST(to_timestamp(#{save.updateDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE)				
					);
				</foreach>
			ELSE
				#{custReturnCode, mode=OUT, jdbcType=VARCHAR} := 2; <!-- if return code is 2, cannot save -->
			END IF;
		END;
	</update>
	
	<update id="generateUPR" parameterType="java.util.Map">
		BEGIN
			ACIT_UPR_PKG.generate_upr(#{extMm},#{extYear},#{extMethod},#{extractUser},CAST(to_timestamp(#{extractDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE));
		END;
	</update>
	
	<resultMap type="ph.cpi.rest.api.model.accountingintrust.AcitUPRPerLine" id="AcitUPRPerLineMap">
		<result property="lineCd" column="LINE_CD"/>
		<result property="premGross" column="PREM_GROSS"/>
		<result property="defPremGross" column="DEF_PREM_GROSS"/>
		<result property="prevDefPremGross" column="PREV_DEF_PREM_GROSS"/>
		<result property="defDiff" column="DEF_DIFF"/>
	</resultMap>
	
	<resultMap type="ph.cpi.rest.api.model.accountingintrust.AcitUPRPerPolicy" id="AcitUPRPerPolicyMap">
		<result property="lineCd" column="LINE_CD"/>
		<result property="policyNo" column="POLICY_NO"/>
		<result property="effDate" column="EFF_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<result property="expiryDate" column="EXPIRY_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<result property="numeratorFactor" column="NUMERATOR_FACTOR"/>
		<result property="denominatorFactor" column="DENOMINATOR_FACTOR"/>
		<result property="premGross" column="PREM_GROSS"/>
		<result property="defPremGross" column="DEF_PREM_GROSS"/>
	</resultMap>
	
	<select id="retrieveAcitUPRPerLine" resultMap="AcitUPRPerLineMap">
		SELECT * FROM TABLE(ACIT_UPR_PKG.ret_upr_per_line(#{extMm},#{extYear},#{extMethod},#{cedingId, jdbcType=VARCHAR}))
	</select>
	
	<select id="retrieveAcitUPRPerPol" resultMap="AcitUPRPerPolicyMap">
		SELECT * FROM TABLE(ACIT_UPR_PKG.ret_upr_per_line_pol(#{extMm},#{extYear},#{extMethod},#{cedingId, jdbcType=VARCHAR}))
	</select>
	
	<resultMap type="ph.cpi.rest.api.model.accountingintrust.GenUPRParams" id="GenUPRParamsMap">
		<result property="extMm" column="ext_mm"/>
		<result property="extYear" column="ext_year"/>
		<result property="extMethod" column="ext_method"/>
		<result property="extractUser" column="extract_user"/>
		<result property="extractDate" column="extract_date" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
	</resultMap>
	
	<select id="retrieveAcitUPRParams" resultMap="GenUPRParamsMap">
		SELECT * FROM TABLE(ACIT_UPR_PKG.ret_last_upr_params())
	</select>

	<select id="retrieveAcitServFeeSubGnrt" resultMap="servFeeDistMap" parameterType="java.util.Map">
		SELECT * FROM TABLE(ACCT_SERVFEE_DTL_DIST_PKG.ret_servfee_sub_gnrt(CAST(to_timestamp(#{prdAsOf, jdbcType=VARCHAR}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
																		   #{year, jdbcType=INTEGER},
																		   #{servFeeAmt, jdbcType=INTEGER},
																		   #{currCd, jdbcType=VARCHAR},
																		   #{currRt, jdbcType=INTEGER},
																		   null,null,null,null))
	</select>
	
	<select id="retrieveAcitExistingUPR" resultType="String">
		SELECT ACIT_UPR_PKG.check_existing(#{extMm},#{extYear},#{extMethod}) EXIST FROM DUAL
	</select>
	
	<resultMap type="ph.cpi.rest.api.model.accountingintrust.AcitJVAcctTrtyBal" id="acctTrtyMap">
		<result property="tranId" 			column="TRYTY_TRAN_ID"/>
		<result property="quarterNo" 		column="TRYTY_QUARTER_NO"/>
		<result property="cedingId" 		column="TRYTY_CEDING_ID"/>
		<result property="cedingName" 		column="CEDING_NAME"/>
		<result property="quarterEnding" 	column="TRYTY_QUARTER_ENDING" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<result property="currCd" 			column="TRYTY_CURR_CD"/>
		<result property="currRate" 		column="TRYTY_CURR_RATE"/>
		<result property="balanceAmt" 		column="TRYTY_BALANCE_AMT"/>
		<result property="localAmt" 		column="TRYTY_LOCAL_AMT"/>
		<result property="createUser" 		column="TRYTY_CREATE_USER"/>
		<result property="createDate" 		column="TRYTY_CREATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" />
		<result property="updateUser" 		column="TRYTY_UPDATE_USER"/>
		<result property="updateDate" 		column="TRYTY_UPDATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" />
		<association property="acctOffset" resultMap="acctOffsetMap"></association>
	</resultMap>
	
	<resultMap type="ph.cpi.rest.api.model.accountingintrust.AcitJVAcctOffset" id="acctOffsetMap">
		<result property="tranId" column="TRAN_ID"/>
		<result property="quarterNo" column="QUARTER_NO"/>
		<result property="itemNo" column="ITEM_NO"/>
		<result property="policyId" column="POLICY_ID"/>
		<result property="policyNo" column="POLICY_NO"/>
		<result property="soaNo" column="SOA_NO"/>
		<result property="coRefNo" column="CO_REF_NO"/>
		<result property="effDate" column="EFF_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<result property="dueDate" column="DUE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<result property="instNo" column="INST_NO"/>
		<result property="currCd" column="CURR_CD"/>
		<result property="currRate" column="CURR_RATE"/>
		<result property="prevPremAmt" column="PREV_PREMIUM"/>
        <result property="prevRiComm" column="PREV_RI_COMM"/>
        <result property="prevRiCommVat" column="PREV_RI_COMM_VAT"/>
        <result property="prevCharges" column="PREV_CHARGES"/>
        <result property="prevNetDue" column="PREV_NET_DUE"/>
        <result property="cumPayment" column="PREV_CUM_PAYMENT"/>
        <result property="balance" column="PREV_BALANCE"/>
        <result property="totalPayt" column="TOTAL_PAYMENTS"/>
        <result property="remainingBal" column="REMAINING_BALANCE"/>
		<result property="premAmt" column="PREM_AMT"/>
		<result property="riComm" column="RI_COMM"/>
		<result property="riCommVat" column="RI_COMM_VAT"/>
		<result property="charges" column="CHARGES"/>
		<result property="netDue" column="NET_DUE"/>
		<result property="paytAmt" column="PREV_PAYT_AMT"/>
		<result property="balPaytAmt" column="BAL_PAYT_AMT"/>
		<result property="localAmt" column="LOCAL_AMT"/>
		<result property="overdueInt" column="OVERDUE_INT"/>
		<result property="remarks" column="REMARKS"/>
		<result property="createUser" column="CREATE_USER"/>
		<result property="createDate" column="CREATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<result property="updateUser" column="UPDATE_USER"/>
		<result property="updateDate" column="UPDATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
	</resultMap>
	
	<select id="retrieveAcitJvAcctTrtyBal" resultMap="acctTrtyMap">
		SELECT * FROM TABLE (ACIT_JOURNAL_VOUCHER_PKG.ret_acct_trty_bal(#{tranId},#{cedingId},null,null,null,null))
	</select>
	
	<update id="saveAcitJvActTrtyBal" parameterType="java.util.Map">
		DECLARE
			v_message VARCHAR2(500);
		BEGIN
			<foreach collection="delAcctTrty" item="delete">
				ACIT_JOURNAL_VOUCHER_PKG.del_acit_trty_bal(#{delete.tranId},#{delete.cedingId},#{delete.quarterNo});
			</foreach>
			
			<foreach collection="saveAcctTrty" item="save">
				ACIT_JOURNAL_VOUCHER_PKG.save_acit_trty(#{save.tranId},
														#{save.quarterNo},
														CAST(to_timestamp(#{save.quarterEnding}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
														#{save.cedingId},
														#{save.currCd},
														#{save.currRate},
														#{save.balanceAmt},
														#{save.localAmt},
														#{save.actualBalPaid,jdbcType=INTEGER},
														#{save.createUser},
														CAST(to_timestamp(#{save.createDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
														#{save.updateUser},
														CAST(to_timestamp(#{save.updateDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE)
				);
			</foreach>
			
			<foreach collection="delInwPolOffset" item="deleted">
				ACIT_JOURNAL_VOUCHER_PKG.del_inwpol_offset(
					#{deleted.tranId},
					#{deleted.itemNo},
					#{deleted.quarterNo}
				);
			</foreach>
			
			<foreach collection="saveInwPolOffset" item="saved">
				ACIT_JOURNAL_VOUCHER_PKG.save_inwpol_offset(#{saved.tranId}, 
															#{saved.quarterNo}, 
															#{saved.itemNo,jdbcType=INTEGER}, 
															#{saved.policyId}, 
															#{saved.instNo}, 
															#{saved.currCd}, 
															#{saved.currRate}, 
															#{saved.premAmt}, 
															#{saved.riComm}, 
															#{saved.riCommVat}, 
															#{saved.charges}, 
															#{saved.netDue}, 
															#{saved.cumPayment}, 
															#{saved.paytAmt}, 
															#{saved.localAmt}, 
															#{saved.overdueInt ,jdbcType=INTEGER}, 
															#{saved.remarks,jdbcType=VARCHAR}, 
															#{saved.createUser}, 
															CAST(to_timestamp(#{saved.createDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE), 
															#{saved.updateUser}, 
															CAST(to_timestamp(#{saved.updateDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE)
				);
				
				ACIT_AGING_SOA_DETAILS_PKG.save_aging_soa_dtl_test(#{saved.policyId}, #{saved.instNo}, #{saved.premAmt}, #{saved.riComm}, #{saved.riCommVat}, #{saved.charges}, 
																   #{saved.paytAmt},#{saved.updateUser}, 
																  CAST(to_timestamp(#{saved.updateDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE));
			</foreach>
			GENERATE_ACCIT_ENTRIES.SAVE_FINAL_ACCT_ENTRIES('JV', #{tranType}, #{tranId}, v_message);
		END;
	</update>
	
	<resultMap type="ph.cpi.rest.api.model.maintenance.UserId" id="employeeMap">
		<result property="userName" column="PREPARED_BY"/>
		<result property="employeeName" column="PREPARED_NAME"/>
		<result property="designation" column="PREPARED_POS"/>
	</resultMap>
	
	<select id="retrieveDefName" resultMap="employeeMap" parameterType="java.util.Map">
		SELECT * FROM TABLE(ACIT_JOURNAL_VOUCHER_PKG.ret_def_name(#{userId}))
	</select>
	
	<update id="saveAcitAllocInvtIncome" parameterType="java.util.Map" statementType="CALLABLE">
		DECLARE
			v_alloc_tran_id        ACIT_ALLOC_REF.ALLOC_TRAN_ID%TYPE;
		BEGIN
			ACIT_ALL_INVT_INC_PKG.save_alloc_ref(v_alloc_tran_id);
												  
			#{tranIdOut, mode=OUT, jdbcType=INTEGER} := v_alloc_tran_id;
			
			IF v_alloc_tran_id <![CDATA[ <> ]]> 0 THEN
				<foreach collection="saveAcitAllocInvtIncome" item="save">
					ACIT_ALL_INVT_INC_PKG.save_alloc_ref_dtl(
														v_alloc_tran_id,
														#{save.refTranId, jdbcType=VARCHAR},
														#{save.createUser, jdbcType=VARCHAR},
														CAST(to_timestamp(#{save.createDate,jdbcType=DATE}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
														#{save.updateUser, jdbcType=VARCHAR},
														CAST(to_timestamp(#{save.updateDate,jdbcType=DATE}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE)
														
													  );
				</foreach>
			END IF; 
		END;
	</update>
	
	<resultMap type="ph.cpi.rest.api.model.accountingintrust.AcitJvAllInvtIncome" id="acitJvAllInvtIncomeListMap">
		<result property="tranId" 		column="TRAN_ID"/>
		<result property="jvYear" 		column="JV_YEAR"/>
		<result property="jvNo" 		column="JV_NO"/>
		<result property="jvDate" 		column="JV_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" />
		<result property="tranTypeCd" 	column="TRAN_TYPE_CD"/>
		<result property="tranTypeName" column="TRAN_TYPE_NAME"/>
		<result property="jvAmt" 		column="JV_AMT"/>
	</resultMap>
	
	<select id="retrieveAcitJvAllInvtIncome" resultMap="acitJvAllInvtIncomeListMap" parameterType="java.util.Map">
		SELECT * FROM TABLE (ACIT_ALL_INVT_INC_PKG.ret_jv_list(#{allocTranId, jdbcType=INTEGER},null,null,null,null))
	</select>
	
	<update id="updateAcitStatus" parameterType="java.util.Map">
		BEGIN
    		<foreach collection="updateAcitStatusList" item="u">
    			ACIT_CHANGE_STATUS_PKG.acit_chng_stats(
    				#{u.tranId},
					#{u.status, jdbcType=VARCHAR},
				    #{u.updateUser ,jdbcType=VARCHAR},
				    #{u.tranClass, jdbcType=VARCHAR}
    			);
    		</foreach>
    	END;
	</update>
	
	<update id="saveAcctPrqServFee" parameterType="java.util.Map" statementType="CALLABLE">
		BEGIN
			ACCT_SERVFEE_DTL_DIST_PKG.save_servfee(
				#{reqId, jdbcType=INTEGER},
				CAST(to_timestamp(#{prdAsOf, jdbcType=VARCHAR}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
				#{year, jdbcType=INTEGER},
				#{servFeeAmt, jdbcType=INTEGER},
				#{currCd, jdbcType=VARCHAR},
				#{currRt, jdbcType=INTEGER},
				#{createUser, jdbcType=VARCHAR},
				CAST(to_timestamp(#{createDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
				#{updateUser, jdbcType=VARCHAR},
				CAST(to_timestamp(#{updateDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE)
			);
		END;
	</update>

	<resultMap type="ph.cpi.rest.api.model.accountingintrust.AcitJVClaimsLosses" id="claimLossMap">
		<result property="tranId" 			column="CLM_TRAN_ID"/>
		<result property="itemNo" 			column="CLM_ITEM_NO"/>
		<result property="cedingId" 			column="CLM_TRAN_ID"/>
		<result property="cedingName" 			column="CLM_ITEM_NO"/>
		<result property="claimId" 			column="CLM_CLAIM_ID"/>
		<result property="projId" 			column="CLM_PROJ_ID"/>
		<result property="histNo" 			column="CLM_HIST_NO"/>
		<result property="claimNo" 			column="CLM_CLAIM_NO"/>
		<result property="histCategory" 	column="CLM_HIST_CATEGORY"/>
		<result property="histCategoryDesc" column="CLM_HIST_CATEGORY_DESC"/>
		<result property="histType" 		column="CLM_HIST_TYPE"/>
		<result property="histTypeDesc" 	column="CLM_HIST_TYPE_DESC"/>
		<result property="exGratia" 		column="CLM_EX_GRATIA"/>
		<result property="reserveAmt" 		column="CLM_RESERVE_AMT"/>
		<result property="insuredDesc" 		column="CLM_INSURED_DESC"/>
		<result property="paymentFor" 		column="CLM_PAYMENT_FOR"/>
		<result property="currCd" 			column="CLM_CURR_CD"/>
		<result property="currRate" 		column="CLM_CURR_RATE"/>
		<result property="clmPaytAmt" 		column="CLM_CLM_PAYT_AMT"/>
		<result property="localAmt" 		column="CLM_LOCAL_AMT"/>
		<result property="remarks" 			column="CLM_REMARKS"/>
		<result property="createUser" 		column="CLM_CREATE_USER"/>
		<result property="createDate" 		column="CLM_CREATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<result property="updateUser" 		column="CLM_UPDATE_USER"/>
		<result property="updateDate" 		column="CLM_UPDATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<association property="inwPolBal" resultMap="clminwpolMap"></association>
	</resultMap>
	
	<resultMap type="ph.cpi.rest.api.model.accountingintrust.AcitJVInwPolBal" id="clminwpolMap">
		<result property="tranId" column="TRAN_ID"/>
		<result property="itemNo" column="ITEM_NO"/>
		<result property="policyId" column="POLICY_ID"/>
		<result property="instNo" column="INST_NO"/>
		<result property="policyNo" column="POLICY_NO"/>
		<result property="soaNo" column="SOA_NO"/>
		<result property="coRefNo" column="CO_REF_NO"/>
		<result property="effDate" column="EFF_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<result property="dueDate" column="DUE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<result property="currCd" column="CURR_CD"/>
		<result property="currRate" column="CURR_RATE"/>
		
		<result property="prevPremAmt" column="PREV_PREMIUM"/>
		<result property="prevRiComm" column="PREV_RI_COMM"/>
		<result property="prevRiCommVat" column="PREV_RI_COMM_VAT"/>
		<result property="prevCharges" column="PREV_CHARGES"/>
		<result property="prevNetDue" column="PREV_NET_DUE"/>
		<result property="cumPayment" column="PREV_CUM_PAYMENT"/>
		<result property="balance" column="PREV_BALANCE"/>
		<result property="totalPayt" column="TOTAL_PAYMENTS"/>
		<result property="remainingBal" column="REMAINING_BALANCE"/>

		<result property="premAmt" column="PREM_AMT"/>
		<result property="riComm" column="RI_COMM"/>
		<result property="riCommVat" column="RI_COMM_VAT"/>
		<result property="charges" column="CHARGES"/>
		<result property="netDue" column="NET_DUE"/>
		<result property="prevPaytAmt" column="PREV_PAYT_AMT"/>
		<result property="paytAmt" column="BAL_PAYT_AMT"/>
		<result property="localAmt" column="LOCAL_AMT"/>
		<result property="overdueInt" column="OVERDUE_INT"/>
		<result property="remarks" column="REMARKS"/>
		<result property="createUser" column="CREATE_USER"/>
		<result property="createDate" column="CREATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<result property="updateUser" column="UPDATE_USER"/>
		<result property="updateDate" column="UPDATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
	</resultMap>
	
	<select id="retrieveAcitJVRcvblsAgnstLosses" resultMap="claimLossMap" parameterType="java.util.Map">
		SELECT * FROM TABLE(ACIT_JOURNAL_VOUCHER_PKG.ret_rec_agnst_loss(#{tranId},#{cedingId},NULL,NULL,NULL,NULL))
	</select>
	
	<update id="saveAcitJvRcvblsAgnstLoss" parameterType="java.util.Map" statementType="CALLABLE">
		DECLARE
			v_message VARCHAR2(500);
		BEGIN
			<foreach collection="delClmOffset" item="del">
				ACIT_JOURNAL_VOUCHER_PKG.del_clm_offset(#{del.tranId},#{del.itemNo}
												  		);
			</foreach>
			
			<foreach collection="saveClmOffset" item="save">
				ACIT_JOURNAL_VOUCHER_PKG.save_clm_offset(#{save.tranId}, 
														 #{save.itemNo,jdbcType=INTEGER}, 
														 #{save.claimId}, 
														 #{save.projId}, 
														 #{save.histNo}, 
														 #{save.paymentFor,jdbcType=VARCHAR}, 
														 #{save.histCategory},
														 #{save.histType},
														 #{save.exGratia},
														 #{save.reserveAmt},
														 #{save.currCd}, 
														 #{save.currRate}, 
														 #{save.clmPaytAmt}, 
														 #{save.localAmt}, 
														 #{save.remarks,jdbcType=VARCHAR}, 
														 #{save.createUser}, 
														 CAST(to_timestamp(#{save.createDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
														 #{save.updateUser}, 
														 CAST(to_timestamp(#{save.updateDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE)
														 );
			</foreach>
			
			<foreach collection="delInwPol" item="delete">
				ACIT_JOURNAL_VOUCHER_PKG.del_inw_offset(#{delete.tranId},#{delete.itemNo}
												  		);
			</foreach>
			
			<foreach collection="saveInwPol" item="saved">
				ACIT_JOURNAL_VOUCHER_PKG.save_inw_offset(#{saved.tranId}, 
														 #{saved.itemNo,jdbcType=INTEGER}, 
														 #{saved.policyId}, 
														 #{saved.instNo}, 
														 #{saved.currCd}, 
														 #{saved.currRate}, 
														 #{saved.premAmt}, 
														 #{saved.riComm}, 
														 #{saved.riCommVat}, 
														 #{saved.charges}, 
														 #{saved.netDue}, 
														 #{saved.cumPayment}, 
														 #{saved.paytAmt}, 
														 #{saved.localAmt}, 
														 #{saved.overdueInt ,jdbcType=INTEGER}, 
														 #{saved.remarks,jdbcType=VARCHAR}, 
														 #{saved.createUser}, 
														 CAST(to_timestamp(#{saved.createDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
														 #{saved.updateUser}, 
														 CAST(to_timestamp(#{saved.updateDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE)
														 );
				ACIT_AGING_SOA_DETAILS_PKG.save_aging_soa_dtl_test(#{saved.policyId}, #{saved.instNo}, #{saved.premAmt}, #{saved.riComm}, #{saved.riCommVat}, #{saved.charges}, 
																   #{saved.paytAmt},#{saved.updateUser}, 
																  CAST(to_timestamp(#{saved.updateDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE)); 
				
			</foreach>
			GENERATE_ACCIT_ENTRIES.SAVE_FINAL_ACCT_ENTRIES('JV', #{tranType}, #{tranId}, v_message);
		END;
	</update>

	<resultMap type="ph.cpi.rest.api.model.accountingintrust.AcitCv" id="acitCvMap">
		<result property="cvGenNo"			column="CV_GEN_NO"/>
		<result property="tranId"			column="TRAN_ID"/>
		<result property="cvYear"			column="CV_YEAR"/>
		<result property="cvNo"				column="CV_NO"/>
		<result property="cvDate"			column="CV_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<result property="cvStatus"			column="CV_STATUS"/>
		<result property="cvStatusDesc"		column="CV_STATUS_DESC"/>
		<result property="payeeNo"			column="PAYEE_NO"/>
		<result property="payee"			column="PAYEE"/>
		<result property="particulars"		column="PARTICULARS"/>
		<result property="bank"				column="BANK"/>
		<result property="bankDesc"			column="BANK_DESC"/>
		<result property="bankAcct"			column="BANK_ACCT"/>
		<result property="checkNo"			column="CHECK_NO"/>
		<result property="checkDate"		column="CHECK_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<result property="checkClass"		column="CHECK_CLASS"/>
		<result property="checkClassDesc"	column="CHECK_CLASS_DESC"/>
		<result property="currCd"			column="CURR_CD"/>
		<result property="currRate"			column="CURR_RATE"/>
		<result property="cvAmt"			column="CV_AMT"/>
		<result property="localAmt"			column="LOCAL_AMT"/>
		<result property="preparedBy"		column="PREPARED_BY"/>
		<result property="preparedDate"		column="PREPARED_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<result property="certifiedBy"		column="CERTIFIED_BY"/>
		<result property="certifiedDate"	column="CERTIFIED_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<result property="createUser" 		column="CREATE_USER"/>
		<result property="createDate" 		column="CREATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<result property="updateUser" 		column="UPDATE_USER"/>
		<result property="updateDate"		column="UPDATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" />
		
		<result property="mainTranId" 		column="MAIN_TRAN_ID"/>
		<result property="mainTranDate" 	column="MAIN_TRAN_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<result property="mainTranClass" 	column="MAIN_TRAN_CLASS"/>
		<result property="mainTranTypeCd" 	column="MAIN_TRAN_TYPE_CD"/>
		<result property="mainTranYear" 	column="MAIN_TRAN_YEAR"/>
		<result property="mainTranClassNo" 	column="MAIN_TRAN_CLASS_NO"/>
		<result property="mainTranStat" 	column="MAIN_TRAN_STAT"/>
		<result property="mainCloseDate" 	column="MAIN_CLOSE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<result property="mainDeleteDate" 	column="MAIN_DELETE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<result property="mainPostDate" 	column="MAIN_POST_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<result property="mainCreateUser" 	column="MAIN_CREATE_USER"/>
		<result property="mainCreateDate" 	column="MAIN_CREATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<result property="mainUpdateUser" 	column="MAIN_UPDATE_USER"/>
		<result property="mainUpdateDate" 	column="MAIN_UPDATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
	</resultMap>
	
	<select id="retrieveAcitCv" resultMap="acitCvMap" parameterType="java.util.Map">
		SELECT * FROM TABLE(ACIT_CHECK_VOUCHER_PKG.ret_acit_cv(
					#{tranId,jdbcType=INTEGER},
					#{cvGenNo, jdbcType=VARCHAR},
					CAST(to_timestamp(#{cvDateFrom,jdbcType=DATE}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
					CAST(to_timestamp(#{cvDateTo,jdbcType=DATE}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
					#{cvStatusDesc, jdbcType=VARCHAR},
					#{payee, jdbcType=VARCHAR},
					#{particulars, jdbcType=VARCHAR},
					#{cvAmt, jdbcType=INTEGER},
					'', '', '',''))
	</select>
	
	<update id="saveAcitCv" parameterType="java.util.Map" statementType="CALLABLE">
		BEGIN
			ACIT_CHECK_VOUCHER_PKG.save_acit_cv(
				#{tranIdOut,mode=OUT,jdbcType=INTEGER},
				#{mainTranIdOut,mode=OUT,jdbcType=INTEGER},
				#{tranId,mode=INOUT, jdbcType=INTEGER},
				#{cvYear, jdbcType=INTEGER},
				#{cvNo, jdbcType=INTEGER},
				CAST(to_timestamp(#{cvDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
				#{cvStatus, jdbcType=VARCHAR},
				#{payeeNo, jdbcType=INTEGER},
				#{payee, jdbcType=VARCHAR},
				#{particulars, jdbcType=VARCHAR},
				#{bank, jdbcType=INTEGER},
				#{bankAcct, jdbcType=VARCHAR},
				#{checkNo, jdbcType=VARCHAR},
				CAST(to_timestamp(#{checkDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
				#{checkClass, jdbcType=VARCHAR},
				#{currCd, jdbcType=VARCHAR},
				#{currRate, jdbcType=INTEGER},
				#{cvAmt, jdbcType=INTEGER},
				#{localAmt, jdbcType=INTEGER},
				#{preparedBy, jdbcType=VARCHAR},
				CAST(to_timestamp(#{preparedDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
				#{certifiedBy, jdbcType=VARCHAR},
				CAST(to_timestamp(#{certifiedDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
				#{createUser, jdbcType=VARCHAR},
				CAST(to_timestamp(#{createDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
				#{updateUser, jdbcType=VARCHAR},
				CAST(to_timestamp(#{updateDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
				#{mainTranId,mode=INOUT, jdbcType=INTEGER},
				#{tranStat, jdbcType=VARCHAR},
				CAST(to_timestamp(#{closeDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
				CAST(to_timestamp(#{deleteDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
				CAST(to_timestamp(#{postDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE)
			);
		END;
	</update>
	
	<update id="saveAcitCvPaytReqList" parameterType="java.util.Map" statementType="CALLABLE">
		BEGIN
			<foreach collection="deletePaytReqList" item="del">
				ACIT_CV_PAYTREQLIST_PKG.del_payt_req_list(#{del.tranId}, #{del.itemNo});
			</foreach>
			
			<foreach collection="savePaytReqList" item="save">
				ACIT_CV_PAYTREQLIST_PKG.save_payt_req_list(#{save.tranId},
														   #{save.itemNo, jdbcType=INTEGER},
														   #{save.reqId},
														   #{save.createUser, jdbcType=VARCHAR},
														   CAST(to_timestamp(#{save.createDate, jdbcType=VARCHAR}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
														   #{save.updateUser, jdbcType=VARCHAR}, 
														   CAST(to_timestamp(#{save.updateDate, jdbcType=VARCHAR}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE));
			</foreach>
		END;
	</update>
	
</mapper>