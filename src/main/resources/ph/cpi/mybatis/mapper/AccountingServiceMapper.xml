<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
        
<mapper namespace="ph.cpi.mybatis.mapper.AccountingServiceMapper">

	<resultMap type="ph.cpi.rest.api.model.accountingservice.OfficialReceipt" id="orListMap">
		<result property="tranId"			column="TRAN_ID" />
		<result property="orType"			column="OR_TYPE" />
		<result property="orNo"				column="OR_NO" />
		<result property="formattedOrNo"	column="FORMATTED_OR_NO" />
		<result property="orDate"			column="OR_DATE"	typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" />
		<result property="orStatus"		    column="OR_STATUS" />
		<result property="tranStat"			column="TRAN_STAT" />
		<result property="orStatDesc"		column="OR_STAT_DESC" />
		<result property="tranStatDesc"		column="TRAN_STAT_DESC" />
		<result property="tranTypeName"		column="TRAN_TYPE_NAME" />
		<result property="payor"			column="PAYOR" />
		<result property="orAmt"			column="OR_AMT" />
		<result property="particulars"		column="PARTICULARS" />
		<result property="createUser"		column="CREATE_USER" />
		<result property="createDate"		column="CREATE_DATE"	typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" />
		<result property="updateUser"		column="UPDATE_USER" />
		<result property="updateDate"		column="UPDATE_DATE"	typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" />
	</resultMap>
	
	<select id="retOrList" resultMap="orListMap" parameterType="java.util.Map">
		SELECT * FROM TABLE(ACSE_OFFICIAL_RECEIPT_PKG.ret_or_list(
																#{orType, jdbcType=VARCHAR},
																#{orNo, jdbcType=VARCHAR},
																#{payor, jdbcType=VARCHAR},
																CAST(to_timestamp(#{orDateFrom,jdbcType=DATE}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
																CAST(to_timestamp(#{orDateTo,jdbcType=DATE}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
																#{tranTypeName, jdbcType=VARCHAR},
																#{orStatDesc, jdbcType=VARCHAR},
																#{particulars, jdbcType=VARCHAR},
																#{orAmtFrom, jdbcType=VARCHAR},
																#{orAmtTo, jdbcType=VARCHAR}
															   )
						   )
	</select>
	
	<resultMap type="ph.cpi.rest.api.model.accountingservice.OfficialReceipt" id="orEntryMap">
		<result property="tranId"        column="TRAN_ID"           />
		<result property="orNo"          column="OR_NO"             />
		<result property="orType"        column="OR_TYPE"             />
		<result property="formattedOrNo" column="FORMATTED_OR_NO"   />
		<result property="orNoDigits"    column="OR_NO_DIGITS"      />
		<result property="orDate"        column="OR_DATE"          typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" />
		<result property="orStatus"      column="OR_STATUS"         />
		<result property="tranStat"      column="TRAN_STAT"         />
		<result property="orStatDesc"    column="OR_STAT_DESC"      />
		<result property="tranStatDesc"  column="TRAN_STAT_DESC"    />
		<result property="dcbYear"       column="DCB_YEAR"          />
		<result property="dcbUserCd"     column="DCB_USER_CD"       />
		<result property="dcbNo"         column="DCB_NO"            />
		<result property="dcbStatus"     column="DCB_STATUS"            />
		<result property="dcbBank"       column="DCB_BANK"          />
		<result property="dcbBankName"   column="DCB_BANK_NAME"     />
		<result property="dcbBankAcct"   column="DCB_BANK_ACCT"     />
		<result property="dcbBankAcctNo" column="DCB_BANK_ACCT_NO"  />
		<result property="refNo"         column="REF_NO"            />
		<result property="tranTypeCd"    column="TRAN_TYPE_CD"      />
		<result property="tranTypeName"  column="TRAN_TYPE_NAME"    />
		<result property="prNo"          column="PR_NO"             />
		<result property="prDate"        column="PR_DATE"          typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" />
		<result property="prPreparedBy"  column="PR_PREPARED_BY"    />
		<result property="vatTag"        column="VAT_TAG"          />
		<result property="payeeNo"       column="PAYEE_NO"          />
		<result property="payeeClassCd"  column="PAYEE_CLASS_CD"          />
		<result property="payor"         column="PAYOR"             />
		<result property="mailAddress"   column="MAIL_ADDRESS"      />
		<result property="bussTypeCd"    column="BUSS_TYPE_CD"      />
		<result property="tin"           column="TIN"               />
		<result property="refCd"         column="REF_CD"               />
		<result property="currCd"        column="OR_CURR_CD"       />
		<result property="orAmt"         column="OR_AMT"            />
		<result property="currRate"      column="OR_CURR_RATE"     />
		<result property="particulars"   column="PARTICULARS"       />
		<result property="createUser"    column="CREATE_USER"       />
		<result property="createDate"    column="CREATE_DATE"      typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" />
		<result property="updateUser"    column="UPDATE_USER"       />
		<result property="updateDate"    column="UPDATE_DATE"      typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" />
		<result property="cedingId"      column="CEDING_ID"       />
		<result property="bussTypeName"  column="BUSS_TYPE_NAME"       />
		<result property="rstrctTranUp"  column="RSTRCT_TRAN_UP"       />
		<result property="orDtlSum"      column="ORDTL_SUM"       />
		<result property="acctEntriesSum" column="ACCT_ENTRIES_SUM"       />
		<result property="acctEntDate"    column="ACCT_ENT_DATE"  typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"     />
		<association property="paytDtl"  resultMap="acsePaytDtlAssoc"   />
	</resultMap>
	
	<resultMap type="ph.cpi.rest.api.model.accountingservice.ORPaymentDetails" id="acsePaytDtlAssoc">
		<result property="paytId"          column="PAYT_ID" />
		<result property="paytMode"        column="PAYT_MODE" />
		<result property="currCd"          column="ORP_CURR_CD" />
		<result property="currRate"        column="ORP_CURR_RATE" />
		<result property="paytAmt"         column="PAYT_AMT" />
		<result property="bank"            column="BANK" />
		<result property="bankAcct"        column="BANK_ACCT" />
		<result property="checkNo"         column="CHECK_NO" />
		<result property="checkDate"       column="CHECK_DATE"          typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" />
		<result property="checkClass"      column="CHECK_CLASS" />
		<result property="remarks"         column="REMARKS" />
	</resultMap>
	
	<select id="retOrEntry" resultMap="orEntryMap" parameterType="java.util.Map">
		SELECT * FROM TABLE(ACSE_OFFICIAL_RECEIPT_PKG.ret_or_entry(
																	#{tranId},
																	#{orNo, jdbcType=VARCHAR}
															   )
						   )
	</select>
	

	<resultMap type="ph.cpi.rest.api.model.accountingservice.AcsePaytReq" id="acsePaytReqMap">
		<result property="paytReqNo"		column="PAYT_REQ_NO"/>
		<result property="reqId"			column="REQ_ID"/>
		<result property="reqPrefix"		column="REQ_PREFIX"/>
		<result property="reqYear"			column="REQ_YEAR"/>
		<result property="reqMm"			column="REQ_MM"/>
		<result property="reqSeqNo"			column="REQ_SEQ_NO"/>
		<result property="tranTypeCd"		column="TRAN_TYPE_CD"/>
		<result property="tranTypeDesc"		column="TRAN_TYPE_DESC"/>
		<result property="reqDate"			column="REQ_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" />
		<result property="reqStatus"		column="REQ_STATUS"/>
		<result property="reqStatusDesc"	column="REQ_STATUS_DESC"/>
		<result property="paytReqType"		column="PAYT_REQ_TYPE"/>
		<result property="payeeClassCd"		column="PAYEE_CLASS_CD"/>
		<result property="payeeCd"			column="PAYEE_CD"/>
		<result property="payee"			column="PAYEE"/>
		<result property="currCd"			column="CURR_CD"/>
		<result property="currRate"			column="CURR_RATE"/>
		<result property="reqAmt"			column="REQ_AMT"/>
		<result property="localAmt"			column="LOCAL_AMT"/>
		<result property="particulars"		column="PARTICULARS"/>
		<result property="preparedBy"		column="PREPARED_BY"/>
		<result property="preparedDate"		column="PREPARED_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" />
		<result property="requestedBy"		column="REQUESTED_BY"/>
		<result property="approvedBy"		column="APPROVED_BY"/>
		<result property="approvedDate"		column="APPROVED_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" />
		<result property="createUser" 		column="CREATE_USER"/>
		<result property="createDate" 		column="CREATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" />
		<result property="updateUser" 		column="UPDATE_USER"/>
		<result property="updateDate" 		column="UPDATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" />
		<result property="processing"		column="PROCESSING"/>
		
		<result property="tranStat" 		column="TRAN_STAT"/>
		<result property="tranStatDesc" 	column="TRAN_STAT_DESC"/>
		<result property="refNo" 			column="REF_NO"/>
	</resultMap>
	
	
	<select id="retrieveAcsePaytReq" resultMap="acsePaytReqMap" parameterType="java.util.Map">
		SELECT * FROM TABLE(ACSE_PAYMENT_REQUEST_PKG.ret_payt_req(
					#{reqId,jdbcType=INTEGER},
					#{paytReqNo, jdbcType=VARCHAR},
					#{tranTypeDesc, jdbcType=VARCHAR},
					CAST(to_timestamp(#{reqDateFrom,jdbcType=DATE}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
					CAST(to_timestamp(#{reqDateTo,jdbcType=DATE}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
					#{reqStatusDesc, jdbcType=VARCHAR},
					#{payee, jdbcType=VARCHAR},
					#{currCd, jdbcType=VARCHAR},
					#{reqAmt, jdbcType=INTEGER},
					#{particulars, jdbcType=VARCHAR},
					#{requestedBy, jdbcType=VARCHAR},
					'', '', '',''))
	</select>

	<update id="saveAcsetOrTrans" parameterType="java.util.Map" statementType="CALLABLE">
		DECLARE
			v_tran_id        ACIT_TRANSACTIONS.TRAN_ID%TYPE;
			v_message		 VARCHAR2(500);
		BEGIN
			ACSE_OFFICIAL_RECEIPT_PKG.save_acse_trans(
													v_tran_id,
													#{tranId},
													CAST(to_timestamp(#{tranDate,jdbcType=DATE}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
													#{tranClass},
													#{tranTypeCd},
													#{tranYear},
													#{tranClassNo,jdbcType=VARCHAR},
													#{orType},
													#{tranStat},
													CAST(to_timestamp(#{closeDate,jdbcType=DATE}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
													CAST(to_timestamp(#{deleteDate,jdbcType=DATE}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
													CAST(to_timestamp(#{postDate,jdbcType=DATE}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
													#{createUser},
													CAST(to_timestamp(#{createDate,jdbcType=DATE}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
													#{updateUser},
													CAST(to_timestamp(#{updateDate,jdbcType=DATE}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE)
												  );
												  
			#{outTranId, mode=OUT, jdbcType=VARCHAR} := v_tran_id;
			
			IF v_tran_id <![CDATA[ <> ]]> 0 THEN
				ACSE_OFFICIAL_RECEIPT_PKG.save_or_info(
														v_tran_id,
														#{orType},
														#{tranClassNo, jdbcType=VARCHAR},
														CAST(to_timestamp(#{tranDate,jdbcType=DATE}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
														#{orStatus},
														#{tranTypeCd},
														#{dcbYear},
														#{dcbNo},
														#{dcbUserCd},
														#{dcbBank, jdbcType=VARCHAR},
														#{dcbBankAcct, jdbcType=VARCHAR},
														#{refNo, jdbcType=VARCHAR},
														#{prNo, jdbcType=VARCHAR},
														CAST(to_timestamp(#{prDate,jdbcType=DATE}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
														#{prPreparedBy, jdbcType=VARCHAR},
														#{payeeNo, jdbcType=VARCHAR},
														#{payeeClassCd, jdbcType=VARCHAR},
														#{payor},
														#{mailAddress, jdbcType=VARCHAR},
														#{bussTypeName, jdbcType=VARCHAR},
														#{tin, jdbcType=VARCHAR},
														#{particulars},
														#{currCd},
														#{currRate},
														#{orAmt},
														#{allocTag, jdbcType=VARCHAR},
														#{allocTranId, jdbcType=VARCHAR},
														#{createUser},
														CAST(to_timestamp(#{createDate,jdbcType=DATE}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
														#{updateUser},
														CAST(to_timestamp(#{updateDate,jdbcType=DATE}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE)
													);
				<foreach collection="delPaytDtl" item="del">
					ACSE_OR_PAYTDTL_PKG.del_or_paytdtl(
														v_tran_id,
														#{del.paytId}
													  );
				</foreach>
				<foreach collection="savePaytDtl" item="save">
					ACSE_OR_PAYTDTL_PKG.save_or_paytdtl(
														v_tran_id,
														#{save.paytId, jdbcType=VARCHAR},
														#{save.paytMode},
														#{save.currCd},
														#{save.currRate},
														#{save.paytAmt},
														#{save.bank, jdbcType=VARCHAR},
														#{save.bankAcct, jdbcType=VARCHAR},
														#{save.checkNo, jdbcType=VARCHAR},
														CAST(to_timestamp(#{save.checkDate,jdbcType=DATE}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
														#{save.checkClass, jdbcType=VARCHAR},
														#{save.remarks, jdbcType=VARCHAR}
													  );
				</foreach>
		    END IF;
		    
		    IF #{isPrint, jdbcType=VARCHAR} IS NULL AND #{genAcctEnt} <![CDATA[ = ]]> 'Y' THEN
			    <!-- Generate Tax Details -->
			    GENERATE_ACCSE_TAXES.SAVE_FINAL_TAXES('OR', #{tranTypeCd}, v_tran_id, v_message);
			    <!-- ACCOUNTING_SERVICE_PKG.generate_tax_dtl('OR', v_tran_id, #{tranTypeCd}, #{createUser}, #{updateUser}); -->
			    
			    <!-- Generate Accounting Entries -->
			    GENERATE_ACCSE_ENTRIES.SAVE_FINAL_ACCT_ENTRIES('OR', #{tranTypeCd}, v_tran_id, v_message);
		    END IF;
		    
		END;
	</update>
	
	<resultMap type="ph.cpi.rest.api.model.accountingservice.AcseJournalVoucherList" id="jvListMap">
		<result property="tranId" 			column="JV_TRAN_ID"/>
		<result property="jvYear" 			column="JV_YEAR"/>
		<result property="jvNo" 			column="JV_NO"/>
		<result property="jvDate" 			column="JV_DATE"  typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<result property="jvStatus" 		column="JV_STATUS"/>
		<result property="statusName" 		column="JV_STATUS_NAME"/>
		<result property="tranTypeCd" 		column="TRAN_TYPE_CD"/>
		<result property="tranTypeName" 	column="TRAN_TYPE_NAME"/>
		<result property="autoTag" 			column="AUTO_TAG"/>
		<result property="refnoTranId" 		column="REFNO_TRAN_ID"/>
		<result property="refnoDate" 		column="REFNO_DATE"  typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<result property="particulars" 		column="PARTICULARS"/>
		<result property="currCd" 			column="CURR_CD"/>
		<result property="currRate" 		column="CURR_RATE"/>
		<result property="jvAmt" 			column="JV_AMT"/>
		<result property="localAmt" 		column="LOCAL_AMT"/>
		<result property="allocTag" 		column="ALLOC_TAG"/>
		<result property="allocTranId" 		column="ALLOC_TRAN_ID"/>
		<result property="preparedBy" 		column="PREPARED_BY"/>
		<result property="preparedName" 	column="PREPARED_NAME"/>
		<result property="preparedPosition" column="PREPARED_POS"/>
		<result property="preparedDate" 	column="PREPARED_DATE"  typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<result property="approvedBy" 		column="APPROVED_BY"/>
		<result property="approvedName" 	column="APPROVED_NAME"/>
		<result property="approvedPosition" column="APPROVED_POS"/>
		<result property="approvedDate" 	column="APPROVED_DATE"  typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<result property="createUser" 		column="JV_CREATE_USER"/>
		<result property="createDate" 		column="JV_CREATE_DATE"  typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<result property="updateUser" 		column="JV_UPDATE_USER"/>
		<result property="updateDate" 		column="JV_UPDATE_DATE"  typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
	</resultMap>
	
	<select id="retrieveJVList" resultMap="jvListMap" parameterType="java.util.Map">
		SELECT * FROM TABLE(ACSE_JOURNAL_VOUCHER_PKG.ret_acse_jv_list(#{tranId, jdbcType=INTEGER},null,null,null,null))
	</select>
	
	<resultMap type="ph.cpi.rest.api.model.accountingservice.AcseJournalVoucherEntry" id="jvEntryMap">
		<result property="tranIdTran" column="TRAN_ID"/>
		<result property="tranDate" column="TRAN_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<result property="tranClass" column="TRAN_CLASS"/>
		<result property="tranYear" column="TRAN_YEAR"/>
		<result property="tranClassNo" column="TRAN_CLASS_NO"/>
		<result property="tranStat" column="TRAN_STAT"/>
		<result property="closeDate" column="CLOSE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<result property="deleteDate" column="DELETE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<result property="postDate" column="POST_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<result property="createUserTran" column="CREATE_USER"/>
		<result property="createDateTran" column="CREATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<result property="updateUserTran" column="UPDATE_USER"/>
		<result property="updateDateTran" column="UPDATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<result property="tranTypeCd" column="TRAN_TYPE_CD"/>
		
		<result property="tranId" 			column="JV_TRAN_ID"/>
		<result property="jvYear" 			column="JV_YEAR"/>
		<result property="jvNo" 			column="JV_NO"/>
		<result property="jvDate" 			column="JV_DATE"  typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<result property="jvStatus" 		column="JV_STATUS"/>
		<result property="statusName" 		column="JV_STATUS_NAME"/>
		<result property="tranTypeCd" 		column="JV_TRAN_TYPE_CD"/>
		<result property="tranTypeName" 	column="TRAN_TYPE_NAME"/>
		<result property="autoTag" 			column="AUTO_TAG"/>
		<result property="refnoTranId" 		column="REFNO_TRAN_ID"/>
		<result property="refnoDate" 		column="REFNO_DATE"  typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<result property="particulars" 		column="PARTICULARS"/>
		<result property="currCd" 			column="CURR_CD"/>
		<result property="currRate" 		column="CURR_RATE"/>
		<result property="jvAmt" 			column="JV_AMT"/>
		<result property="localAmt" 		column="LOCAL_AMT"/>
		<result property="allocTag" 		column="ALLOC_TAG"/>
		<result property="allocTranId" 		column="ALLOC_TRAN_ID"/>
		<result property="preparedBy" 		column="PREPARED_BY"/>
		<result property="preparedName" 	column="PREPARED_NAME"/>
		<result property="preparedPosition" column="PREPARED_POS"/>
		<result property="preparedDate" 	column="PREPARED_DATE"  typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<result property="approvedBy" 		column="APPROVED_BY"/>
		<result property="approvedName" 	column="APPROVED_NAME"/>
		<result property="approvedPosition" column="APPROVED_POS"/>
		<result property="approvedDate" 	column="APPROVED_DATE"  typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<result property="createUser" 		column="JV_CREATE_USER"/>
		<result property="createDate" 		column="JV_CREATE_DATE"  typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<result property="updateUser" 		column="JV_UPDATE_USER"/>
		<result property="updateDate" 		column="JV_UPDATE_DATE"  typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
	</resultMap>
	
	<select id="retrieveJVEntry" resultMap="jvEntryMap" parameterType="java.util.Map">
		SELECT * FROM TABLE(ACSE_JOURNAL_VOUCHER_PKG.ret_acse_jv_entry(#{tranId, jdbcType=INTEGER},null,null,null,null))
	</select>

	<resultMap type="ph.cpi.rest.api.model.accountingservice.OrTransDtl" id="acseOrTransDtlMap">
		<result property="tranId"		column="TRAN_ID" />
		<result property="billId"		column="BILL_ID" />
		<result property="itemNo"		column="ITEM_NO" />
		<result property="itemName"		column="ITEM_NAME" />
		<result property="currCd"		column="CURR_CD" />
		<result property="currRate"		column="CURR_RATE" />
		<result property="currAmt"		column="CURR_AMT" />
		<result property="localAmt"		column="LOCAL_AMT" />
		<result property="refNo"		column="REF_NO" />
		<result property="remarks"		column="REMARKS" />
		<result property="createUser"	column="CREATE_USER" />
		<result property="createDate"	column="CREATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" />
		<result property="updateUser"	column="UPDATE_USER" />
		<result property="updateDate"	column="UPDATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" />
		<association property="taxAllocation" resultMap="taxAllocAssoc" />
	</resultMap>
	
	<resultMap type="ph.cpi.rest.api.model.accountingservice.OrItemTaxes" id="taxAllocAssoc">
		<result property="tranId"		column="TX_TRAN_ID" />
		<result property="billId"		column="TX_BILL_ID" />
		<result property="itemNo"		column="TX_ITEM_NO" />
		<result property="taxType"		column="TAX_TYPE" />
		<result property="taxCd"		column="TAX_CD" />
		<result property="taxName"		column="TAX_NAME" />
		<result property="taxRate"		column="RATE" />
		<result property="taxAmt"		column="AMOUNT" />
		<result property="taxBaseAmt"	column="BASE_AMT" />
		<result property="createUser"	column="TX_CREATE_USER" />
		<result property="createDate"	column="TX_CREATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" />
		<result property="updateUser"	column="TX_UPDATE_USER" />
		<result property="updateDate"	column="TX_UPDATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" />
		<result property="genType"		column="TX_GEN_TYPE" />
	</resultMap>
	
	<select id="retOrTransDtl" resultMap="acseOrTransDtlMap" parameterType="java.util.Map">
		SELECT * FROM TABLE(ACSE_OR_TRANSDTL_PKG.ret_or_transdtl(
																	#{tranId},
																	#{billId}
															   )
						   )
	</select>

	<update id="saveAcsePaytReq" parameterType="java.util.Map" statementType="CALLABLE">
		BEGIN
			ACSE_PAYMENT_REQUEST_PKG.save_payt_req(
				#{paytReqNo,mode=OUT,jdbcType=VARCHAR},
				#{reqId,mode=INOUT, jdbcType=INTEGER},
				#{reqPrefix, jdbcType=VARCHAR},
				#{reqYear, jdbcType=VARCHAR},
				#{reqMm, jdbcType=INTEGER},
				#{reqSeqNo, jdbcType=VARCHAR},
				#{tranTypeCd, jdbcType=VARCHAR},
				CAST(to_timestamp(#{reqDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
				#{reqStatus, jdbcType=VARCHAR},
				#{payeeClassCd, jdbcType=VARCHAR},
				#{payeeCd, jdbcType=VARCHAR},
				#{payee, jdbcType=VARCHAR},
				#{currCd, jdbcType=VARCHAR},
				#{currRate, jdbcType=VARCHAR},
				#{reqAmt, jdbcType=INTEGER},
				#{localAmt, jdbcType=INTEGER},
				#{particulars, jdbcType=VARCHAR},
				#{preparedBy, jdbcType=VARCHAR},
				CAST(to_timestamp(#{preparedDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
				#{requestedBy, jdbcType=VARCHAR},
				#{approvedBy, jdbcType=VARCHAR},
				CAST(to_timestamp(#{approvedDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
				#{createUser, jdbcType=VARCHAR},
				CAST(to_timestamp(#{createDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
				#{updateUser, jdbcType=VARCHAR},
				CAST(to_timestamp(#{updateDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE)
			);
		END;
	</update>
	
	<update id="saveJVEntry" parameterType="java.util.Map" statementType="CALLABLE">
		DECLARE
			v_tran_id	ACIT_TRANSACTIONS.TRAN_ID%TYPE;
		BEGIN
			ACSE_JOURNAL_VOUCHER_PKG.save_acse_jv( v_tran_id, #{tranId, jdbcType=VARCHAR}, 
													CAST(to_timestamp(#{tranDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
													#{tranClass}, 
													#{tranYear, jdbcType=VARCHAR}, 
													#{tranClassNo, jdbcType=VARCHAR}, 
													#{tranStat}, 
													CAST(to_timestamp(#{closeDate, jdbcType=VARCHAR}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
													CAST(to_timestamp(#{deleteDate, jdbcType=VARCHAR}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
													CAST(to_timestamp(#{postDate, jdbcType=VARCHAR}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
													#{createUser}, 
													CAST(to_timestamp(#{createDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
													#{updateUser}, 
													CAST(to_timestamp(#{updateDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE), 
													#{tranTypeCd, jdbcType=VARCHAR}, 
													#{tranIdJv, jdbcType=VARCHAR}, 
													#{jvYear, jdbcType=VARCHAR}, 
													#{jvNo, jdbcType=VARCHAR}, 
													CAST(to_timestamp(#{jvDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE), 
													#{jvStatus}, 
													#{JvTranTypeCd}, 
													#{autoTag}, 
													#{refnoTranId, jdbcType=INTEGER}, 
													CAST(to_timestamp(#{refnoDate, jdbcType=VARCHAR}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE), 
													#{particulars}, 
													#{currCd}, 
													#{currRate}, 
													#{jvAmt}, 
													#{localAmt}, 
													#{allocTag, jdbcType=VARCHAR}, 
													#{allocTranId, jdbcType=VARCHAR}, 
													#{preparedBy}, 
													CAST(to_timestamp(#{preparedDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE), 
													#{approvedBy, jdbcType=VARCHAR}, 
													CAST(to_timestamp(#{approvedDate, jdbcType=VARCHAR}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),  
													#{createUserJv}, 
													CAST(to_timestamp(#{createDateJv}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),  
													#{updateUserJv}, 
													CAST(to_timestamp(#{updateDateJv}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE)
												  );
				#{tranIdOut, mode=OUT, jdbcType=INTEGER} := v_tran_id;							  
		END;
	</update>
	
	<update id="approveJVService" parameterType="java.util.Map">
		BEGIN
			ACSE_JOURNAL_VOUCHER_PKG.approve_jv(
				#{tranId},
				#{approvedBy},
				CAST(to_timestamp(#{approvedDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
				#{updateUser},
				CAST(to_timestamp(#{updateDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE)
				);
		END;
	</update>

	<update id="updateAcsePaytReqStat" parameterType="java.util.Map">
		BEGIN
			ACSE_PAYMENT_REQUEST_PKG.up_acse_paytreqstat(
				#{reqId, jdbcType=INTEGER},
				#{reqStatus, jdbcType=VARCHAR},
				#{updateUser, jdbcType=VARCHAR},
				#{approvedBy, jdbcType=VARCHAR},
				CAST(to_timestamp(#{approvedDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE)
			);
		END;
	</update>
	
	<update id="cancelJVService" parameterType="java.util.Map">
		BEGIN
			ACSE_JOURNAL_VOUCHER_PKG.cancel_jv(
				#{tranId},
				#{updateUser},
				CAST(to_timestamp(#{updateDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE)
			);
		END;
	</update>
	
	<resultMap type="ph.cpi.rest.api.model.accountingservice.AcseTaxDetails" id="taxDtlMap">
		<result property="tranId" 			column="TRAN_ID"/>
		<result property="taxType"      	column="TAX_TYPE"/>
		<result property="taxSeqno"     	column="TAX_SEQNO"/>
		<result property="genType"      	column="GEN_TYPE"/>
		<result property="taxCd"        	column="TAX_CD"/>
		<result property="genTaxDesc"   	column="GEN_TAX_DESC"/>
		<result property="whtTaxDesc"   	column="WHT_TAX_DESC"/>
		<result property="genBirRlf"   		column="GEN_BIR_RLF"/>
		<result property="genTaxRate"   	column="GEN_TAX_RATE"/>
		<result property="whtRate"     	    column="WHT_RATE"/>
		<result property="payor"        	column="PAYOR"/>
		<result property="baseAmt"      	column="BASE_AMT"/>
		<result property="taxAmt"       	column="TAX_AMT"/>
		<result property="createUser" 		column="CREATE_USER"/>
		<result property="createDate" 		column="CREATE_DATE"  typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<result property="updateUser" 		column="UPDATE_USER"/>
		<result property="updateDate" 		column="UPDATE_DATE"  typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
	</resultMap>
	
	<select id="retrieveTaxDetails" resultMap="taxDtlMap" parameterType="java.util.Map">
		SELECT * FROM TABLE(ACSE_TAX_DETAILS_PKG.ret_tax_dtl(#{tranId},#{taxType},null,null,null,null))
	</select>

	<update id="saveAcseOrTransDtl" parameterType="java.util.Map" statementType="CALLABLE">
		DECLARE
			v_item_no		NUMBER;
			v_message       VARCHAR2(500);
		BEGIN
		
			<!-- Save in ACSE_OR_TRANSUMM -->
			ACSE_OR_TRANSUMM_PKG.save_acse_transumm(
														#{tranId},
														#{billId},
														#{billType},
														#{totalLocalAmt},
														#{createUser},
														CAST(to_timestamp(#{createDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
														#{updateUser},
														CAST(to_timestamp(#{updateDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE)
			);
			
			<foreach item="del" collection="delOrItemTaxes">
				<!-- Delete data from ACSE_OR_ITEMTAXES first since it's a child table -->
				ACSE_OR_ITEMTAXES_PKG.del_or_itemtaxes(
													#{del.tranId},
													#{del.billId},
													#{del.itemNo},
													#{del.taxType},
													#{del.taxCd}
												);
				
			</foreach>
			<foreach item="del" collection="delOrTransDtl">
				<!-- Then delete data from ACSE_OR_TRANSDTL which is the parent -->
				ACSE_OR_TRANSDTL_PKG.del_or_transdtl(
													#{del.tranId},
													#{del.billId},
													#{del.itemNo}
												);
			</foreach>
			<foreach item="save" collection="saveOrTransDtl">
				<!-- Save data from ACSE_OR_TRANSDTL first since it's the parent table -->
				ACSE_OR_TRANSDTL_PKG.save_or_transdtl(
														v_item_no, <!-- This out parameter will be used when saving taxes later -->
														#{save.tranId},
														#{save.billId},
														#{save.itemNo, jdbcType=VARCHAR},
														#{save.itemName},
														#{save.currCd},
														#{save.currRate},
														#{save.currAmt},
														#{save.localAmt},
														#{save.refNo, jdbcType=VARCHAR},
														#{save.remarks, jdbcType=VARCHAR},
														#{save.createUser},
														CAST(to_timestamp(#{save.createDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
														#{save.updateUser},
														CAST(to_timestamp(#{save.updateDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE)
				);
				<!-- Save data from ACSE_OR_ITEMTAXES per ACSE_OR_TRANSDTL item -->
				<foreach item="saveTaxes" collection="save.taxAllocation">
					ACSE_OR_ITEMTAXES_PKG.save_or_itemtaxes(
																#{saveTaxes.tranId},
																#{saveTaxes.billId},
																v_item_no,	<!-- Based on the output parameter in ACSE_OR_TRANSDTL_PKG.save_or_transdtl PROCEDURE -->
																#{saveTaxes.taxType},
																#{saveTaxes.taxCd},
																#{saveTaxes.taxRate, jdbcType=VARCHAR},
																#{saveTaxes.taxAmt, jdbcType=VARCHAR},
																#{save.createUser},
																CAST(to_timestamp(#{save.createDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
																#{save.updateUser},
																CAST(to_timestamp(#{save.updateDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
																#{saveTaxes.genType}
					);
				</foreach>
			</foreach>
			
			<!-- Generate Tax Details -->
		    <!-- GENERATE_ACCSE_TAXES.SAVE_FINAL_TAXES('OR', #{billType}, #{tranId}, v_message); -->
		    
		    <!-- ACSE_OR_ITEMTAXES_PKG.generate_tax_dtl(#{tranId}, 
													#{billId},
													#{createUser},
													CAST(to_timestamp(#{createDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
													#{updateUser},
													CAST(to_timestamp(#{updateDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE)); -->
													
			<!-- ACCOUNTING_SERVICE_PKG.generate_item_taxes('OR', #{tranId}, #{billType}, #{createUser}, #{updateUser}); -->
		    <!-- ACCOUNTING_SERVICE_PKG.generate_tax_dtl('OR', #{tranId}, #{billType}, #{createUser}, #{updateUser});  -->
		    GENERATE_ACCSE_TAXES.SAVE_FINAL_TAXES('OR', #{billType}, #{tranId}, v_message);
		    
		    <!-- Generate Accounting Entries -->
		    GENERATE_ACCSE_ENTRIES.SAVE_FINAL_ACCT_ENTRIES('OR', #{billType}, #{tranId}, v_message);
			END;
			
	</update>

	<resultMap type="ph.cpi.rest.api.model.accountingservice.AcsePrqTrans" id="acsePrqTransMap">
		<result property="reqId" 		column="REQ_ID"/>
		<result property="itemNo" 		column="ITEM_NO"/>
		<result property="tranTypeCd" 	column="TRAN_TYPE_CD"/>
		<result property="itemName" 	column="ITEM_NAME"/>
		<result property="glAcctId" 	column="GL_ACCT_ID"/>
		<result property="refNo" 		column="REF_NO"/>
		<result property="remarks" 		column="REMARKS"/>
		<result property="currCd" 		column="CURR_CD"/>
		<result property="currRate" 	column="CURR_RATE"/>
		<result property="currAmt" 		column="CURR_AMT"/>
		<result property="localAmt" 	column="LOCAL_AMT"/>
		<result property="createUser" 	column="CREATE_USER"/>
		<result property="createDate" 	column="CREATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" />
		<result property="updateUser" 	column="UPDATE_USER"/>
		<result property="updateDate" 	column="UPDATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" />
		<result property="acctCd" 		column="ACCT_CD"/>
		<association property="taxAllocation" resultMap="taxAllocAssocCv"></association>
	</resultMap>
	
	<resultMap type="ph.cpi.rest.api.model.accountingservice.CvItemTaxes" id="taxAllocAssocCv">
		<result property="reqId"		column="TX_REQ_ID" />
		<result property="itemNo"		column="TX_ITEM_NO" />
		<result property="taxSeqNo"		column="TX_TAX_SEQ_NO" />
		<result property="taxType"		column="TAX_TYPE" />
		<result property="taxCd"		column="TAX_CD" />
		<result property="taxName"		column="TAX_NAME" />
		<result property="taxRate"		column="RATE" />
		<result property="taxAmt"		column="AMOUNT" />
		<result property="taxBaseAmt"	column="BASE_AMT" />
		<result property="createUser"	column="TX_CREATE_USER" />
		<result property="createDate"	column="TX_CREATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" />
		<result property="updateUser"	column="TX_UPDATE_USER" />
		<result property="updateDate"	column="TX_UPDATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" />
		<result property="genType"		column="TX_GEN_TYPE" />
	</resultMap>
	
	<select id="retrieveAcsePrqTrans" resultMap="acsePrqTransMap" parameterType="java.util.Map">
		SELECT * FROM TABLE(ACSE_PRQ_TRANS_PKG.ret_acse_prq_trans(
					#{reqId,jdbcType=INTEGER},
					#{itemNo, jdbcType=INTEGER},
					'', '', '',''))
	</select>
	
	<update id="saveAcsePrqTrans" parameterType="java.util.Map" statementType="CALLABLE">
		DECLARE
			v_item_no		NUMBER;
			v_message		VARCHAR2(500);
		BEGIN
			<foreach item="del" collection="delCvItemTaxes">
				<!-- Delete data from ACSE_CV_ITEMTAXES first since it's a child table -->
				ACSE_CV_ITEMTAXES_PKG.del_cv_itemtaxes(
													#{del.reqId},
													#{del.itemNo},
													#{del.taxType},
													#{del.taxCd}
												);
				
			</foreach>
			<foreach collection="deletePrqTrans" item="del">
				ACSE_PRQ_TRANS_PKG.del_acse_prq_trans(
					#{del.reqId,jdbcType=INTEGER},
					#{del.itemNo,jdbcType=INTEGER}
				);
			</foreach>
			
			<foreach collection="savePrqTrans" item="save">
				v_item_no := #{save.itemNo,jdbcType=INTEGER};
				ACSE_PRQ_TRANS_PKG.save_acse_prq_trans(
					#{save.reqId,jdbcType=INTEGER},
					v_item_no,
					#{save.tranTypeCd,jdbcType=INTEGER},
					#{save.itemName,jdbcType=VARCHAR},
					#{save.glAcctId,jdbcType=INTEGER},
					#{save.refNo,jdbcType=VARCHAR},
					#{save.remarks,jdbcType=VARCHAR},
					#{save.currCd,jdbcType=VARCHAR},
					#{save.currRate,jdbcType=INTEGER},
					#{save.currAmt,jdbcType=INTEGER},
					#{save.localAmt,jdbcType=INTEGER},
					#{save.createUser, jdbcType=VARCHAR},
					CAST(to_timestamp(#{save.createDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
					#{save.updateUser, jdbcType=VARCHAR}, 
					CAST(to_timestamp(#{save.updateDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE)
				);
				
				<foreach item="saveTaxes" collection="save.taxAllocation">
					ACSE_CV_ITEMTAXES_PKG.save_cv_itemtaxes(
																#{saveTaxes.reqId},
																v_item_no,	<!-- Based on the output parameter in ACSE_OR_TRANSDTL_PKG.save_or_transdtl PROCEDURE -->
																#{saveTaxes.taxSeqNo, jdbcType=VARCHAR},
																#{saveTaxes.taxType},
																#{saveTaxes.taxCd},
																#{saveTaxes.taxRate, jdbcType=VARCHAR},
																#{saveTaxes.taxAmt, jdbcType=VARCHAR},
																#{save.createUser},
																CAST(to_timestamp(#{save.createDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
																#{save.updateUser},
																CAST(to_timestamp(#{save.updateDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
																#{saveTaxes.genType}
					);
				</foreach>
			</foreach>
			
			<!-- ACCOUNTING_SERVICE_PKG.generate_item_taxes('PRQ',NULL,#{tranTypeCd},#{createUser},#{updateUser},#{reqId}); -->
			GENERATE_ACCSE_TAXES.GENERATE_PRQ_ITEMTAXES('PRQ', #{tranTypeCd}, #{reqId}, v_message);
		END;
	</update>
	
	<update id="saveTaxDetails" parameterType="java.util.Map">
		BEGIN
			<foreach collection="delTaxDtl" item="del">
				ACSE_TAX_DETAILS_PKG.del_tax_details(
					#{del.tranId},
					#{del.taxType},
					#{del.taxSeqno}
				);
			</foreach>
			
			<foreach collection="saveTaxDtl" item="save">
				ACSE_TAX_DETAILS_PKG.save_tax_details(
					#{save.tranId},
					#{save.taxType},
					#{save.taxSeqno, jdbcType=INTEGER},
					#{save.taxCd},
					#{save.genType},
					#{save.payor, jdbcType=VARCHAR},
					#{save.baseAmt},
					#{save.taxAmt},
					#{save.createUser},
					CAST(to_timestamp(#{save.createDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
					#{save.updateUser},
					CAST(to_timestamp(#{save.updateDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE)
				);
			</foreach>
		END;
	</update>
	
	<resultMap type="ph.cpi.rest.api.model.accountingservice.AcseAcctEntries" id="acctEntryMap">
		<result property="tranId" 			column="TRAN_ID"/>
		<result property="entryId" 			column="ENTRY_ID"/>
		<result property="glAcctId" 		column="GL_ACCT_ID"/>
		<result property="glShortCd" 		column="GL_SHORT_CD"/>
		<result property="glShortDesc"  	column="GL_SHORT_DESC"/>
		<result property="slTypeCd" 		column="SL_TYPE_CD"/>
		<result property="slTypeName" 		column="SL_TYPE_NAME"/>
		<result property="slCd" 			column="SL_CD"/>
		<result property="slName" 			column="SL_NAME"/>
		<result property="creditAmt" 		column="CREDIT_AMT"/>
		<result property="debitAmt" 		column="DEBIT_AMT"/>
		<result property="foreignCreditAmt" column="FOREIGN_CREDIT_AMT"/>
		<result property="foreignDebitAmt"  column="FOREIGN_DEBIT_AMT"/>
		<result property="autoTag" 			column="AUTO_TAG"/>
		<result property="createUser" 		column="CREATE_USER"/>
		<result property="createDate" 		column="CREATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<result property="updateUser" 		column="UPDATE_USER"/>
		<result property="updateDate" 		column="UPDATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<result property="updateLevel" 		column="UPDATE_LEVEL"/>
	</resultMap>
	
	<select id="retrieveAcctEntries" resultMap="acctEntryMap" parameterType="java.util.Map">
		SELECT * FROM TABLE(ACSE_ACCT_ENTRIES_PKG.ret_acse_acc_entries(#{tranId},#{entryId},#{glAcctId},#{slTypeCd},#{slCd}))
	</select>

	<resultMap type="ph.cpi.rest.api.model.accountingservice.AcseCv" id="acseCvMap">
		<result property="cvGenNo"			column="CV_GEN_NO"/>
		<result property="tranId"			column="TRAN_ID"/>
		<result property="cvYear"			column="CV_YEAR"/>
		<result property="cvNo"				column="CV_NO"/>
		<result property="cvDate"			column="CV_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<result property="cvStatus"			column="CV_STATUS"/>
		<result property="cvStatusDesc"		column="CV_STATUS_DESC"/>
		<result property="paytReqType"		column="PAYT_REQ_TYPE"/>
		<result property="paytReqTypeDesc"	column="PAYT_REQ_TYPE_DESC"/>
		<result property="payeeClassCd"		column="PAYEE_CLASS_CD"/>
		<result property="payeeCd"			column="PAYEE_CD"/>
		<result property="payee"			column="PAYEE"/>
		<result property="particulars"		column="PARTICULARS"/>
		<result property="bank"				column="BANK"/>
		<result property="bankDesc"			column="BANK_DESC"/>
		<result property="bankAcct"			column="BANK_ACCT"/>
		<result property="bankAcctDesc"		column="BANK_ACCT_DESC"/>
		<result property="checkId"			column="CHECK_ID"/>
		<result property="checkNo"			column="CHECK_NO"/>
		<result property="checkDate"		column="CHECK_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<result property="checkClass"		column="CHECK_CLASS"/>
		<result property="checkClassDesc"	column="CHECK_CLASS_DESC"/>
		<result property="currCd"			column="CURR_CD"/>
		<result property="currRate"			column="CURR_RATE"/>
		<result property="cvAmt"			column="CV_AMT"/>
		<result property="localAmt"			column="LOCAL_AMT"/>
		<result property="preparedBy"		column="PREPARED_BY"/>
		<result property="preparedDate"		column="PREPARED_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<result property="certifiedBy"		column="CERTIFIED_BY"/>
		<result property="certifiedDate"	column="CERTIFIED_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<result property="createUser" 		column="CREATE_USER"/>
		<result property="createDate" 		column="CREATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<result property="updateUser" 		column="UPDATE_USER"/>
		<result property="updateDate"		column="UPDATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" />
		
		<result property="mainTranId" 		column="MAIN_TRAN_ID"/>
		<result property="mainTranDate" 	column="MAIN_TRAN_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<result property="mainTranClass" 	column="MAIN_TRAN_CLASS"/>
		<result property="mainTranTypeCd" 	column="MAIN_TRAN_TYPE_CD"/>
		<result property="mainTranYear" 	column="MAIN_TRAN_YEAR"/>
		<result property="mainTranClassNo" 	column="MAIN_TRAN_CLASS_NO"/>
		<result property="mainTranStat" 	column="MAIN_TRAN_STAT"/>
		<result property="mainTranStatDesc" column="MAIN_TRAN_STAT_DESC"/>
		<result property="mainCloseDate" 	column="MAIN_CLOSE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<result property="mainDeleteDate" 	column="MAIN_DELETE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<result property="mainPostDate" 	column="MAIN_POST_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<result property="mainCreateUser" 	column="MAIN_CREATE_USER"/>
		<result property="mainCreateDate" 	column="MAIN_CREATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<result property="mainUpdateUser" 	column="MAIN_UPDATE_USER"/>
		<result property="mainUpdateDate" 	column="MAIN_UPDATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<result property="mainAcctEntDate" 	column="ACCT_ENT_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<result property="refNo" 			column="REF_NO"/>
		<result property="checkStatus"	 	column="CHECK_STATUS"/>
		<result property="acctEntDate" 		column="ACCT_ENT_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<result property="cancelReason"	 	column="CANCEL_REASON"/>
		<result property="prlExist"		 	column="PRL_EXIST"/>
		<result property="disbType"		 	column="DISB_TYPE"/>
		<result property="destBank"		 	column="DEST_BANK"/>
		<result property="destBankDesc"		column="DEST_BANK_DESC"/>
		<result property="destAcctNo"		column="DEST_ACCT_NO"/>
		<result property="destAcctName"		column="DEST_ACCT_NAME"/>
		<result property="btRefNo"		 	column="BT_REF_NO"/>
		<result property="swiftCd"		 	column="SWIFT_CD"/>
	</resultMap>
	
	<select id="retrieveAcseCv" resultMap="acseCvMap" parameterType="java.util.Map">
		SELECT * FROM TABLE(ACSE_CHECK_VOUCHER_PKG.ret_acse_cv(
					#{tranId,jdbcType=INTEGER},
					#{cvGenNo, jdbcType=VARCHAR},
					CAST(to_timestamp(#{cvDateFrom,jdbcType=DATE}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
					CAST(to_timestamp(#{cvDateTo,jdbcType=DATE}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
					#{cvStatusDesc, jdbcType=VARCHAR},
					#{payee, jdbcType=VARCHAR},
					#{particulars, jdbcType=VARCHAR},
					#{cvAmt, jdbcType=INTEGER},
					'', '', '',''))
	</select>
	
	<update id="saveAcseCv" parameterType="java.util.Map" statementType="CALLABLE">
		BEGIN
			ACSE_CHECK_VOUCHER_PKG.save_acse_cv(
				#{tranIdOut,mode=OUT,jdbcType=INTEGER},
				#{mainTranIdOut,mode=OUT,jdbcType=INTEGER},
				#{tranId,mode=INOUT, jdbcType=INTEGER},
				#{cvYear, jdbcType=INTEGER},
				#{cvNo, jdbcType=INTEGER},
				CAST(to_timestamp(#{cvDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
				#{cvStatus, jdbcType=VARCHAR},
				#{paytReqType, jdbcType=INTEGER},
				#{payeeClassCd, jdbcType=INTEGER},
				#{payeeCd, jdbcType=VARCHAR},
				#{payee, jdbcType=VARCHAR},
				#{particulars, jdbcType=VARCHAR},
				#{bank, jdbcType=INTEGER},
				#{bankAcct, jdbcType=INTEGER},
				#{checkId,mode=INOUT, jdbcType=INTEGER},
				#{checkNo, jdbcType=VARCHAR},
				CAST(to_timestamp(#{checkDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
				#{checkClass, jdbcType=VARCHAR},
				#{currCd, jdbcType=VARCHAR},
				#{currRate, jdbcType=INTEGER},
				#{cvAmt, jdbcType=INTEGER},
				#{localAmt, jdbcType=INTEGER},
				#{preparedBy, jdbcType=VARCHAR},
				CAST(to_timestamp(#{preparedDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
				#{certifiedBy, jdbcType=VARCHAR},
				CAST(to_timestamp(#{certifiedDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
				#{createUser, jdbcType=VARCHAR},
				CAST(to_timestamp(#{createDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
				#{updateUser, jdbcType=VARCHAR},
				CAST(to_timestamp(#{updateDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
				#{mainTranId,mode=INOUT, jdbcType=INTEGER},
				#{tranStat, jdbcType=VARCHAR},
				CAST(to_timestamp(#{closeDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
				CAST(to_timestamp(#{deleteDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
				CAST(to_timestamp(#{postDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
				#{disbType, jdbcType=VARCHAR},
				#{destBank, jdbcType=INTEGER},
				#{destAcctNo, jdbcType=VARCHAR},
				#{destAcctName, jdbcType=VARCHAR},
				#{btRefNo, jdbcType=VARCHAR},
				#{swiftCd, jdbcType=VARCHAR}
			);
		END;
	</update>
	
	<update id="saveAcctEntries" parameterType="java.util.Map">
		BEGIN
			<foreach collection="delList" item="del">
				ACSE_ACCT_ENTRIES_PKG.del_acct_acc_entries(#{del.tranId, jdbcType=VARCHAR},
					#{del.entryId, jdbcType=VARCHAR});
			</foreach>
			
			<foreach collection="saveList" item="item">
				ACSE_ACCT_ENTRIES_PKG.save_acse_acc_entries(
					#{item.tranId, jdbcType=VARCHAR},
					#{item.entryId, jdbcType=VARCHAR},
					#{item.glAcctId, jdbcType=VARCHAR},
					#{item.slTypeCd, jdbcType=VARCHAR},
					#{item.slCd, jdbcType=VARCHAR},
					#{item.creditAmt, jdbcType=VARCHAR},
					#{item.debitAmt, jdbcType=VARCHAR},
					#{item.foreignCreditAmt, jdbcType=VARCHAR},
					#{item.foreignDebitAmt, jdbcType=VARCHAR},
					#{item.autoTag, jdbcType=VARCHAR},
					#{item.createUser, jdbcType=VARCHAR},
					CAST(to_timestamp(#{item.createDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
					#{item.updateUser, jdbcType=VARCHAR},
					CAST(to_timestamp(#{item.updateDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE)
				);
			</foreach>
			IF #{forApproval, jdbcType=VARCHAR} IS NOT NULL THEN
				ACSE_JOURNAL_VOUCHER_PKG.acct_entry_apprvl(#{tranId, jdbcType=VARCHAR},#{forApproval, jdbcType=VARCHAR});
			END IF;
		END;
	</update>
	
	<resultMap type="ph.cpi.rest.api.model.accountingservice.AcseAttachments" id="attachmentMap">
		<result property="tranId" column="TRAN_ID"/>
		<result property="fileNo" column="FILE_NO"/>
		<result property="fileName" column="FILE_NAME"/>
		<result property="description" column="DESCRIPTION"/>
		<result property="createUser" column="CREATE_USER"/>
		<result property="createDate" column="CREATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<result property="updateUser" column="UPDATE_USER"/>
		<result property="updateDate" column="UPDATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
	</resultMap>
	
	<select id="retrieveAttachments" resultMap="attachmentMap" parameterType="java.util.Map">
		SELECT * FROM TABLE(ACSE_ATTACHMENTS_PKG.ret_acse_attchmnt(#{tranId},null,null,null,null))
	</select>
	
	<update id="saveAttachments" parameterType="java.util.Map" statementType="CALLABLE">
		BEGIN
			 <foreach collection="delAttachmentsList" item="del">
		   		ACSE_ATTACHMENTS_PKG.del_acse_attchmnt(#{del.tranId},
		   											#{del.fileNo, jdbcType=VARCHAR});
		   </foreach>
		   <foreach collection="saveAttachmentsList" item="attachment">
		   	   ACSE_ATTACHMENTS_PKG.save_acse_attchmnt(#{uploadDate, mode=OUT, jdbcType=VARCHAR},
		   	   										#{attachment.tranId},
		   	   										#{attachment.fileNo, jdbcType=VARCHAR},
		   	   										#{attachment.fileName},
		   	   										#{attachment.description},
		   	   										#{attachment.createUser},
			   										CAST(to_timestamp(#{attachment.createDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
			   										#{attachment.updateUser},
			   										CAST(to_timestamp(#{attachment.updateDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE));
		   </foreach>
		   DBMS_OUTPUT.PUT_LINE('PLACEHOLDER');
		   END;
	</update>

	<update id="updateAcseCvStat" parameterType="java.util.Map">
		BEGIN
			ACSE_CHECK_VOUCHER_PKG.up_acse_cv_stat(
				#{tranId, jdbcType=INTEGER},
				#{checkId, jdbcType=INTEGER},
				#{cvStatus, jdbcType=VARCHAR},
				#{printType, jdbcType=VARCHAR},
				#{updateUser, jdbcType=VARCHAR},
				#{cancelReason, jdbcType=VARCHAR}
			);
		END;
	</update>
	
	<resultMap type="ph.cpi.rest.api.model.accountingservice.AcseCvPaytReq" id="acseCvPaytReqListMap">
		<result property="paytReqNo" 	column="PAYT_REQ_NO"/>
		<result property="tranId" 		column="TRAN_ID"/>
		<result property="itemNo" 		column="ITEM_NO"/>
		<result property="reqId" 		column="REQ_ID"/>
		<result property="reqPrefix" 	column="REQ_PREFIX"/>
		<result property="reqYear" 		column="REQ_YEAR"/>
		<result property="reqMm" 		column="REQ_MM"/>
		<result property="reqSeqNo" 	column="REQ_SEQ_NO"/>
		<result property="tranTypeCd" 	column="TRAN_TYPE_CD"/>
		<result property="tranTypeDesc" column="TRAN_TYPE_DESC"/>
		<result property="reqDate" 		column="REQ_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" />
		<result property="requestedBy" 	column="REQUESTED_BY"/>
		<result property="particulars" 	column="PARTICULARS"/>
		<result property="currCd" 		column="CURR_CD"/>
		<result property="currRate" 	column="CURR_RATE"/>
		<result property="reqAmt" 		column="REQ_AMT"/>
		<result property="localAmt" 	column="LOCAL_AMT"/>
		<result property="createUser" 	column="CREATE_USER"/>
		<result property="createDate" 	column="CREATE_DATE"  typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" />
		<result property="updateUser" 	column="UPDATE_USER"/>
		<result property="updateDate" 	column="UPDATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" />
	</resultMap>
	
	<select id="retrieveAcseCvPaytReqList" resultMap="acseCvPaytReqListMap" parameterType="java.util.Map">
		SELECT * FROM TABLE(ACSE_CV_PAYTREQLIST_PKG.ret_payt_req_list(
					#{tranId,jdbcType=INTEGER},
					#{itemNo,jdbcType=INTEGER},
					'', '', '',''))
	</select>
	
	<update id="saveAcseCvPaytReqList" parameterType="java.util.Map" statementType="CALLABLE">
		BEGIN
			<foreach collection="deletePaytReqList" item="del">
				ACSE_CV_PAYTREQLIST_PKG.del_payt_req_list(#{del.tranId, jdbcType=INTEGER}, 
														  #{del.itemNo, jdbcType=INTEGER},
														  #{del.updateUser, jdbcType=VARCHAR}, 
														  #{del.cvStatus, jdbcType=VARCHAR});
			</foreach>
			
			<foreach collection="savePaytReqList" item="save">
				ACSE_CV_PAYTREQLIST_PKG.save_payt_req_list(#{save.tranId, jdbcType=INTEGER},
														   #{save.itemNo, jdbcType=INTEGER},
														   #{save.reqId, jdbcType=INTEGER},
														   #{save.createUser, jdbcType=VARCHAR},
														   CAST(to_timestamp(#{save.createDate, jdbcType=VARCHAR}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
														   #{save.updateUser, jdbcType=VARCHAR}, 
														   CAST(to_timestamp(#{save.updateDate, jdbcType=VARCHAR}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
														   #{save.cvStatus, jdbcType=VARCHAR});
			</foreach>
		END;
	</update>
	
	<update id="cancelOr" parameterType="java.util.Map" statementType="CALLABLE">
		BEGIN
			ACSE_OFFICIAL_RECEIPT_PKG.cancel_or(#{tranId},
												#{updateUser}, 
												CAST(to_timestamp(#{updateDate, jdbcType=VARCHAR}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE));
		END;
	</update>
	
	<resultMap type="ph.cpi.rest.api.model.accountingservice.AcseOrServFee" id="acseOrServFeeMap">
		<result property="tranId"               column="TRAN_ID" />
		<result property="billId"               column="BILL_ID" />
		<result property="itemNo"               column="ITEM_NO" />
		<result property="quarterEnding"        column="QUARTER_ENDING" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" />
		<result property="currCd"               column="CURR_CD" />
		<result property="currRate"             column="CURR_RATE" />
		<result property="servFeeAmt"           column="SERVFEE_AMT" />
		<result property="localAmt"             column="LOCAL_AMT" />
		<result property="createUser"           column="CREATE_USER" />
		<result property="createDate"           column="CREATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" />
		<result property="updateUser"           column="UPDATE_USER" />
		<result property="updateDate"           column="UPDATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" />
		<association property="taxAllocation" resultMap="taxAllocAssoc" />
	</resultMap>
	
	<select id="retAcseOrServFee" resultMap="acseOrServFeeMap" parameterType="java.util.Map">
		SELECT * FROM TABLE(ACSE_OR_SERVFEE_PKG.ret_acse_or_servfee(
																		#{tranId},
																		#{billId}))
	</select>
	
	<update id="saveAcseOrServFee" parameterType="java.util.Map" statementType="CALLABLE">
		DECLARE
			v_message	VARCHAR2(500);
			v_item_no	NUMBER;
		BEGIN
			<!-- Save in ACSE_OR_TRANSUMM -->
			ACSE_OR_TRANSUMM_PKG.save_acse_transumm(
														#{tranId},
														#{billId},
														#{billType},
														#{totalLocalAmt},
														#{createUser},
														CAST(to_timestamp(#{createDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
														#{updateUser},
														CAST(to_timestamp(#{updateDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE)
			);
			<foreach item="del" collection="delOrItemTaxes">
				<!-- Delete data from ACSE_OR_ITEMTAXES first since it's a child table -->
				ACSE_OR_ITEMTAXES_PKG.del_or_itemtaxes(
													#{del.tranId},
													#{del.billId},
													#{del.itemNo},
													#{del.taxType},
													#{del.taxCd}
												);
				
			</foreach>
			<foreach collection="delServFee" item="del">
				ACSE_OR_SERVFEE_PKG.del_acse_or_servfee(#{del.tranId}, 
														#{del.billId},
														  #{del.itemNo});
			</foreach>
			<foreach collection="saveServFee" item="save">
				ACSE_OR_SERVFEE_PKG.save_acse_or_servfee(v_item_no,
														 #{save.tranId},
														 #{save.billId},
														 #{save.itemNo, jdbcType=VARCHAR},
														 CAST(to_timestamp(#{save.quarterEnding, jdbcType=VARCHAR}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
														 #{save.currCd},
														 #{save.currRate},
														 #{save.servFeeAmt},
														 #{save.localAmt},
														 #{save.createUser, jdbcType=VARCHAR},
														 CAST(to_timestamp(#{save.createDate, jdbcType=VARCHAR}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
														 #{save.updateUser, jdbcType=VARCHAR}, 
														 CAST(to_timestamp(#{save.updateDate, jdbcType=VARCHAR}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
														 #{save.invoiceId, jdbcType=VARCHAR});
			   <!-- Save data from ACSE_OR_ITEMTAXES per ACSE_OR_SERVFEE item -->
				<foreach item="saveTaxes" collection="save.taxAllocation">
					ACSE_OR_ITEMTAXES_PKG.save_or_itemtaxes(
																#{saveTaxes.tranId},
																#{saveTaxes.billId},
																v_item_no,	<!-- Based on the output parameter in ACSE_OR_TRANSDTL_PKG.save_or_transdtl PROCEDURE -->
																#{saveTaxes.taxType},
																#{saveTaxes.taxCd},
																#{saveTaxes.taxRate, jdbcType=VARCHAR},
																#{saveTaxes.taxAmt, jdbcType=VARCHAR},
																#{save.createUser},
																CAST(to_timestamp(#{save.createDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
																#{save.updateUser},
																CAST(to_timestamp(#{save.updateDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
																#{saveTaxes.genType}
					);
				</foreach>
			</foreach>
			<!-- Generate Tax Details -->
			<!-- GENERATE_ACCSE_TAXES.SAVE_FINAL_TAXES('OR', #{billType}, #{tranId}, v_message); -->
			    
			<!-- ACCOUNTING_SERVICE_PKG.generate_item_taxes('OR', #{tranId}, #{billType}, #{createUser}, #{updateUser}); -->
		    <!-- ACCOUNTING_SERVICE_PKG.generate_tax_dtl('OR', #{tranId}, #{billType}, #{createUser}, #{updateUser}); -->
		    
		    GENERATE_ACCSE_TAXES.SAVE_FINAL_TAXES('OR', #{billType}, #{tranId}, v_message);
		    
		    <!-- Generate Accounting Entries -->
			GENERATE_ACCSE_ENTRIES.SAVE_FINAL_ACCT_ENTRIES('OR', #{billType}, #{tranId}, v_message);
		END;
	</update>
	
	<resultMap type="ph.cpi.rest.api.model.accountingservice.AcseBatchOR" id="acseBatchOrMap">
		<result property="tranId"               column="TRAN_ID" />
		<result property="tranTypeCd"           column="TRAN_TYPE_CD" />
		<result property="tranTypeName"         column="TRAN_TYPE_NAME" />
		<result property="orType"               column="OR_TYPE" />
		<result property="orNo"             	column="OR_NO" />
		<result property="tranDate"             column="TRAN_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" />
		<result property="tranStat"            	column="TRAN_STAT" />
		<result property="tranStatDesc"         column="TRAN_STAT_DATE" />
		<result property="orStat"             	column="OR_STAT" />
		<result property="orStatDesc"           column="OR_STAT_DESC" />
		<result property="payor"           	    column="PAYOR" />
		<result property="particulars"          column="PARTICULARS" />
		<result property="orAmt"             	column="OR_AMT" />
		<result property="credit"             	column="CREDIT" />
		<result property="debit"             	column="DEBIT" />
		<result property="createUser"           column="CREATE_USER" />
		<result property="createDate"           column="CREATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" />
		<result property="updateUser"           column="UPDATE_USER" />
		<result property="updateDate"           column="UPDATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" />
	</resultMap>
	
	<select id="retrieveAcseBatchOr" resultMap="acseBatchOrMap" parameterType="java.util.Map">
		SELECT * FROM TABLE(ACSE_BATCH_OR_PKG.ret_acse_batch_or(CAST(to_timestamp(#{orDateFrom, jdbcType=VARCHAR}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
																CAST(to_timestamp(#{orDateTo, jdbcType=VARCHAR}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
																#{tranTypeCd, jdbcType=VARCHAR},
																'',
																'',
																'',
																''))
	</select>

	<resultMap type="ph.cpi.rest.api.model.accountingservice.AcseBudgetExpense" id="acseBudgetExpenseMap">
		<result property="budgetYear" 		column="BUDGET_YEAR"/>
		<result property="itemNo" 			column="ITEM_NO"/>
		<result property="glAcctId" 		column="GL_ACCT_ID"/>
		<result property="glShortCd" 		column="GL_SHORT_CD"/>
		<result property="glShortDesc" 		column="GL_SHORT_DESC"/>
		<result property="slTypeCd" 		column="SL_TYPE_CD"/>
		<result property="slTypeName" 		column="SL_TYPE_NAME"/>
		<result property="slCd" 			column="SL_CD"/>
		<result property="slName" 			column="SL_NAME"/>
		<result property="totalBudget" 		column="TOTAL_BUDGET"/>
		<result property="totalExpense" 	column="TOTAL_EXPENSE"/>
		<result property="createUser" 		column="CREATE_USER"/>
		<result property="createDate" 		column="CREATE_DATE"  typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" />
		<result property="updateUser" 		column="UPDATE_USER"/>
		<result property="updateDate" 		column="UPDATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" />
	</resultMap>
	
	<select id="retrieveAcseBudgetExpense" resultMap="acseBudgetExpenseMap" parameterType="java.util.Map">
		SELECT * FROM TABLE(ACSE_BUDGET_EXPENSE_PKG.ret_budget_expense(
					#{budgetYear,jdbcType=INTEGER},
					#{itemNo,jdbcType=INTEGER},
					'', '', '',''))
	</select>
	
	<update id="saveAcseBudgetExpense" parameterType="java.util.Map" statementType="CALLABLE">
		BEGIN
			<foreach collection="deleteBudgetExpense" item="del">
				ACSE_BUDGET_EXPENSE_PKG.del_budget_expense(#{del.budgetYear, jdbcType=INTEGER}, 
														  #{del.itemNo, jdbcType=INTEGER});
			</foreach>
			
			<foreach collection="saveBudgetExpense" item="save">
				ACSE_BUDGET_EXPENSE_PKG.save_budget_expense(#{save.budgetYear, jdbcType=INTEGER},
														   #{save.itemNo, jdbcType=INTEGER},
													       #{save.glAcctId, jdbcType=INTEGER},
													       #{save.slTypeCd, jdbcType=INTEGER},
													       #{save.slCd, jdbcType=INTEGER},
													       #{save.totalBudget, jdbcType=INTEGER},
													       #{save.totalExpense, jdbcType=INTEGER},
														   #{save.createUser, jdbcType=VARCHAR},
														   #{save.updateUser, jdbcType=VARCHAR});
			</foreach>
		END;
	</update>
	
	<resultMap type="ph.cpi.rest.api.model.accountingservice.AcseBudExpMonthly" id="acseBudExpMonthlyMap">
		<result property="budgetYear" 		column="BUDGET_YEAR"/>
		<result property="itemNo" 			column="ITEM_NO"/>
		<result property="glAcctId" 		column="GL_ACCT_ID"/>
		<result property="glShortCd" 		column="GL_SHORT_CD"/>
		<result property="glShortDesc" 		column="GL_SHORT_DESC"/>
		<result property="slTypeCd" 		column="SL_TYPE_CD"/>
		<result property="slTypeName" 		column="SL_TYPE_NAME"/>
		<result property="slCd" 			column="SL_CD"/>
		<result property="slName" 			column="SL_NAME"/>
		<result property="totalBudget" 		column="TOTAL_BUDGET"/>
		<result property="totalExpense" 	column="TOTAL_EXPENSE"/>
		<result property="jan"				column="JAN"/>
		<result property="feb"				column="FEB"/>
		<result property="mar"				column="MAR"/>
		<result property="apr"				column="APR"/>
		<result property="may"				column="MAY"/>
		<result property="jun"				column="JUN"/>
		<result property="jul"				column="JUL"/>
		<result property="aug"				column="AUG"/>
		<result property="sep"				column="SEP"/>
		<result property="oct"				column="OCT"/>
		<result property="nov"				column="NOV"/>
		<result property="dec"				column="DEC"/>
		<result property="createUser" 		column="CREATE_USER"/>
		<result property="createDate" 		column="CREATE_DATE"  typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" />
		<result property="updateUser" 		column="UPDATE_USER"/>
		<result property="updateDate" 		column="UPDATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" />
	</resultMap>
	
	<select id="retrieveAcseBudExpMonthly" resultMap="acseBudExpMonthlyMap" parameterType="java.util.Map">
		SELECT * FROM TABLE(ACSE_BUDGET_EXPENSE_PKG.ret_budexp_monthly(
					#{budgetYear,jdbcType=INTEGER},
					#{itemNo,jdbcType=INTEGER},
					#{mm,jdbcType=INTEGER},
					'', '', '',''))
	</select>
	
	<update id="saveAcseBudExpMonthly" parameterType="java.util.Map" statementType="CALLABLE">
		BEGIN
			<foreach collection="saveBudExpMonthly" item="save">
				ACSE_BUDGET_EXPENSE_PKG.save_acse_budexp_monthly(#{save.budgetYear, jdbcType=INTEGER},
														   #{save.itemNo, jdbcType=INTEGER},
														   #{save.mm, jdbcType=INTEGER},
													       #{save.glAcctId, jdbcType=INTEGER},
													       #{save.slTypeCd, jdbcType=INTEGER},
													       #{save.slCd, jdbcType=INTEGER},
													       #{save.budgetAmt, jdbcType=INTEGER},
													       #{save.expenseAmt, jdbcType=INTEGER},
														   #{save.createUser, jdbcType=VARCHAR},
														   CAST(to_timestamp(#{save.createDate, jdbcType=VARCHAR}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
														   #{save.updateUser, jdbcType=VARCHAR},
														   CAST(to_timestamp(#{save.updateDate, jdbcType=VARCHAR}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE));
			</foreach>
			DBMS_OUTPUT.PUT_LINE('PLACEHOLDER');
		END;
	</update>
	
	<resultMap type="ph.cpi.rest.api.model.accountingservice.AcseBudExpMonthly" id="acseActExpMonthlyMap">
		<result property="budgetYear" 		column="BUDGET_YEAR"/>
		<result property="itemNo" 			column="ITEM_NO"/>
		<result property="glAcctId" 		column="GL_ACCT_ID"/>
		<result property="glShortCd" 		column="GL_SHORT_CD"/>
		<result property="glShortDesc" 		column="GL_SHORT_DESC"/>
		<result property="slTypeCd" 		column="SL_TYPE_CD"/>
		<result property="slTypeName" 		column="SL_TYPE_NAME"/>
		<result property="slCd" 			column="SL_CD"/>
		<result property="slName" 			column="SL_NAME"/>
		<result property="totalBudget" 		column="TOTAL_BUDGET"/>
		<result property="totalExpense" 	column="TOTAL_EXPENSE"/>
		<result property="jan"				column="JAN"/>
		<result property="feb"				column="FEB"/>
		<result property="mar"				column="MAR"/>
		<result property="apr"				column="APR"/>
		<result property="may"				column="MAY"/>
		<result property="jun"				column="JUN"/>
		<result property="jul"				column="JUL"/>
		<result property="aug"				column="AUG"/>
		<result property="sep"				column="SEP"/>
		<result property="oct"				column="OCT"/>
		<result property="nov"				column="NOV"/>
		<result property="dec"				column="DEC"/>
		<result property="createUser" 		column="CREATE_USER"/>
		<result property="createDate" 		column="CREATE_DATE"  typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" />
		<result property="updateUser" 		column="UPDATE_USER"/>
		<result property="updateDate" 		column="UPDATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" />
	</resultMap>
	
	<select id="retrieveAcseActExpMonthly" resultMap="acseActExpMonthlyMap" parameterType="java.util.Map">
		SELECT * FROM TABLE(ACSE_BUDGET_EXPENSE_PKG.ret_actexp_monthly(
					#{budgetYear,jdbcType=INTEGER},
					#{itemNo,jdbcType=INTEGER},
					#{mm,jdbcType=INTEGER},
					'', '', '',''))
	</select>
	
	<update id="printOr" parameterType="java.util.Map">
		BEGIN
			ACSE_OFFICIAL_RECEIPT_PKG.print_or(#{tranId},#{orNo},#{updateUser},CAST(to_timestamp(#{updateDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE));
		END;
	</update>
	
	<update id="printOrBatch" parameterType="java.util.Map">
		BEGIN
		 	<foreach collection="printOrList" item="save">
				ACSE_OFFICIAL_RECEIPT_PKG.print_or(#{save.tranId,jdbcType=VARCHAR},#{save.orNo, jdbcType=VARCHAR},#{save.updateUser, jdbcType=VARCHAR},CAST(to_timestamp(#{save.updateDate,  jdbcType=VARCHAR}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE));
			</foreach>
		END;
	</update>
	
	<resultMap type="ph.cpi.rest.api.model.accountingservice.AcseCancelledOR" id="AcseCancelledORMap">
            <result property="tranClass"              column="TRAN_CLASS"/>
            <result property="tranId"                 column="TRAN_ID"/>
            <result property="orNo"                   column="OR_NO"/>
            <result property="payor"                  column="PAYOR"/>
            <result property="orDate"                 column="OR_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" />
            <result property="tranTypeCd"             column="TRAN_TYPE_CD"/>
            <result property="tranTypeDesc"           column="TRAN_TYPE_DESC"/>
            <result property="orStatus"               column="OR_STATUS"/>
            <result property="status"                 column="STATUS"/>
            <result property="particulars"            column="PARTICULARS"/>
            <result property="amount"                 column="AMOUNT"/>
            <result property="createUser"             column="CREATE_USER"/>
            <result property="createDate"             column="CREATE_DATE"  typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" />
            <result property="updateUser"             column="UPDATE_USER"/>
            <result property="updateDate"             column="UPDATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" />
      </resultMap>
      
      <select id="retrieveAcseChangeToNew" resultMap="AcseCancelledORMap" parameterType="java.util.Map">
		SELECT * FROM TABLE(ACSE_CHANGE_STATUS_PKG.ret_cancel_or(
					#{tranId,jdbcType=INTEGER},
					'', '', '',''))
	</select>
	
	<update id="updateAcseChangeStat" parameterType="java.util.Map">
		BEGIN
		 	<foreach collection="changeStat" item="item">
				ACSE_CHANGE_STATUS_PKG.acse_chng_stat(#{item.tranClass},
													  #{item.tranId},
													  #{item.updateUser},
													  CAST(to_timestamp(#{item.updateDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE));
			</foreach>
		END;
	</update>
	
	<resultMap type="ph.cpi.rest.api.model.accountingservice.AcseCancelledCV" id="AcseCancelledCVMap">
            <result property="tranClass" 			  column="TRAN_CLASS"/>
            <result property="tranId" 				  column="TRAN_ID"/>
            <result property="cvNo" 				  column="CV_NO"/>
            <result property="payee" 				  column="PAYEE"/>
            <result property="cvDate" 				  column="CV_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
            <result property="cvStatus" 			  column="CV_STATUS"/>
            <result property="status" 				  column="STATUS"/>
            <result property="particulars" 			  column="PARTICULARS"/>
            <result property="amount" 				  column="AMOUNT"/>
            <result property="createUser"             column="CREATE_USER"/>
            <result property="createDate"             column="CREATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
            <result property="updateUser"             column="UPDATE_USER"/>
            <result property="updateDate"             column="UPDATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" />
      </resultMap>
      
      <select id="retrieveAcseChangeToNewCV" resultMap="AcseCancelledCVMap" parameterType="java.util.Map">
                SELECT * FROM TABLE(ACSE_CHANGE_STATUS_PKG.ret_cancel_cv(
                                        #{tranId,jdbcType=INTEGER},
                                        '', '', '',''))
        </select>
        
        
        <resultMap type="ph.cpi.rest.api.model.accountingservice.AcseCancelledJV" id="AcseCancelledJVMap">
            <result property="tranClass"              column="TRAN_CLASS"/>
            <result property="tranId"                 column="TRAN_ID"/>
            <result property="jvNo"                   column="JV_NO"/>
            <result property="jvDate"                 column="JV_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
            <result property="particulars"            column="PARTICULARS"/>
            <result property="tranTypeCd"             column="TRAN_TYPE_CD"/>
            <result property="tranTypeDesc"           column="TRAN_TYPE_DESC"/>
            <result property="refNoTranId"            column="REFNO_TRAN_ID"/>
            <result property="refNo"                  column="REFNO"/>
            <result property="preparedBy"             column="PREPARED_BY"/>
            <result property="jvStatus"               column="JV_STATUS"/>
            <result property="status"                 column="STATUS"/>
            <result property="amount"                 column="AMOUNT"/>
            <result property="createUser"             column="CREATE_USER"/>
            <result property="createDate"             column="CREATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
            <result property="updateUser"             column="UPDATE_USER"/>
            <result property="updateDate"             column="UPDATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" />
      </resultMap>
      
      <select id="retrieveAcseChangeToNewJV" resultMap="AcseCancelledJVMap" parameterType="java.util.Map">
                SELECT * FROM TABLE(ACSE_CHANGE_STATUS_PKG.ret_cancel_jv(
                                        #{tranId,jdbcType=INTEGER},
                                        '', '', '',''))
        </select>
        
    <resultMap type="ph.cpi.rest.api.model.accountingservice.AcseCancelledTransactions" id="AcseCancelledTransactionsMap">
    	<result property="tranId" column="TRAN_ID"/>
		<result property="tranClass" column="TRAN_CLASS"/>
		<result property="refNo" column="REF_NO"/>
		<result property="tranDate" column="TRAN_DATE"  typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<result property="tranType" column="TRAN_TYPE"/>
		<result property="tranTypeDesc" column="TRAN_TYPE_DESC"/>
		<result property="payee" column="PAYEE"/>
		<result property="particulars" column="PARTICULARS"/>
		<result property="cancelledBy" column="CANCELLED_BY"/>
		<result property="cancelledDate" column="CANCELLED_DATE"  typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<result property="reason" column="REASON"/>
		<result property="amount" column="AMOUNT"/>
    </resultMap>
	
	 <select id="retrieveAcseCancelledTran" resultMap="AcseCancelledTransactionsMap">
		SELECT * FROM TABLE(ACSE_CANCELLED_TRAN_PKG.ret_cancel_tran( #{tranId,jdbcType=INTEGER}, #{tranClass,jdbcType=INTEGER}, 
																	 CAST(to_timestamp(#{cancelFrom, jdbcType=VARCHAR}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
																	CAST(to_timestamp(#{cancelTo, jdbcType=VARCHAR}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),NULL,NULL,NULL,NULL))
	</select>
	
	<resultMap type="ph.cpi.rest.api.model.accountingservice.AcseBatchInvoice" id="acseBatchInvoiceMap">
		<result property="invoiceId"            column="INVOICE_ID" />
		<result property="invoiceNo"           	column="INVOICE_NO" />
		<result property="invoiceDate"         	column="INVOICE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" />
		<result property="invoiceStat"          column="INVOICE_STAT" />
		<result property="invoiceStatDesc"      column="INVOICE_DESC" />
		<result property="refNoTranId"          column="REFNO_TRAN_ID" />
		<result property="refNoDate"            column="REFNO_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" />
		<result property="tranClass"            column="TRAN_CLASS" />
		<result property="tranNo"         		column="TRAN_NO" />
		<result property="tranDate"             column="TRAN_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" />
		<result property="tranYear"             column="TRAN_YEAR" />
		<result property="payor"           		column="PAYOR" />
		<result property="payeeClassCd"         column="PAYEE_CLASS_CD" />
		<result property="payeeCd"         		column="PAYEE_CD" />
		<result property="particulars"          column="PARTICULARS" />
		<result property="tranTypeCd"           column="TRAN_TYPE_CD" />
		<result property="currCd"             	column="CURR_CD" />
		<result property="currRate"             column="CURR_RATE" />
	    <result property="invoiceAmt"           column="INVOICE_AMT" />
		<result property="localAmt"             column="LOCAL_AMT" />
		<result property="createUser"           column="CREATE_USER" />
		<result property="createDate"           column="CREATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" />
		<result property="updateUser"           column="UPDATE_USER" />
		<result property="updateDate"           column="UPDATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" />
		<result property="autoTag"           	column="AUTO_TAG" />
	</resultMap>
	
	<select id="retrieveAcseBatchInvoice" resultMap="acseBatchInvoiceMap" parameterType="java.util.Map">
		SELECT * FROM TABLE(ACSE_BATCH_INVOICE_PKG.ret_acse_batch_invoice(CAST(to_timestamp(#{tranDateFrom, jdbcType=VARCHAR}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
																CAST(to_timestamp(#{tranDateTo, jdbcType=VARCHAR}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
																#{tranNo, jdbcType=VARCHAR},
																#{tranTypeCd, jdbcType=VARCHAR},
																#{tranClass, jdbcType=VARCHAR},
																#{invoiceId, jdbcType=VARCHAR},
																'',
																'',
																'',
																''))
	</select>
	
	<update id="saveAcseInvoice" parameterType="java.util.Map" statementType="CALLABLE">
		DECLARE
			v_invoice_id	ACSE_INVOICES.INVOICE_ID%TYPE;
		BEGIN
			ACSE_BATCH_INVOICE_PKG.save_acse_invoice(v_invoice_id, 
												    #{invoiceId, jdbcType=VARCHAR}, 
													#{invoiceNo, jdbcType=VARCHAR}, 
													CAST(to_timestamp(#{invoiceDate, jdbcType=VARCHAR}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
													#{autoTag, jdbcType=VARCHAR}, 
													#{refNoTranId, jdbcType=VARCHAR}, 
													CAST(to_timestamp(#{refNoDate, jdbcType=VARCHAR}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
													#{tranTypeCd, jdbcType=VARCHAR}, 
													#{tranClass, jdbcType=VARCHAR}, 
													#{invoiceStat, jdbcType=VARCHAR}, 
													#{payeeClassCd, jdbcType=VARCHAR}, 
													#{payor, jdbcType=VARCHAR}, 
													#{payeeCd, jdbcType=VARCHAR},
													#{particulars, jdbcType=VARCHAR},
													#{currCd, jdbcType=VARCHAR},
													#{currRate, jdbcType=VARCHAR},
													#{invoiceAmt, jdbcType=VARCHAR},
													#{localAmt, jdbcType=VARCHAR},
													#{createUser, jdbcType=VARCHAR},
													CAST(to_timestamp(#{createDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE), 
													#{updateUser, jdbcType=VARCHAR}, 
													CAST(to_timestamp(#{updateDate, jdbcType=VARCHAR}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE)  
												  );	
				#{invoiceIdOut, mode=OUT, jdbcType=INTEGER} := v_invoice_id;													  
				  
		END;
	</update>
	
	<update id="generateBatchInvoiceNo" parameterType="java.util.Map">
		BEGIN
		 	<foreach collection="invoiceNoList" item="list">
				ACSE_BATCH_INVOICE_PKG.gen_acse_invoice_no(#{list.invoiceId,jdbcType=VARCHAR},#{list.invoiceNo, jdbcType=VARCHAR},#{list.updateUser, jdbcType=VARCHAR},CAST(to_timestamp(#{list.updateDate,  jdbcType=VARCHAR}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE));
			</foreach>
		END;
	</update>
	
	<resultMap type="ph.cpi.rest.api.model.accountingservice.AcseInvoiceItems" id="acseInvoiceItemMap">
		<result property="invoiceId"            column="INVOICE_ID" />
		<result property="itemNo"           	column="ITEM_NO" />
		<result property="itemDesc"      		column="ITEM_DESC" />
		<result property="currCd"             	column="CURR_CD" />
		<result property="currRate"             column="CURR_RATE" />
	    <result property="itemAmt"           	column="ITEM_AMT" />
		<result property="localAmt"             column="LOCAL_AMT" />
		<result property="createUser"           column="CREATE_USER" />
		<result property="createDate"           column="CREATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" />
		<result property="updateUser"           column="UPDATE_USER" />
		<result property="updateDate"           column="UPDATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" />
	</resultMap>
	
	<select id="retrieveAcseInvoiceItems" resultMap="acseInvoiceItemMap" parameterType="java.util.Map">
		SELECT * FROM TABLE(ACSE_BATCH_INVOICE_PKG.ret_acse_inv_item(
																#{invoiceId, jdbcType=VARCHAR},
																'',
																'',
																'',
																''))
	</select>
	
	<update id="saveAcseInvoiceItem" parameterType="java.util.Map">
		BEGIN
			<foreach collection="invoiceDelItemList" item="list">
				ACSE_BATCH_INVOICE_PKG.del_acse_inv_item(#{list.invoiceId,jdbcType=VARCHAR},
				#{list.itemNo, jdbcType=VARCHAR});
			</foreach>
			
		 	<foreach collection="invoiceItemList" item="list">
				ACSE_BATCH_INVOICE_PKG.save_acse_inv_item(#{list.invoiceId,jdbcType=VARCHAR},
				#{list.itemNo, jdbcType=VARCHAR},
				#{list.itemDesc, jdbcType=VARCHAR},
				#{list.currCd, jdbcType=VARCHAR},
				#{list.currRate, jdbcType=VARCHAR},
				#{list.itemAmt, jdbcType=VARCHAR},
				#{list.localAmt, jdbcType=VARCHAR},
				#{list.createUser, jdbcType=VARCHAR},
				CAST(to_timestamp(#{list.createDate,  jdbcType=VARCHAR}, 
				'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
				#{list.updateUser, jdbcType=VARCHAR},
				CAST(to_timestamp(#{list.updateDate,  jdbcType=VARCHAR}, 
				'YYYY-MM-DD"T"HH24:MI:SS') AS DATE));
			</foreach>
		END;
	</update>
	
	<update id="copyAcseExpenseBudget" parameterType="java.util.Map">
		BEGIN
			ACSE_BUDGET_EXPENSE_PKG.copy_exp_budget(#{originYear},#{desYear},null,null,null,null);
		END;
	</update>
	
	<update id="validateCheckNoAcse" parameterType="java.util.Map" statementType="CALLABLE">
		{CALL
			#{validateCheckNo, mode=OUT, javaType=String, jdbcType=VARCHAR} := ACSE_CHECK_VOUCHER_PKG.ret_mtn_check_no(#{bank},#{bankAcct},#{checkNo},#{tranId, jdbcType=INTEGER})
		}
	</update>
	
	<select id="isCvNoAvailAcse" resultType="java.lang.String" statementType="CALLABLE">
		SELECT PMMSC.ACSE_CHECK_VOUCHER_PKG.is_cv_no_avail FROM DUAL
	</select>
	
	<resultMap type="ph.cpi.rest.api.model.accountingservice.AcsePerDiem" id="acsePerDiemMap">
		<result property="reqId" 			column="REQ_ID"/>
		<result property="itemNo" 			column="ITEM_NO"/>
		<result property="directorId" 		column="DIRECTOR_ID"/>
		<result property="directorName" 	column="DIRECTOR_NAME"/>
		<result property="feeType" 			column="FEE_TYPE"/>
		<result property="feeTypeDesc" 		column="FEE_TYPE_DESC"/>
		<result property="currCd" 			column="CURR_CD"/>
		<result property="currRate" 		column="CURR_RATE"/>
		<result property="feeAmt" 			column="FEE_AMT"/>
		<result property="localAmt" 		column="LOCAL_AMT"/>
		<result property="createUser" 		column="CREATE_USER"/>
		<result property="createDate" 		column="CREATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" />
		<result property="updateUser" 		column="UPDATE_USER"/>
		<result property="updateDate" 		column="UPDATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" />
		<association property="taxAllocation" resultMap="taxAllocAssocCv"></association>
	</resultMap>
	
	<select id="retrieveAcsePerDiem" resultMap="acsePerDiemMap" parameterType="java.util.Map">
		SELECT * FROM TABLE(ACSE_PRQ_PER_DIEM_PKG.ret_acse_perdiem(
					#{reqId,jdbcType=INTEGER},
					#{itemNo, jdbcType=INTEGER},
					'', '', '',''))
	</select>
	<update id="saveAcsePerDiem" parameterType="java.util.Map" statementType="CALLABLE">
		DECLARE
			v_req_id		NUMBER;
			v_item_no		NUMBER;
			v_create_user   VARCHAR2(10);
			v_update_user	VARCHAR2(10);
			v_message		VARCHAR2(500);
		BEGIN
			<foreach item="del" collection="delCvItemTaxes">
				v_req_id := #{del.reqId,jdbcType=INTEGER};
				v_item_no := #{del.itemNo,jdbcType=INTEGER};
				<!-- Delete data from ACSE_CV_ITEMTAXES first since it's a child table -->
				ACSE_CV_ITEMTAXES_PKG.del_cv_itemtaxes(
													#{del.reqId},
													#{del.itemNo},
													#{del.taxType},
													#{del.taxCd}
												);
				
			</foreach>
			
			<foreach collection="deletePerDiem" item="del">
				v_req_id := #{del.reqId,jdbcType=INTEGER};
				v_item_no := #{del.itemNo,jdbcType=INTEGER};
				ACSE_PRQ_PER_DIEM_PKG.del_acse_perdiem(
					#{del.reqId,jdbcType=INTEGER},
					#{del.itemNo,jdbcType=INTEGER}
				);
			</foreach>
			
			<foreach collection="savePerDiem" item="save">
				v_req_id := #{save.reqId,jdbcType=INTEGER};
				v_item_no := #{save.itemNo,jdbcType=INTEGER};
				v_create_user := #{save.createUser, jdbcType=VARCHAR};
				v_update_user := #{save.updateUser, jdbcType=VARCHAR};
				
				ACSE_PRQ_PER_DIEM_PKG.save_acse_perdiem(
					v_req_id,
					v_item_no,
					#{save.directorId,jdbcType=INTEGER},
					#{save.directorName,jdbcType=INTEGER},
					#{save.feeType,jdbcType=INTEGER},
					#{save.currCd,jdbcType=INTEGER},
					#{save.currRate,jdbcType=INTEGER},
					#{save.feeAmt,jdbcType=INTEGER},
					#{save.localAmt,jdbcType=INTEGER},
					v_create_user,
					CAST(to_timestamp(#{save.createDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
					v_update_user, 
					CAST(to_timestamp(#{save.updateDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE)
				);
				
				<foreach item="saveTaxes" collection="save.taxAllocation">
					ACSE_CV_ITEMTAXES_PKG.save_cv_itemtaxes(
																#{saveTaxes.reqId},
																v_item_no,	<!-- Based on the output parameter in ACSE_OR_TRANSDTL_PKG.save_or_transdtl PROCEDURE -->
																#{saveTaxes.taxSeqNo, jdbcType=VARCHAR},
																#{saveTaxes.taxType},
																#{saveTaxes.taxCd},
																#{saveTaxes.taxRate, jdbcType=VARCHAR},
																#{saveTaxes.taxAmt, jdbcType=VARCHAR},
																#{save.createUser},
																CAST(to_timestamp(#{save.createDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
																#{save.updateUser},
																CAST(to_timestamp(#{save.updateDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
																#{saveTaxes.genType}
					);
				</foreach>
			</foreach>
			
			<!-- ACCOUNTING_SERVICE_PKG.generate_item_taxes('PRQ',NULL,6,v_create_user,v_update_user,v_req_id); -->
			GENERATE_ACCSE_TAXES.GENERATE_PRQ_ITEMTAXES('PRQ', 6, v_req_id, v_message);
		END;
	</update>
	
	<update id="generateBatchOrNo" parameterType="java.util.Map">
		BEGIN
		 	<foreach collection="orNoList" item="list">
				ACSE_BATCH_OR_PKG.gen_acse_or_no(#{list.tranId,jdbcType=VARCHAR},#{list.orType, jdbcType=VARCHAR},#{list.orNo, jdbcType=VARCHAR},#{list.updateUser, jdbcType=VARCHAR},CAST(to_timestamp(#{list.updateDate,  jdbcType=VARCHAR}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE));
			</foreach>
		END;
	</update>
    
    <resultMap type="ph.cpi.rest.api.model.accountingservice.AcseDcbCollection" id="dcbCollectMap">
		<result property="paytMode" column="PAYTMODE"/>
		<result property="paytModeDesc" column="PAYTMODE_DESC"/>
		<result property="orgAmt" column="ORG_AMT"/>
		<result property="currCd" column="CURR_CD"/>
		<result property="currRate" column="CURR_RATE"/>
		<result property="localAmt" column="LOCAL_AMT"/>
	</resultMap>
	
	<select id="retrieveAcseDcbCollection" resultMap="dcbCollectMap" parameterType="java.util.Map">
		SELECT * FROM TABLE(ACSE_DCB_NO_PKG.ret_dcb_coll(#{dcbYear},#{dcbNo},null,null,null,null))
	</select>
	
	<resultMap type="ph.cpi.rest.api.model.accountingservice.AcseDcbBankDetails" id="bankDetailsMap">
		<result property="bankCd" 		column="DCB_BANK"/>
		<result property="bankName" 	column="DCB_BANK_NAME"/>
		<result property="acctNo" 		column="DCB_ACCT_NO"/>
		<result property="paytMode" 	column="PAYT_MODE"/>
		<result property="paytModeDesc" column="PAYT_MODE_DESC"/>
		<result property="orgAmt" 		column="ORG_AMT"/>
		<result property="currCd" 		column="CURR_CD"/>
		<result property="currRate" 	column="CURR_RATE"/>
		<result property="localAmt" 	column="LOCAL_AMT"/>
	</resultMap>
	
	<select id="retrieveAcseBankDetails" resultMap="bankDetailsMap" parameterType="java.util.Map">
		SELECT * FROM TABLE(ACSE_DCB_NO_PKG.ret_dcb_bank_sum(#{dcbYear},#{dcbNo},null,null,null,null))
	</select>
	
	<resultMap type="ph.cpi.rest.api.model.accountingservice.AcseInsuranceExp" id="acseInsuranceExpMap">
		<result property="reqId" 				column="REQ_ID"/>
		<result property="itemNo" 				column="ITEM_NO"/>
		<result property="insuredTypeCd" 		column="INSURED_TYPE_CD"/>
		<result property="insuredCd" 			column="INSURED_CD"/>
		<result property="insuredName" 			column="INSURED_NAME"/>
		<result property="insuranceType" 		column="INSURANCE_TYPE"/>
		<result property="insuranceTypeDesc"	column="INSURANCE_TYPE_DESC"/>
		<result property="currCd" 				column="CURR_CD"/>
		<result property="currRate" 			column="CURR_RATE"/>
		<result property="insuredAmt" 			column="INSURED_AMT"/>
		<result property="localAmt" 			column="LOCAL_AMT"/>
		<result property="createUser" 			column="CREATE_USER"/>
		<result property="createDate" 			column="CREATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" />
		<result property="updateUser" 			column="UPDATE_USER"/>
		<result property="updateDate" 			column="UPDATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler" />
		<result property="reimburseTag" 		column="REIMBURSE_TAG"/>
		<result property="accruedTag" 			column="ACCRUED_TAG"/>
		<result property="remarks" 				column="REMARKS"/>
		<association property="taxAllocation" resultMap="taxAllocAssocCv"></association>
	</resultMap>
	
	<select id="retrieveAcseInsuranceExp" resultMap="acseInsuranceExpMap" parameterType="java.util.Map">
		SELECT * FROM TABLE(ACSE_PRQ_INSURANCE_EXP_PKG.ret_acse_ins_exp(
					#{reqId,jdbcType=INTEGER},
					#{itemNo, jdbcType=INTEGER},
					'', '', '',''))
	</select>
    
    <update id="saveAcseInsuranceExp" parameterType="java.util.Map" statementType="CALLABLE">
		DECLARE
			v_req_id		NUMBER;
			v_item_no		NUMBER;
			v_create_user   VARCHAR2(10);
			v_update_user	VARCHAR2(10);
			v_message		VARCHAR2(500);
		BEGIN
			<foreach item="del" collection="delCvItemTaxes">
				<!-- Delete data from ACSE_CV_ITEMTAXES first since it's a child table -->
				v_req_id := #{del.reqId,jdbcType=INTEGER};
				v_item_no := #{del.itemNo,jdbcType=INTEGER};
				ACSE_CV_ITEMTAXES_PKG.del_cv_itemtaxes(
													#{del.reqId},
													#{del.itemNo},
													#{del.taxType},
													#{del.taxCd}
												);
				
			</foreach>
			
			<foreach collection="deleteInsuranceExp" item="del">
				v_req_id := #{del.reqId,jdbcType=INTEGER};
				v_item_no := #{del.itemNo,jdbcType=INTEGER};
				ACSE_PRQ_INSURANCE_EXP_PKG.del_acse_ins_exp(
					#{del.reqId,jdbcType=INTEGER},
					#{del.itemNo,jdbcType=INTEGER}
				);
			</foreach>
			
			<foreach collection="saveInsuranceExp" item="save">
				v_req_id := #{save.reqId,jdbcType=INTEGER};
				v_item_no := #{save.itemNo,jdbcType=INTEGER};
				v_create_user := #{save.createUser, jdbcType=VARCHAR};
				v_update_user := #{save.updateUser, jdbcType=VARCHAR};
				
				ACSE_PRQ_INSURANCE_EXP_PKG.save_acse_ins_exp(
					v_req_id,
					v_item_no,
					#{save.insuredTypeCd,jdbcType=INTEGER},
					#{save.insuredCd,jdbcType=VARCHAR},
					#{save.insuredName,jdbcType=VARCHAR},
					#{save.insuranceType,jdbcType=INTEGER},
					#{save.currCd,jdbcType=VARCHAR},
					#{save.currRate,jdbcType=INTEGER},
					#{save.insuredAmt,jdbcType=INTEGER},
					#{save.localAmt,jdbcType=INTEGER},
					#{save.createUser, jdbcType=VARCHAR},
					CAST(to_timestamp(#{save.createDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
					#{save.updateUser, jdbcType=VARCHAR}, 
					CAST(to_timestamp(#{save.updateDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
					#{save.reimburseTag, jdbcType=VARCHAR},
					#{save.accruedTag, jdbcType=VARCHAR},
					#{save.remarks, jdbcType=VARCHAR}
				);
				
				<foreach item="saveTaxes" collection="save.taxAllocation">
					ACSE_CV_ITEMTAXES_PKG.save_cv_itemtaxes(
																#{saveTaxes.reqId},
																v_item_no,	<!-- Based on the output parameter in ACSE_OR_TRANSDTL_PKG.save_or_transdtl PROCEDURE -->
																#{saveTaxes.taxSeqNo, jdbcType=VARCHAR},
																#{saveTaxes.taxType},
																#{saveTaxes.taxCd},
																#{saveTaxes.taxRate, jdbcType=VARCHAR},
																#{saveTaxes.taxAmt, jdbcType=VARCHAR},
																#{save.createUser},
																CAST(to_timestamp(#{save.createDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
																#{save.updateUser},
																CAST(to_timestamp(#{save.updateDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
																#{saveTaxes.genType}
					);
				</foreach>	
			</foreach>
			<!-- ACCOUNTING_SERVICE_PKG.generate_item_taxes('PRQ',NULL,7,v_create_user,v_update_user,v_req_id); -->
			GENERATE_ACCSE_TAXES.GENERATE_PRQ_ITEMTAXES('PRQ', 7, v_req_id, v_message);
		END;
	</update>
	
	<update id="printInvoiceBatch" parameterType="java.util.Map">
		BEGIN
		 	<foreach collection="printInvoiceList" item="save">
				ACSE_BATCH_INVOICE_PKG.print_invoice(#{save.invoiceId,jdbcType=VARCHAR},#{save.updateUser, jdbcType=VARCHAR},CAST(to_timestamp(#{save.updateDate,  jdbcType=VARCHAR}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE));
			</foreach>
		END;
	</update>
	
	<resultMap type="ph.cpi.rest.api.model.accountingservice.AcseEditedAcctEntries" id="editAcctEntriesMapServ">
		<result property="tranId"       column="TRAN_ID" />
		<result property="tranClass"    column="TRAN_CLASS" />
		<result property="tranTypeName" column="TRAN_TYPE_NAME" />
		<result property="histNo"       column="HIST_NO" />
		<result property="refNo"        column="REF_NO" />
		<result property="tranDate"     column="TRAN_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<result property="payee"        column="PAYEE" />
		<result property="particulars"  column="PARTICULARS" />
		<result property="currCd"       column="CURR_CD" />
		<result property="currRate"     column="CURR_RATE" />
		<result property="amount"       column="AMOUNT" />
		<result property="localAmt"     column="LOCAL_AMT" />
		<result property="status"       column="STATUS" />
		<result property="reason"       column="REASON" />
		<result property="editedBy"     column="EDITOR" />
		<result property="editDate"     column="EDIT_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
	</resultMap>
	
	<select id="retEditAcctEntriesServ" resultMap="editAcctEntriesMapServ" parameterType="java.util.Map">
		SELECT * FROM TABLE(ACSE_ACCTENTRIES_HIST_PKG.ret_edtacctentries(#{tranId}))
	</select>
	
	<select id="retEditAcctEntriesInqServ" resultMap="editAcctEntriesMapServ" parameterType="java.util.Map">
		SELECT * FROM TABLE(ACSE_ACCTENTRIES_HIST_PKG.ret_edtacctentries_inq(#{tranClass, jdbcType=VARCHAR}, 
																		     CAST(to_timestamp(#{tranDateFrom, jdbcType=VARCHAR}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
																		     CAST(to_timestamp(#{tranDateTo, jdbcType=VARCHAR}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE)))
	</select>
	
	<select id="retrieveAcseAcctEntriesInqDtl" resultMap="acctEntryMap">
		SELECT * FROM TABLE(ACSE_ACCTENTRIES_HIST_PKG.ret_eaeinq_dtl(
				#{tranId},
				#{histNo}))
	</select>
    
    <update id="editAcctEntServ" parameterType="java.util.Map" statementType="CALLABLE">
		DECLARE
			v_hist_no	NUMBER;
		BEGIN
			v_hist_no := ACSE_ACCTENTRIES_HIST_PKG.get_next_histno(#{tranId});
			
			<!-- Prepare backup before updating main accounting entries table -->
			ACSE_ACCTENTRIES_HIST_PKG.edit_acct_entries(#{tranId},v_hist_no,#{reason},#{createUser}, #{updateUser});
			<!-- Update Accounting Entries -->
			<foreach collection="delList" item="item">
				ACSE_ACCT_ENTRIES_PKG.del_acct_acc_entries(#{item.tranId, jdbcType=VARCHAR},
					#{item.entryId, jdbcType=VARCHAR});
			</foreach>
			<foreach collection="saveList" item="item">
				ACSE_ACCT_ENTRIES_PKG.save_acse_acc_entries(
					#{item.tranId, jdbcType=VARCHAR},
					#{item.entryId, jdbcType=VARCHAR},
					#{item.glAcctId, jdbcType=VARCHAR},
					#{item.slTypeCd, jdbcType=VARCHAR},
					#{item.slCd, jdbcType=VARCHAR},
					#{item.creditAmt, jdbcType=VARCHAR},
					#{item.debitAmt, jdbcType=VARCHAR},
					#{item.foreignCreditAmt, jdbcType=VARCHAR},
					#{item.foreignDebitAmt, jdbcType=VARCHAR},
					#{item.autoTag, jdbcType=VARCHAR},
					#{item.createUser, jdbcType=VARCHAR},
					CAST(to_timestamp(#{item.createDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
					#{item.updateUser, jdbcType=VARCHAR},
					CAST(to_timestamp(#{item.updateDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE)
				);
				</foreach>
		END;
	</update>
	
	<update id="restoreAcctEntServ" parameterType="java.util.Map" statementType="CALLABLE">
		BEGIN
			ACSE_ACCTENTRIES_HIST_PKG.restore_acct_entries(#{tranId, jdbcType=INTEGER},
													   #{histNo, jdbcType=INTEGER});
		END;
	</update>
    
    
    <update id="saveAcseCloseOpenDcb" parameterType="java.util.Map">
		BEGIN
		 	<foreach collection="saveDcb" item="save">
				ACSE_DCB_NO_PKG.save_remarks(#{save.dcbYear},#{save.dcbNo},#{save.remarks},#{save.updateUser});
			</foreach>
		END;
	</update>
	
	<update id="saveAcseDcbCollection" parameterType="java.util.Map">
		BEGIN
		 	<foreach collection="updateDcb" item="save">
				ACSE_DCB_NO_PKG.update_dcb(#{save.dcbYear},#{save.dcbNo},#{save.dcbStat},#{save.updateUser});
			</foreach>
		END;
	</update>
	
	<update id="updateAcseStat" parameterType="java.util.Map">
        BEGIN
            <foreach collection="updateAcseStatList" item="u">
                ACSE_CHANGE_STATUS_PKG.acse_change_stats(
                    #{u.tranId},
                    #{u.status, jdbcType=VARCHAR},
                    #{u.updateUser ,jdbcType=VARCHAR},
                    #{u.tranClass, jdbcType=VARCHAR},
                    #{u.cancelReason, jdbcType=VARCHAR}
                );
            </foreach>
        END;
    </update>
    
    <update id="validateTranAcctEntDateAcse" parameterType="java.util.Map" statementType="CALLABLE">
		{CALL
			#{validateTranAcctEntDate, mode=OUT, javaType=String, jdbcType=VARCHAR} := ACSE_CHANGE_STATUS_PKG.chkTransAcctEntDate(#{indiv.tranId, jdbcType=INTEGER})
		}
	</update>
	
	<update id="validateTbDateSe" parameterType="java.util.Map" statementType="CALLABLE">
		{CALL
			#{validate, mode=OUT, javaType=String, jdbcType=VARCHAR} := ACSE_TRIAL_BAL_PKG.validate_tb_date(CAST(to_timestamp(#{eomDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE))
		}
	</update>
	
	<update id="acseEomInsertEndOfMonth" parameterType="java.util.Map">
		BEGIN
			ACSE_TRIAL_BAL_PKG.insert_end_of_month(CAST(to_timestamp(#{eomDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
										    	   #{eomUser, jdbcType=VARCHAR});
		END;
	</update>
	
	<update id="acseEomCloseTrans" parameterType="java.util.Map">
		BEGIN
			ACSE_TRIAL_BAL_PKG.close_trans(CAST(to_timestamp(#{eomDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
										   #{includeMonth, jdbcType=VARCHAR},
										   #{includeYear, jdbcType=VARCHAR},
										   #{aeTag, jdbcType=VARCHAR},
										   #{eomUser, jdbcType=VARCHAR});
		END;
	</update>
	
	<update id="acseEomDeleteTrans" parameterType="java.util.Map">
		BEGIN
			ACSE_TRIAL_BAL_PKG.delete_trans(CAST(to_timestamp(#{eomDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
										    #{eomUser, jdbcType=VARCHAR});
		END;
	</update>
	
	<update id="acseEomDeleteMonthlyTotals" parameterType="java.util.Map">
		BEGIN
			ACSE_TRIAL_BAL_PKG.delete_monthly_totals(CAST(to_timestamp(#{eomDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE));
		END;
	</update>
	
	<update id="acseEomInsertMonthlyTotals" parameterType="java.util.Map">
		BEGIN
			ACSE_TRIAL_BAL_PKG.insert_monthly_totals(CAST(to_timestamp(#{eomDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
										    		 #{eomUser, jdbcType=VARCHAR});
		END;
	</update>
	
	<update id="acseEomDeleteMonthlyTotalsBackup">
		BEGIN
			ACSE_TRIAL_BAL_PKG.delete_monthly_totals_backup();
		END;
	</update>
	
	<update id="acseEomInsertMonthlyTotalsBackup" parameterType="java.util.Map">
		BEGIN
			ACSE_TRIAL_BAL_PKG.insert_monthly_totals_backup(CAST(to_timestamp(#{eomDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE));
		END;
	</update>
	
	<resultMap type="ph.cpi.rest.api.model.accountingintrust.AcitEomMonthlyTotals" id="acseEomMonthlyTotals">
		<result property="eomDate"				column="EOM_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<result property="eomMm"				column="EOM_MM"/>
		<result property="eomYear"				column="EOM_YEAR"/>
		<result property="currCd"				column="CURR_CD"/>
		<result property="glAcctId"				column="GL_ACCT_ID"/>
		<result property="shortCode"			column="SHORT_CODE"/>
		<result property="shortDesc"			column="SHORT_DESC"/>
		<result property="longDesc"				column="LONG_DESC"/>
		<result property="begDebitAmt"			column="BEG_DEBIT_AMT"/>
		<result property="begCreditAmt"			column="BEG_CREDIT_AMT"/>
		<result property="totalDebitAmt"		column="TOTAL_DEBIT_AMT"/>
		<result property="totalCreditAmt"		column="TOTAL_CREDIT_AMT"/>
		<result property="transDebitBal"		column="TRANS_DEBIT_BAL"/>
		<result property="transCreditBal"		column="TRANS_CREDIT_BAL"/>
		<result property="transBalance"			column="TRANS_BALANCE"/>
		<result property="endDebitAmt"			column="END_DEBIT_AMT"/>
		<result property="endCreditAmt"			column="END_CREDIT_AMT"/>
	</resultMap>
	
	<select id="retrieveAcseMonthEndTrialBal" resultMap="acseEomMonthlyTotals" parameterType="java.util.Map">
		SELECT * FROM TABLE(ACSE_TRIAL_BAL_PKG.ret_monthly_totals(CAST(to_timestamp(#{eomDate, jdbcType=VARCHAR}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE)))
	</select>
	
	<resultMap type="ph.cpi.rest.api.model.accountingintrust.AcitEomUnpostedMonth" id="acseEomUnpostedMonth">
		<result property="eomDate"				column="EOM_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<result property="eomMm"				column="EOM_MM"/>
		<result property="eomYear"				column="EOM_YEAR"/>
		<result property="qtrMonth"				column="QTR_MONTH"/>
	</resultMap>
	
	<select id="retrieveAcseMonthEndUnpostedMonths" resultMap="acseEomUnpostedMonth" parameterType="java.util.Map">
		SELECT * FROM TABLE(ACSE_POST_TB_PKG.ret_unposted_months())
	</select>
	
	<update id="validatePrevMonthSe" parameterType="java.util.Map" statementType="CALLABLE">
		{CALL
			#{validate, mode=OUT, javaType=String, jdbcType=VARCHAR} := ACSE_POST_TB_PKG.validate_prev_month(#{eomMm, jdbcType=INTEGER},
																										  	 #{eomYear, jdbcType=INTEGER})
		}	
	</update>

	<update id="validateCurrMonthSe" parameterType="java.util.Map" statementType="CALLABLE">
		{CALL
			#{validateCurr, mode=OUT, javaType=String, jdbcType=VARCHAR} := ACSE_POST_TB_PKG.validate_curr_month(#{eomMm, jdbcType=INTEGER},
																										  	 	 #{eomYear, jdbcType=INTEGER})
		}
	</update>
	
	<update id="validateEqualTbSe" parameterType="java.util.Map" statementType="CALLABLE">
		{CALL
			#{equalTb, mode=OUT, javaType=String, jdbcType=VARCHAR} := ACSE_POST_TB_PKG.validate_equal_tb(#{eomMm, jdbcType=INTEGER},
																										  #{eomYear, jdbcType=INTEGER})
		}	
	</update>
	
	<update id="acseEomPostToFiscalYear" parameterType="java.util.Map">
		BEGIN
			ACSE_POST_TB_PKG.post_to_fiscal_year(CAST(to_timestamp(#{eomDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
											    #{eomMm, jdbcType=INTEGER},
											    #{eomYear, jdbcType=INTEGER},
											    #{eomUser, jdbcType=VARCHAR});
		END;
	</update>
	
	<update id="failedPostingSe" parameterType="java.util.Map">
		BEGIN
			ACSE_POST_TB_PKG.failed_posting(CAST(to_timestamp(#{eomDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
										    #{eomMm, jdbcType=INTEGER},
										    #{eomYear, jdbcType=INTEGER},
										    #{eomUser, jdbcType=VARCHAR});
		END;
	</update>
	
	<update id="validateTempCloseSe" parameterType="java.util.Map" statementType="CALLABLE">
		{CALL
			#{validate, mode=OUT, javaType=String, jdbcType=VARCHAR} := ACSE_TRIAL_BAL_PKG.validate_temp_close(CAST(to_timestamp(#{eomDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE))
		}
	</update>
	
	<update id="saveAcseMonthEndTBTempClose" parameterType="java.util.Map">
		BEGIN
			ACSE_TRIAL_BAL_PKG.temp_close_tb(CAST(to_timestamp(#{eomDate, jdbcType=VARCHAR}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
											 #{eomUser, jdbcType=VARCHAR});
		END;
	</update>
	
	<update id="validateReopenSe" parameterType="java.util.Map" statementType="CALLABLE">
		{CALL
			#{validate, mode=OUT, javaType=String, jdbcType=VARCHAR} := ACSE_TRIAL_BAL_PKG.validate_reopen(CAST(to_timestamp(#{eomDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE))
		}
	</update>
	
	<update id="saveAcseMonthEndTBReopen" parameterType="java.util.Map">
		BEGIN
			ACSE_TRIAL_BAL_PKG.reopen_close_tb(CAST(to_timestamp(#{eomDate, jdbcType=VARCHAR}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE),
											   #{eomUser, jdbcType=VARCHAR});
		END;
	</update>
	
	<update id="checkEom" parameterType="java.util.Map" statementType="CALLABLE">
		{CALL
			#{checkEom, mode=OUT, javaType=String, jdbcType=VARCHAR} := ACSE_TRIAL_BAL_PKG.check_eom(CAST(to_timestamp(#{eomDate}, 'YYYY-MM-DD"T"HH24:MI:SS') AS DATE))
		}
	</update>
	
	<resultMap type="ph.cpi.rest.api.model.accountingintrust.AcctServFeeDist" id="orServFeeDtlDistMap">
		<result property="actualShrAmt"       column="ACTUAL_SHR_AMT" />
		<result property="invoiceId"    	  column="INVOICE_ID" />
	</resultMap>
	
	<select id="retOrServFeeDtlDist" resultMap="orServFeeDtlDistMap">
		SELECT * FROM TABLE(ACSE_OR_SERVFEE_PKG.ret_srvdtldist(
																        #{cedingId},
																        #{sFeeYear},
																        #{sFeeQtr}
																    ))
	</select>
	
	<select id="checkAcseJvSeries" resultType="java.lang.String" statementType="CALLABLE">
		SELECT ACSE_JOURNAL_VOUCHER_PKG.check_acse_jv_series FROM DUAL
	</select>

</mapper>