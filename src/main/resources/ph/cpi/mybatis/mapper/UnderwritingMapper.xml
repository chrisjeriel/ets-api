<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="ph.cpi.mybatis.mapper.UnderwritingMapper">
	<resultMap type="ph.cpi.rest.api.model.underwriting.Policy" id="PolicyMap">
		<result property="policyId" 			column="POLICY_ID"/>
		<result property="policyNo" 			column="POLICY_NO"/>
		<association property="deductibles" 	resultMap="PolDeductiblesMap"/>
		<association property="project" 		resultMap="projectMap"></association>
	</resultMap>
	
	<resultMap type="ph.cpi.rest.api.model.underwriting.Deductibles" id="PolDeductiblesMap">
		<result property="coverCd"			column="COVER_CD" />
		<result property="coverCdDesc"		column="COVER_DESC"/>
		<result property="endtCd"			column="ENDT_CD"/>
		<result property="endtTitle"		column="ENDT_TITLE"/>
		<result property="deductibleCd"		column="DED_CD"/>
		<result property="deductibleTitle"	column="DED_TITLE"/>
		<result property="deductibleRt"		column="DED_RT"/>
		<result property="deductibleAmt"	column="DED_AMT"/>
		<result property="deductibleTxt"	column="DED_TXT"/>
		<result property="createUser"		column="DED_CREATE_USER"/>
		<result property="createDate"		column="DED_CREATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<result property="updateUser"		column="DED_UPDATE_USER"/>
		<result property="updateDate"		column="DED_UPDATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
	</resultMap>
	
	<resultMap type="ph.cpi.rest.api.model.underwriting.Project" id="projectMap">
		<result property="projId" 		column="PROJ_ID"/>
		<result property="riskId" 		column="RISK_ID"/>
		<result property="riskName" 	column="RISK_NAME"/>
		<association property="coverage" resultMap="coverageMap"></association>
	</resultMap>
	
	<resultMap type="ph.cpi.rest.api.model.underwriting.Coverage" id="coverageMap">
		<result property="sectionISi" 			column="SECTION_I_SI"/>
		<result property="sectionIISi" 			column="SECTION_II_SI"/>
		<result property="sectionIIISi" 		column="SECTION_III_SI"/>
		<result property="totalSi" 				column="TOTAL_SI"/>
		<result property="sectionIPrem" 		column="SECTION_I_PREM"/>
		<result property="sectionIIPrem" 		column="SECTION_II_PREM"/>
		<result property="sectionIIIPrem" 		column="SECTION_III_PREM"/>
		<result property="totalPrem" 			column="TOTAL_PREM"/>
		<result property="currencyCd" 			column="CURRENCY_CD"/>
		<result property="currencyRt" 			column="CURRENCY_RT"/>
		<result property="pctShare" 			column="PCT_SHARE"/>
		<result property="pctPml" 				column="PCT_PML"/>
		<result property="totalValue" 			column="TOTAL_VALUE"/>
		<result property="remarks" 				column="REMARKS"/>
		<result property="createUser" 			column="CREATE_USER"/>
		<result property="createDate" 			column="CREATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<result property="updateUser" 			column="UPDATE_USER"/>
		<result property="updateDate" 			column="UPDATE_DATE" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<association property="sectionCovers" resultMap ="sectionCoversMap"></association>
	</resultMap>
	
	<resultMap type="ph.cpi.rest.api.model.underwriting.SectionCovers" id="sectionCoversMap">
		<result property="lineCd" 					column="LINE_CD"/>
		<result property="lineCdDesc" 				column="LINE_DESC"/>
		<result property="section" 					column="SECTION"/>
		<result property="coverCd" 					column="COVER_CD"/>
		<result property="description" 				column="DESCRIPTION"/>
		<result property="bulletNo" 				column="BULLET_NO"/>
		<result property="sumInsured" 				column="SUM_INSURED"/>
		<result property="premRt" 					column="PREM_RT"/>
		<result property="premAmt" 					column="PREM_AMT"/>
		<result property="addSi" 					column="ADD_SI"/>
		<result property="createUserSec" 			column="CREATE_USER_SEC"/>
		<result property="createDateSec" 			column="CREATE_DATE_SEC" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
		<result property="updateUserSec" 			column="UPDATE_USER_SEC"/>
		<result property="updateDateSec" 			column="UPDATE_DATE_SEC" typeHandler="ph.cpi.rest.api.typehandler.DateTimeTypeHandler"/>
	</resultMap>
	
	
	
	<select id="retrievePolicyDeductibles" resultMap="PolicyMap" parameterType="java.util.Map">
		SELECT * FROM TABLE (POL_DEDUCTIBLES_PKG.ret_pol_deductibles(#{policyId,jdbcType=VARCHAR},#{policyNo,jdbcType=VARCHAR},#{coverCd,jdbcType=VARCHAR},#{endtCd,jdbcType=VARCHAR},null,null,null,null))
	</select>
	
	<select id="retrievePolCoverage" resultMap="PolicyMap" parameterType="java.util.Map">
		SELECT * FROM TABLE(POL_COVERAGE_PKG.ret_pol_cover(#{policyId, jdbcType=VARCHAR},#{policyNo, jdbcType=VARCHAR},#{position, jdbcType=VARCHAR}, 
																	   #{count, jdbcType=VARCHAR}, 
																	   #{sortKey, jdbcType=VARCHAR}, 
																	   #{order, jdbcType=VARCHAR}))
	</select>
	
</mapper>